<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml" xml:lang="en" lang="en">
<head>
<meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
<meta name="language" content="en" />
<link rel="stylesheet" type="text/css" href="css/style.css" />
<link rel="stylesheet" type="text/css" href="css/api.css" />
<script type="text/javascript" src="js/jquery.js"></script>
<title>User</title>
</head>

<body>
<div id="apiPage">

<div id="apiHeader">
My Web Application Class Reference. <a href="http://www.yiiframework.com">Yii Framework</a>
</div><!-- end of header -->

<div id="content">
<h1>User</h1>
<div id="nav">
<a href="index.html">All Packages</a>
| <a href="#properties">Properties</a>
| <a href="#methods">Methods</a>
| <a href="#events">Events</a>
</div>

<table class="summaryTable docClass">
<colgroup>
	<col class="col-name" />
	<col class="col-value" />
</colgroup>
<tr>
  <th>Package</th>
  <td><a href="index.html#application">application</a></td>
</tr>
<tr>
  <th>Inheritance</th>
  <td>class User &raquo;
<a href="http://www.yiiframework.com/doc/api/1.1/CActiveRecord">CActiveRecord</a> &raquo;
<a href="http://www.yiiframework.com/doc/api/1.1/CModel">CModel</a> &raquo;
<a href="http://www.yiiframework.com/doc/api/1.1/CComponent">CComponent</a></td>
</tr>
<tr>
  <th>Implements</th>
  <td>IteratorAggregate, Traversable, ArrayAccess</td>
</tr>
<tr>
  <th>Source Code</th>
  <td></td>
</tr>
</table>

<div id="classDescription">
用户账号信息.
This is the model class for table "user".
<br/><br/>
The followings are the available columns in table 'user':</div>

<a name="properties"></a>

<div class="summary docProperty">
<h2>Public Properties</h2>

<p><a href="#" class="toggle">Hide inherited properties</a></p>

<table class="summaryTable">
<colgroup>
	<col class="col-property" />
	<col class="col-type" />
	<col class="col-description" />
	<col class="col-defined" />
</colgroup>
<tr>
  <th>Property</th><th>Type</th><th>Description</th><th>Defined By</th>
</tr>
<tr class="inherited" id="attributes">
  <td><a href="http://www.yiiframework.com/doc/api/1.1/CActiveRecord/#attributes-detail">attributes</a></td>
  <td>array</td>
  <td>Returns all column attribute values.</td>
  <td><a href="http://www.yiiframework.com/doc/api/1.1/CActiveRecord">CActiveRecord</a></td>
</tr>
<tr id="collects">
  <td><a href="User.html#collects-detail">collects</a></td>
  <td>Collect[]</td>
  <td></td>
  <td>User</td>
</tr>
<tr class="inherited" id="commandBuilder">
  <td><a href="http://www.yiiframework.com/doc/api/1.1/CActiveRecord/#commandBuilder-detail">commandBuilder</a></td>
  <td><a href="http://www.yiiframework.com/doc/api/1.1/CDbCommandBuilder">CDbCommandBuilder</a></td>
  <td>Returns the command builder used by this AR.</td>
  <td><a href="http://www.yiiframework.com/doc/api/1.1/CActiveRecord">CActiveRecord</a></td>
</tr>
<tr id="comments">
  <td><a href="User.html#comments-detail">comments</a></td>
  <td>Comments[]</td>
  <td></td>
  <td>User</td>
</tr>
<tr id="createTime">
  <td><a href="User.html#createTime-detail">createTime</a></td>
  <td>string</td>
  <td>创建时间</td>
  <td>User</td>
</tr>
<tr class="inherited" id="db">
  <td><a href="http://www.yiiframework.com/doc/api/1.1/CActiveRecord/#db-detail">db</a></td>
  <td><a href="http://www.yiiframework.com/doc/api/1.1/CDbConnection">CDbConnection</a></td>
  <td>the default database connection for all active record classes.</td>
  <td><a href="http://www.yiiframework.com/doc/api/1.1/CActiveRecord">CActiveRecord</a></td>
</tr>
<tr class="inherited" id="dbConnection">
  <td><a href="http://www.yiiframework.com/doc/api/1.1/CActiveRecord/#dbConnection-detail">dbConnection</a></td>
  <td><a href="http://www.yiiframework.com/doc/api/1.1/CDbConnection">CDbConnection</a></td>
  <td>Returns the database connection used by active record.</td>
  <td><a href="http://www.yiiframework.com/doc/api/1.1/CActiveRecord">CActiveRecord</a></td>
</tr>
<tr class="inherited" id="dbCriteria">
  <td><a href="http://www.yiiframework.com/doc/api/1.1/CActiveRecord/#dbCriteria-detail">dbCriteria</a></td>
  <td><a href="http://www.yiiframework.com/doc/api/1.1/CDbCriteria">CDbCriteria</a></td>
  <td>Returns the query criteria associated with this model.</td>
  <td><a href="http://www.yiiframework.com/doc/api/1.1/CActiveRecord">CActiveRecord</a></td>
</tr>
<tr id="editTime">
  <td><a href="User.html#editTime-detail">editTime</a></td>
  <td>string</td>
  <td>修改时间</td>
  <td>User</td>
</tr>
<tr class="inherited" id="errors">
  <td><a href="http://www.yiiframework.com/doc/api/1.1/CModel/#errors-detail">errors</a></td>
  <td>array</td>
  <td>Returns the errors for all attribute or a single attribute.</td>
  <td><a href="http://www.yiiframework.com/doc/api/1.1/CModel">CModel</a></td>
</tr>
<tr id="giveNotices">
  <td><a href="User.html#giveNotices-detail">giveNotices</a></td>
  <td>Notice[]</td>
  <td></td>
  <td>User</td>
</tr>
<tr id="id">
  <td><a href="User.html#id-detail">id</a></td>
  <td>string</td>
  <td>编号</td>
  <td>User</td>
</tr>
<tr id="introduction">
  <td><a href="User.html#introduction-detail">introduction</a></td>
  <td><a href="Introduction.html">Introduction</a></td>
  <td></td>
  <td>User</td>
</tr>
<tr id="isComplete">
  <td><a href="User.html#isComplete-detail">isComplete</a></td>
  <td>integer</td>
  <td>是否完善资料</td>
  <td>User</td>
</tr>
<tr id="isDelete">
  <td><a href="User.html#isDelete-detail">isDelete</a></td>
  <td>integer</td>
  <td>是否删除用户</td>
  <td>User</td>
</tr>
<tr class="inherited" id="isNewRecord">
  <td><a href="http://www.yiiframework.com/doc/api/1.1/CActiveRecord/#isNewRecord-detail">isNewRecord</a></td>
  <td>boolean</td>
  <td>Returns if the current record is new.</td>
  <td><a href="http://www.yiiframework.com/doc/api/1.1/CActiveRecord">CActiveRecord</a></td>
</tr>
<tr class="inherited" id="iterator">
  <td><a href="http://www.yiiframework.com/doc/api/1.1/CModel/#iterator-detail">iterator</a></td>
  <td><a href="http://www.yiiframework.com/doc/api/1.1/CMapIterator">CMapIterator</a></td>
  <td>Returns an iterator for traversing the attributes in the model.</td>
  <td><a href="http://www.yiiframework.com/doc/api/1.1/CModel">CModel</a></td>
</tr>
<tr id="messages">
  <td><a href="User.html#messages-detail">messages</a></td>
  <td>Messages[]</td>
  <td></td>
  <td>User</td>
</tr>
<tr id="messagesDetails">
  <td><a href="User.html#messagesDetails-detail">messagesDetails</a></td>
  <td>MessagesDetails[]</td>
  <td></td>
  <td>User</td>
</tr>
<tr id="messagesOptions">
  <td><a href="User.html#messagesOptions-detail">messagesOptions</a></td>
  <td>MessagesOption[]</td>
  <td></td>
  <td>User</td>
</tr>
<tr class="inherited" id="metaData">
  <td><a href="http://www.yiiframework.com/doc/api/1.1/CActiveRecord/#metaData-detail">metaData</a></td>
  <td><a href="http://www.yiiframework.com/doc/api/1.1/CActiveRecordMetaData">CActiveRecordMetaData</a></td>
  <td>Returns the meta-data for this AR</td>
  <td><a href="http://www.yiiframework.com/doc/api/1.1/CActiveRecord">CActiveRecord</a></td>
</tr>
<tr id="noticeOptions">
  <td><a href="User.html#noticeOptions-detail">noticeOptions</a></td>
  <td>NoticeOption[]</td>
  <td></td>
  <td>User</td>
</tr>
<tr id="noticeUserDeletes">
  <td><a href="User.html#noticeUserDeletes-detail">noticeUserDeletes</a></td>
  <td>NoticeUserDelete[]</td>
  <td></td>
  <td>User</td>
</tr>
<tr class="inherited" id="oldPrimaryKey">
  <td><a href="http://www.yiiframework.com/doc/api/1.1/CActiveRecord/#oldPrimaryKey-detail">oldPrimaryKey</a></td>
  <td>mixed</td>
  <td>Returns the old primary key value.</td>
  <td><a href="http://www.yiiframework.com/doc/api/1.1/CActiveRecord">CActiveRecord</a></td>
</tr>
<tr id="order">
  <td><a href="User.html#order-detail">order</a></td>
  <td>string</td>
  <td>排序</td>
  <td>User</td>
</tr>
<tr id="password">
  <td><a href="User.html#password-detail">password</a></td>
  <td>string</td>
  <td>密码，sha1加密</td>
  <td>User</td>
</tr>
<tr id="phone">
  <td><a href="User.html#phone-detail">phone</a></td>
  <td>string</td>
  <td>手机号码</td>
  <td>User</td>
</tr>
<tr class="inherited" id="primaryKey">
  <td><a href="http://www.yiiframework.com/doc/api/1.1/CActiveRecord/#primaryKey-detail">primaryKey</a></td>
  <td>mixed</td>
  <td>Returns the primary key value.</td>
  <td><a href="http://www.yiiframework.com/doc/api/1.1/CActiveRecord">CActiveRecord</a></td>
</tr>
<tr id="profile">
  <td><a href="User.html#profile-detail">profile</a></td>
  <td><a href="Profile.html">Profile</a></td>
  <td></td>
  <td>User</td>
</tr>
<tr id="receiveNotices">
  <td><a href="User.html#receiveNotices-detail">receiveNotices</a></td>
  <td>Notice[]</td>
  <td></td>
  <td>User</td>
</tr>
<tr id="role">
  <td><a href="User.html#role-detail">role</a></td>
  <td><a href="Role.html">Role</a></td>
  <td></td>
  <td>User</td>
</tr>
<tr id="roleId">
  <td><a href="User.html#roleId-detail">roleId</a></td>
  <td>string</td>
  <td>角色ID</td>
  <td>User</td>
</tr>
<tr class="inherited" id="safeAttributeNames">
  <td><a href="http://www.yiiframework.com/doc/api/1.1/CModel/#safeAttributeNames-detail">safeAttributeNames</a></td>
  <td>array</td>
  <td>Returns the attribute names that are safe to be massively assigned.</td>
  <td><a href="http://www.yiiframework.com/doc/api/1.1/CModel">CModel</a></td>
</tr>
<tr class="inherited" id="scenario">
  <td><a href="http://www.yiiframework.com/doc/api/1.1/CModel/#scenario-detail">scenario</a></td>
  <td>string</td>
  <td>Returns the scenario that this model is used in.</td>
  <td><a href="http://www.yiiframework.com/doc/api/1.1/CModel">CModel</a></td>
</tr>
<tr class="inherited" id="tableAlias">
  <td><a href="http://www.yiiframework.com/doc/api/1.1/CActiveRecord/#tableAlias-detail">tableAlias</a></td>
  <td>string</td>
  <td>Returns the table alias to be used by the find methods.</td>
  <td><a href="http://www.yiiframework.com/doc/api/1.1/CActiveRecord">CActiveRecord</a></td>
</tr>
<tr class="inherited" id="tableSchema">
  <td><a href="http://www.yiiframework.com/doc/api/1.1/CActiveRecord/#tableSchema-detail">tableSchema</a></td>
  <td><a href="http://www.yiiframework.com/doc/api/1.1/CDbTableSchema">CDbTableSchema</a></td>
  <td>Returns the metadata of the table that this AR belongs to</td>
  <td><a href="http://www.yiiframework.com/doc/api/1.1/CActiveRecord">CActiveRecord</a></td>
</tr>
<tr id="teach">
  <td><a href="User.html#teach-detail">teach</a></td>
  <td><a href="Teach.html">Teach</a></td>
  <td></td>
  <td>User</td>
</tr>
<tr id="teachCourseSignUps">
  <td><a href="User.html#teachCourseSignUps-detail">teachCourseSignUps</a></td>
  <td>TeachCourseSignUp[]</td>
  <td></td>
  <td>User</td>
</tr>
<tr id="teachCourses">
  <td><a href="User.html#teachCourses-detail">teachCourses</a></td>
  <td>TeachCourse[]</td>
  <td></td>
  <td>User</td>
</tr>
<tr id="teachStars">
  <td><a href="User.html#teachStars-detail">teachStars</a></td>
  <td>TeachStar[]</td>
  <td></td>
  <td>User</td>
</tr>
<tr id="teachVideoStars">
  <td><a href="User.html#teachVideoStars-detail">teachVideoStars</a></td>
  <td>TeachVideoStar[]</td>
  <td></td>
  <td>User</td>
</tr>
<tr id="teachVideos">
  <td><a href="User.html#teachVideos-detail">teachVideos</a></td>
  <td>TeachVideo[]</td>
  <td></td>
  <td>User</td>
</tr>
<tr id="userAuth">
  <td><a href="User.html#userAuth-detail">userAuth</a></td>
  <td><a href="UserAuth.html">UserAuth</a></td>
  <td></td>
  <td>User</td>
</tr>
<tr id="userBindings">
  <td><a href="User.html#userBindings-detail">userBindings</a></td>
  <td>UserBinding[]</td>
  <td></td>
  <td>User</td>
</tr>
<tr id="userCategories">
  <td><a href="User.html#userCategories-detail">userCategories</a></td>
  <td>UserCategory[]</td>
  <td></td>
  <td>User</td>
</tr>
<tr id="userCities">
  <td><a href="User.html#userCities-detail">userCities</a></td>
  <td>UserCity[]</td>
  <td></td>
  <td>User</td>
</tr>
<tr id="userLocation">
  <td><a href="User.html#userLocation-detail">userLocation</a></td>
  <td><a href="UserLocation.html">UserLocation</a></td>
  <td></td>
  <td>User</td>
</tr>
<tr id="userSessions">
  <td><a href="User.html#userSessions-detail">userSessions</a></td>
  <td>UserSession[]</td>
  <td></td>
  <td>User</td>
</tr>
<tr id="userSetting">
  <td><a href="User.html#userSetting-detail">userSetting</a></td>
  <td><a href="UserSetting.html">UserSetting</a></td>
  <td></td>
  <td>User</td>
</tr>
<tr id="userVipSigns">
  <td><a href="User.html#userVipSigns-detail">userVipSigns</a></td>
  <td>UserVipSign[]</td>
  <td></td>
  <td>User</td>
</tr>
<tr class="inherited" id="validatorList">
  <td><a href="http://www.yiiframework.com/doc/api/1.1/CModel/#validatorList-detail">validatorList</a></td>
  <td><a href="http://www.yiiframework.com/doc/api/1.1/CList">CList</a></td>
  <td>Returns all the validators declared in the model.</td>
  <td><a href="http://www.yiiframework.com/doc/api/1.1/CModel">CModel</a></td>
</tr>
<tr class="inherited" id="validators">
  <td><a href="http://www.yiiframework.com/doc/api/1.1/CModel/#validators-detail">validators</a></td>
  <td>array</td>
  <td>Returns the validators applicable to the current <a href="User.html#scenario">scenario</a>.</td>
  <td><a href="http://www.yiiframework.com/doc/api/1.1/CModel">CModel</a></td>
</tr>
</table>
</div>

<a name="methods"></a>

<div class="summary docMethod">
<h2>Public Methods</h2>

<p><a href="#" class="toggle">Hide inherited methods</a></p>

<table class="summaryTable">
<colgroup>
	<col class="col-method" />
	<col class="col-description" />
	<col class="col-defined" />
</colgroup>
<tr>
  <th>Method</th><th>Description</th><th>Defined By</th>
</tr>
<tr class="inherited" id="__call">
  <td><a href="http://www.yiiframework.com/doc/api/1.1/CActiveRecord/#__call-detail">__call()</a></td>
  <td>Calls the named method which is not a class method.</td>
  <td><a href="http://www.yiiframework.com/doc/api/1.1/CActiveRecord">CActiveRecord</a></td>
</tr>
<tr class="inherited" id="__construct">
  <td><a href="http://www.yiiframework.com/doc/api/1.1/CActiveRecord/#__construct-detail">__construct()</a></td>
  <td>Constructor.</td>
  <td><a href="http://www.yiiframework.com/doc/api/1.1/CActiveRecord">CActiveRecord</a></td>
</tr>
<tr class="inherited" id="__get">
  <td><a href="http://www.yiiframework.com/doc/api/1.1/CActiveRecord/#__get-detail">__get()</a></td>
  <td>PHP getter magic method.</td>
  <td><a href="http://www.yiiframework.com/doc/api/1.1/CActiveRecord">CActiveRecord</a></td>
</tr>
<tr class="inherited" id="__isset">
  <td><a href="http://www.yiiframework.com/doc/api/1.1/CActiveRecord/#__isset-detail">__isset()</a></td>
  <td>Checks if a property value is null.</td>
  <td><a href="http://www.yiiframework.com/doc/api/1.1/CActiveRecord">CActiveRecord</a></td>
</tr>
<tr class="inherited" id="__set">
  <td><a href="http://www.yiiframework.com/doc/api/1.1/CActiveRecord/#__set-detail">__set()</a></td>
  <td>PHP setter magic method.</td>
  <td><a href="http://www.yiiframework.com/doc/api/1.1/CActiveRecord">CActiveRecord</a></td>
</tr>
<tr class="inherited" id="__sleep">
  <td><a href="http://www.yiiframework.com/doc/api/1.1/CActiveRecord/#__sleep-detail">__sleep()</a></td>
  <td>PHP sleep magic method.</td>
  <td><a href="http://www.yiiframework.com/doc/api/1.1/CActiveRecord">CActiveRecord</a></td>
</tr>
<tr class="inherited" id="__unset">
  <td><a href="http://www.yiiframework.com/doc/api/1.1/CActiveRecord/#__unset-detail">__unset()</a></td>
  <td>Sets a component property to be null.</td>
  <td><a href="http://www.yiiframework.com/doc/api/1.1/CActiveRecord">CActiveRecord</a></td>
</tr>
<tr class="inherited" id="addError">
  <td><a href="http://www.yiiframework.com/doc/api/1.1/CModel/#addError-detail">addError()</a></td>
  <td>Adds a new error to the specified attribute.</td>
  <td><a href="http://www.yiiframework.com/doc/api/1.1/CModel">CModel</a></td>
</tr>
<tr class="inherited" id="addErrors">
  <td><a href="http://www.yiiframework.com/doc/api/1.1/CModel/#addErrors-detail">addErrors()</a></td>
  <td>Adds a list of errors.</td>
  <td><a href="http://www.yiiframework.com/doc/api/1.1/CModel">CModel</a></td>
</tr>
<tr class="inherited" id="addRelatedRecord">
  <td><a href="http://www.yiiframework.com/doc/api/1.1/CActiveRecord/#addRelatedRecord-detail">addRelatedRecord()</a></td>
  <td>Do not call this method. This method is used internally by CActiveFinder to populate</td>
  <td><a href="http://www.yiiframework.com/doc/api/1.1/CActiveRecord">CActiveRecord</a></td>
</tr>
<tr class="inherited" id="afterFindInternal">
  <td><a href="http://www.yiiframework.com/doc/api/1.1/CActiveRecord/#afterFindInternal-detail">afterFindInternal()</a></td>
  <td>Calls <a href="User.html#afterFind">afterFind</a>.</td>
  <td><a href="http://www.yiiframework.com/doc/api/1.1/CActiveRecord">CActiveRecord</a></td>
</tr>
<tr class="inherited" id="applyScopes">
  <td><a href="http://www.yiiframework.com/doc/api/1.1/CActiveRecord/#applyScopes-detail">applyScopes()</a></td>
  <td>Applies the query scopes to the given criteria.</td>
  <td><a href="http://www.yiiframework.com/doc/api/1.1/CActiveRecord">CActiveRecord</a></td>
</tr>
<tr class="inherited" id="asa">
  <td><a href="http://www.yiiframework.com/doc/api/1.1/CComponent/#asa-detail">asa()</a></td>
  <td>Returns the named behavior object.</td>
  <td><a href="http://www.yiiframework.com/doc/api/1.1/CComponent">CComponent</a></td>
</tr>
<tr class="inherited" id="attachBehavior">
  <td><a href="http://www.yiiframework.com/doc/api/1.1/CComponent/#attachBehavior-detail">attachBehavior()</a></td>
  <td>Attaches a behavior to this component.</td>
  <td><a href="http://www.yiiframework.com/doc/api/1.1/CComponent">CComponent</a></td>
</tr>
<tr class="inherited" id="attachBehaviors">
  <td><a href="http://www.yiiframework.com/doc/api/1.1/CComponent/#attachBehaviors-detail">attachBehaviors()</a></td>
  <td>Attaches a list of behaviors to the component.</td>
  <td><a href="http://www.yiiframework.com/doc/api/1.1/CComponent">CComponent</a></td>
</tr>
<tr class="inherited" id="attachEventHandler">
  <td><a href="http://www.yiiframework.com/doc/api/1.1/CComponent/#attachEventHandler-detail">attachEventHandler()</a></td>
  <td>Attaches an event handler to an event.</td>
  <td><a href="http://www.yiiframework.com/doc/api/1.1/CComponent">CComponent</a></td>
</tr>
<tr id="attributeLabels">
  <td><a href="User.html#attributeLabels-detail">attributeLabels()</a></td>
  <td></td>
  <td>User</td>
</tr>
<tr class="inherited" id="attributeNames">
  <td><a href="http://www.yiiframework.com/doc/api/1.1/CActiveRecord/#attributeNames-detail">attributeNames()</a></td>
  <td>Returns the list of all attribute names of the model.</td>
  <td><a href="http://www.yiiframework.com/doc/api/1.1/CActiveRecord">CActiveRecord</a></td>
</tr>
<tr class="inherited" id="beforeFindInternal">
  <td><a href="http://www.yiiframework.com/doc/api/1.1/CActiveRecord/#beforeFindInternal-detail">beforeFindInternal()</a></td>
  <td>Calls <a href="User.html#beforeFind">beforeFind</a>.</td>
  <td><a href="http://www.yiiframework.com/doc/api/1.1/CActiveRecord">CActiveRecord</a></td>
</tr>
<tr class="inherited" id="behaviors">
  <td><a href="http://www.yiiframework.com/doc/api/1.1/CModel/#behaviors-detail">behaviors()</a></td>
  <td>Returns a list of behaviors that this model should behave as.</td>
  <td><a href="http://www.yiiframework.com/doc/api/1.1/CModel">CModel</a></td>
</tr>
<tr class="inherited" id="cache">
  <td><a href="http://www.yiiframework.com/doc/api/1.1/CActiveRecord/#cache-detail">cache()</a></td>
  <td>Sets the parameters about query caching.</td>
  <td><a href="http://www.yiiframework.com/doc/api/1.1/CActiveRecord">CActiveRecord</a></td>
</tr>
<tr class="inherited" id="canGetProperty">
  <td><a href="http://www.yiiframework.com/doc/api/1.1/CComponent/#canGetProperty-detail">canGetProperty()</a></td>
  <td>Determines whether a property can be read.</td>
  <td><a href="http://www.yiiframework.com/doc/api/1.1/CComponent">CComponent</a></td>
</tr>
<tr class="inherited" id="canSetProperty">
  <td><a href="http://www.yiiframework.com/doc/api/1.1/CComponent/#canSetProperty-detail">canSetProperty()</a></td>
  <td>Determines whether a property can be set.</td>
  <td><a href="http://www.yiiframework.com/doc/api/1.1/CComponent">CComponent</a></td>
</tr>
<tr class="inherited" id="clearErrors">
  <td><a href="http://www.yiiframework.com/doc/api/1.1/CModel/#clearErrors-detail">clearErrors()</a></td>
  <td>Removes errors for all attributes or a single attribute.</td>
  <td><a href="http://www.yiiframework.com/doc/api/1.1/CModel">CModel</a></td>
</tr>
<tr class="inherited" id="count">
  <td><a href="http://www.yiiframework.com/doc/api/1.1/CActiveRecord/#count-detail">count()</a></td>
  <td>Finds the number of rows satisfying the specified query condition.</td>
  <td><a href="http://www.yiiframework.com/doc/api/1.1/CActiveRecord">CActiveRecord</a></td>
</tr>
<tr class="inherited" id="countByAttributes">
  <td><a href="http://www.yiiframework.com/doc/api/1.1/CActiveRecord/#countByAttributes-detail">countByAttributes()</a></td>
  <td>Finds the number of rows that have the specified attribute values.</td>
  <td><a href="http://www.yiiframework.com/doc/api/1.1/CActiveRecord">CActiveRecord</a></td>
</tr>
<tr class="inherited" id="countBySql">
  <td><a href="http://www.yiiframework.com/doc/api/1.1/CActiveRecord/#countBySql-detail">countBySql()</a></td>
  <td>Finds the number of rows using the given SQL statement.</td>
  <td><a href="http://www.yiiframework.com/doc/api/1.1/CActiveRecord">CActiveRecord</a></td>
</tr>
<tr id="createAccount">
  <td><a href="User.html#createAccount-detail">createAccount()</a></td>
  <td>创建账号</td>
  <td>User</td>
</tr>
<tr class="inherited" id="createValidators">
  <td><a href="http://www.yiiframework.com/doc/api/1.1/CModel/#createValidators-detail">createValidators()</a></td>
  <td>Creates validator objects based on the specification in <a href="User.html#rules">rules</a>.</td>
  <td><a href="http://www.yiiframework.com/doc/api/1.1/CModel">CModel</a></td>
</tr>
<tr class="inherited" id="defaultScope">
  <td><a href="http://www.yiiframework.com/doc/api/1.1/CActiveRecord/#defaultScope-detail">defaultScope()</a></td>
  <td>Returns the default named scope that should be implicitly applied to all queries for this model.</td>
  <td><a href="http://www.yiiframework.com/doc/api/1.1/CActiveRecord">CActiveRecord</a></td>
</tr>
<tr class="inherited" id="delete">
  <td><a href="http://www.yiiframework.com/doc/api/1.1/CActiveRecord/#delete-detail">delete()</a></td>
  <td>Deletes the row corresponding to this active record.</td>
  <td><a href="http://www.yiiframework.com/doc/api/1.1/CActiveRecord">CActiveRecord</a></td>
</tr>
<tr class="inherited" id="deleteAll">
  <td><a href="http://www.yiiframework.com/doc/api/1.1/CActiveRecord/#deleteAll-detail">deleteAll()</a></td>
  <td>Deletes rows with the specified condition.</td>
  <td><a href="http://www.yiiframework.com/doc/api/1.1/CActiveRecord">CActiveRecord</a></td>
</tr>
<tr class="inherited" id="deleteAllByAttributes">
  <td><a href="http://www.yiiframework.com/doc/api/1.1/CActiveRecord/#deleteAllByAttributes-detail">deleteAllByAttributes()</a></td>
  <td>Deletes rows which match the specified attribute values.</td>
  <td><a href="http://www.yiiframework.com/doc/api/1.1/CActiveRecord">CActiveRecord</a></td>
</tr>
<tr class="inherited" id="deleteByPk">
  <td><a href="http://www.yiiframework.com/doc/api/1.1/CActiveRecord/#deleteByPk-detail">deleteByPk()</a></td>
  <td>Deletes rows with the specified primary key.</td>
  <td><a href="http://www.yiiframework.com/doc/api/1.1/CActiveRecord">CActiveRecord</a></td>
</tr>
<tr class="inherited" id="detachBehavior">
  <td><a href="http://www.yiiframework.com/doc/api/1.1/CComponent/#detachBehavior-detail">detachBehavior()</a></td>
  <td>Detaches a behavior from the component.</td>
  <td><a href="http://www.yiiframework.com/doc/api/1.1/CComponent">CComponent</a></td>
</tr>
<tr class="inherited" id="detachBehaviors">
  <td><a href="http://www.yiiframework.com/doc/api/1.1/CComponent/#detachBehaviors-detail">detachBehaviors()</a></td>
  <td>Detaches all behaviors from the component.</td>
  <td><a href="http://www.yiiframework.com/doc/api/1.1/CComponent">CComponent</a></td>
</tr>
<tr class="inherited" id="detachEventHandler">
  <td><a href="http://www.yiiframework.com/doc/api/1.1/CComponent/#detachEventHandler-detail">detachEventHandler()</a></td>
  <td>Detaches an existing event handler.</td>
  <td><a href="http://www.yiiframework.com/doc/api/1.1/CComponent">CComponent</a></td>
</tr>
<tr class="inherited" id="disableBehavior">
  <td><a href="http://www.yiiframework.com/doc/api/1.1/CComponent/#disableBehavior-detail">disableBehavior()</a></td>
  <td>Disables an attached behavior.</td>
  <td><a href="http://www.yiiframework.com/doc/api/1.1/CComponent">CComponent</a></td>
</tr>
<tr class="inherited" id="disableBehaviors">
  <td><a href="http://www.yiiframework.com/doc/api/1.1/CComponent/#disableBehaviors-detail">disableBehaviors()</a></td>
  <td>Disables all behaviors attached to this component.</td>
  <td><a href="http://www.yiiframework.com/doc/api/1.1/CComponent">CComponent</a></td>
</tr>
<tr id="disableUser">
  <td><a href="User.html#disableUser-detail">disableUser()</a></td>
  <td>逻辑删除账号，冻结</td>
  <td>User</td>
</tr>
<tr class="inherited" id="enableBehavior">
  <td><a href="http://www.yiiframework.com/doc/api/1.1/CComponent/#enableBehavior-detail">enableBehavior()</a></td>
  <td>Enables an attached behavior.</td>
  <td><a href="http://www.yiiframework.com/doc/api/1.1/CComponent">CComponent</a></td>
</tr>
<tr class="inherited" id="enableBehaviors">
  <td><a href="http://www.yiiframework.com/doc/api/1.1/CComponent/#enableBehaviors-detail">enableBehaviors()</a></td>
  <td>Enables all behaviors attached to this component.</td>
  <td><a href="http://www.yiiframework.com/doc/api/1.1/CComponent">CComponent</a></td>
</tr>
<tr class="inherited" id="equals">
  <td><a href="http://www.yiiframework.com/doc/api/1.1/CActiveRecord/#equals-detail">equals()</a></td>
  <td>Compares current active record with another one.</td>
  <td><a href="http://www.yiiframework.com/doc/api/1.1/CActiveRecord">CActiveRecord</a></td>
</tr>
<tr class="inherited" id="evaluateExpression">
  <td><a href="http://www.yiiframework.com/doc/api/1.1/CComponent/#evaluateExpression-detail">evaluateExpression()</a></td>
  <td>Evaluates a PHP expression or callback under the context of this component.</td>
  <td><a href="http://www.yiiframework.com/doc/api/1.1/CComponent">CComponent</a></td>
</tr>
<tr class="inherited" id="exists">
  <td><a href="http://www.yiiframework.com/doc/api/1.1/CActiveRecord/#exists-detail">exists()</a></td>
  <td>Checks whether there is row satisfying the specified condition.</td>
  <td><a href="http://www.yiiframework.com/doc/api/1.1/CActiveRecord">CActiveRecord</a></td>
</tr>
<tr class="inherited" id="find">
  <td><a href="http://www.yiiframework.com/doc/api/1.1/CActiveRecord/#find-detail">find()</a></td>
  <td>Finds a single active record with the specified condition.</td>
  <td><a href="http://www.yiiframework.com/doc/api/1.1/CActiveRecord">CActiveRecord</a></td>
</tr>
<tr class="inherited" id="findAll">
  <td><a href="http://www.yiiframework.com/doc/api/1.1/CActiveRecord/#findAll-detail">findAll()</a></td>
  <td>Finds all active records satisfying the specified condition.</td>
  <td><a href="http://www.yiiframework.com/doc/api/1.1/CActiveRecord">CActiveRecord</a></td>
</tr>
<tr class="inherited" id="findAllByAttributes">
  <td><a href="http://www.yiiframework.com/doc/api/1.1/CActiveRecord/#findAllByAttributes-detail">findAllByAttributes()</a></td>
  <td>Finds all active records that have the specified attribute values.</td>
  <td><a href="http://www.yiiframework.com/doc/api/1.1/CActiveRecord">CActiveRecord</a></td>
</tr>
<tr class="inherited" id="findAllByPk">
  <td><a href="http://www.yiiframework.com/doc/api/1.1/CActiveRecord/#findAllByPk-detail">findAllByPk()</a></td>
  <td>Finds all active records with the specified primary keys.</td>
  <td><a href="http://www.yiiframework.com/doc/api/1.1/CActiveRecord">CActiveRecord</a></td>
</tr>
<tr class="inherited" id="findAllBySql">
  <td><a href="http://www.yiiframework.com/doc/api/1.1/CActiveRecord/#findAllBySql-detail">findAllBySql()</a></td>
  <td>Finds all active records using the specified SQL statement.</td>
  <td><a href="http://www.yiiframework.com/doc/api/1.1/CActiveRecord">CActiveRecord</a></td>
</tr>
<tr class="inherited" id="findByAttributes">
  <td><a href="http://www.yiiframework.com/doc/api/1.1/CActiveRecord/#findByAttributes-detail">findByAttributes()</a></td>
  <td>Finds a single active record that has the specified attribute values.</td>
  <td><a href="http://www.yiiframework.com/doc/api/1.1/CActiveRecord">CActiveRecord</a></td>
</tr>
<tr class="inherited" id="findByPk">
  <td><a href="http://www.yiiframework.com/doc/api/1.1/CActiveRecord/#findByPk-detail">findByPk()</a></td>
  <td>Finds a single active record with the specified primary key.</td>
  <td><a href="http://www.yiiframework.com/doc/api/1.1/CActiveRecord">CActiveRecord</a></td>
</tr>
<tr class="inherited" id="findBySql">
  <td><a href="http://www.yiiframework.com/doc/api/1.1/CActiveRecord/#findBySql-detail">findBySql()</a></td>
  <td>Finds a single active record with the specified SQL statement.</td>
  <td><a href="http://www.yiiframework.com/doc/api/1.1/CActiveRecord">CActiveRecord</a></td>
</tr>
<tr class="inherited" id="generateAttributeLabel">
  <td><a href="http://www.yiiframework.com/doc/api/1.1/CModel/#generateAttributeLabel-detail">generateAttributeLabel()</a></td>
  <td>Generates a user friendly attribute label.</td>
  <td><a href="http://www.yiiframework.com/doc/api/1.1/CModel">CModel</a></td>
</tr>
<tr class="inherited" id="getActiveRelation">
  <td><a href="http://www.yiiframework.com/doc/api/1.1/CActiveRecord/#getActiveRelation-detail">getActiveRelation()</a></td>
  <td>Returns the named relation declared for this AR class.</td>
  <td><a href="http://www.yiiframework.com/doc/api/1.1/CActiveRecord">CActiveRecord</a></td>
</tr>
<tr class="inherited" id="getAttribute">
  <td><a href="http://www.yiiframework.com/doc/api/1.1/CActiveRecord/#getAttribute-detail">getAttribute()</a></td>
  <td>Returns the named attribute value.</td>
  <td><a href="http://www.yiiframework.com/doc/api/1.1/CActiveRecord">CActiveRecord</a></td>
</tr>
<tr class="inherited" id="getAttributeLabel">
  <td><a href="http://www.yiiframework.com/doc/api/1.1/CActiveRecord/#getAttributeLabel-detail">getAttributeLabel()</a></td>
  <td>Returns the text label for the specified attribute.</td>
  <td><a href="http://www.yiiframework.com/doc/api/1.1/CActiveRecord">CActiveRecord</a></td>
</tr>
<tr class="inherited" id="getAttributes">
  <td><a href="http://www.yiiframework.com/doc/api/1.1/CActiveRecord/#getAttributes-detail">getAttributes()</a></td>
  <td>Returns all column attribute values.</td>
  <td><a href="http://www.yiiframework.com/doc/api/1.1/CActiveRecord">CActiveRecord</a></td>
</tr>
<tr id="getByPhoneAndPassword">
  <td><a href="User.html#getByPhoneAndPassword-detail">getByPhoneAndPassword()</a></td>
  <td>根据电话号码和密码取得用户数据，适用于老师或学生在手机端登录。</td>
  <td>User</td>
</tr>
<tr id="getByUsernameAndPassword">
  <td><a href="User.html#getByUsernameAndPassword-detail">getByUsernameAndPassword()</a></td>
  <td>根据账号和密码获得用户，适用于管理员在网站登录</td>
  <td>User</td>
</tr>
<tr class="inherited" id="getCommandBuilder">
  <td><a href="http://www.yiiframework.com/doc/api/1.1/CActiveRecord/#getCommandBuilder-detail">getCommandBuilder()</a></td>
  <td>Returns the command builder used by this AR.</td>
  <td><a href="http://www.yiiframework.com/doc/api/1.1/CActiveRecord">CActiveRecord</a></td>
</tr>
<tr class="inherited" id="getDbConnection">
  <td><a href="http://www.yiiframework.com/doc/api/1.1/CActiveRecord/#getDbConnection-detail">getDbConnection()</a></td>
  <td>Returns the database connection used by active record.</td>
  <td><a href="http://www.yiiframework.com/doc/api/1.1/CActiveRecord">CActiveRecord</a></td>
</tr>
<tr class="inherited" id="getDbCriteria">
  <td><a href="http://www.yiiframework.com/doc/api/1.1/CActiveRecord/#getDbCriteria-detail">getDbCriteria()</a></td>
  <td>Returns the query criteria associated with this model.</td>
  <td><a href="http://www.yiiframework.com/doc/api/1.1/CActiveRecord">CActiveRecord</a></td>
</tr>
<tr class="inherited" id="getError">
  <td><a href="http://www.yiiframework.com/doc/api/1.1/CModel/#getError-detail">getError()</a></td>
  <td>Returns the first error of the specified attribute.</td>
  <td><a href="http://www.yiiframework.com/doc/api/1.1/CModel">CModel</a></td>
</tr>
<tr class="inherited" id="getErrors">
  <td><a href="http://www.yiiframework.com/doc/api/1.1/CModel/#getErrors-detail">getErrors()</a></td>
  <td>Returns the errors for all attribute or a single attribute.</td>
  <td><a href="http://www.yiiframework.com/doc/api/1.1/CModel">CModel</a></td>
</tr>
<tr class="inherited" id="getEventHandlers">
  <td><a href="http://www.yiiframework.com/doc/api/1.1/CComponent/#getEventHandlers-detail">getEventHandlers()</a></td>
  <td>Returns the list of attached event handlers for an event.</td>
  <td><a href="http://www.yiiframework.com/doc/api/1.1/CComponent">CComponent</a></td>
</tr>
<tr class="inherited" id="getIsNewRecord">
  <td><a href="http://www.yiiframework.com/doc/api/1.1/CActiveRecord/#getIsNewRecord-detail">getIsNewRecord()</a></td>
  <td>Returns if the current record is new.</td>
  <td><a href="http://www.yiiframework.com/doc/api/1.1/CActiveRecord">CActiveRecord</a></td>
</tr>
<tr class="inherited" id="getIterator">
  <td><a href="http://www.yiiframework.com/doc/api/1.1/CModel/#getIterator-detail">getIterator()</a></td>
  <td>Returns an iterator for traversing the attributes in the model.</td>
  <td><a href="http://www.yiiframework.com/doc/api/1.1/CModel">CModel</a></td>
</tr>
<tr id="getList">
  <td><a href="User.html#getList-detail">getList()</a></td>
  <td>根据用户经纬度获取附近的机构或老师，目前因为数据较小，以及用户较小，查询时，后台处理了距离，并分页。</td>
  <td>User</td>
</tr>
<tr id="getListCount">
  <td><a href="User.html#getListCount-detail">getListCount()</a></td>
  <td>获得查询附近的老师或机构（getList）所返回的总条数</td>
  <td>User</td>
</tr>
<tr class="inherited" id="getMetaData">
  <td><a href="http://www.yiiframework.com/doc/api/1.1/CActiveRecord/#getMetaData-detail">getMetaData()</a></td>
  <td>Returns the meta-data for this AR</td>
  <td><a href="http://www.yiiframework.com/doc/api/1.1/CActiveRecord">CActiveRecord</a></td>
</tr>
<tr class="inherited" id="getOldPrimaryKey">
  <td><a href="http://www.yiiframework.com/doc/api/1.1/CActiveRecord/#getOldPrimaryKey-detail">getOldPrimaryKey()</a></td>
  <td>Returns the old primary key value.</td>
  <td><a href="http://www.yiiframework.com/doc/api/1.1/CActiveRecord">CActiveRecord</a></td>
</tr>
<tr id="getOrgList">
  <td><a href="User.html#getOrgList-detail">getOrgList()</a></td>
  <td>根据查询条件获得机构列表</td>
  <td>User</td>
</tr>
<tr id="getOrgListCount">
  <td><a href="User.html#getOrgListCount-detail">getOrgListCount()</a></td>
  <td>获得查询机构的总条数</td>
  <td>User</td>
</tr>
<tr class="inherited" id="getPrimaryKey">
  <td><a href="http://www.yiiframework.com/doc/api/1.1/CActiveRecord/#getPrimaryKey-detail">getPrimaryKey()</a></td>
  <td>Returns the primary key value.</td>
  <td><a href="http://www.yiiframework.com/doc/api/1.1/CActiveRecord">CActiveRecord</a></td>
</tr>
<tr class="inherited" id="getRelated">
  <td><a href="http://www.yiiframework.com/doc/api/1.1/CActiveRecord/#getRelated-detail">getRelated()</a></td>
  <td>Returns the related record(s).</td>
  <td><a href="http://www.yiiframework.com/doc/api/1.1/CActiveRecord">CActiveRecord</a></td>
</tr>
<tr class="inherited" id="getSafeAttributeNames">
  <td><a href="http://www.yiiframework.com/doc/api/1.1/CModel/#getSafeAttributeNames-detail">getSafeAttributeNames()</a></td>
  <td>Returns the attribute names that are safe to be massively assigned.</td>
  <td><a href="http://www.yiiframework.com/doc/api/1.1/CModel">CModel</a></td>
</tr>
<tr class="inherited" id="getScenario">
  <td><a href="http://www.yiiframework.com/doc/api/1.1/CModel/#getScenario-detail">getScenario()</a></td>
  <td>Returns the scenario that this model is used in.</td>
  <td><a href="http://www.yiiframework.com/doc/api/1.1/CModel">CModel</a></td>
</tr>
<tr id="getStuList">
  <td><a href="User.html#getStuList-detail">getStuList()</a></td>
  <td>根据查询条件获得学生列表</td>
  <td>User</td>
</tr>
<tr id="getStuListCount">
  <td><a href="User.html#getStuListCount-detail">getStuListCount()</a></td>
  <td>获得查询学生的总条数</td>
  <td>User</td>
</tr>
<tr class="inherited" id="getTableAlias">
  <td><a href="http://www.yiiframework.com/doc/api/1.1/CActiveRecord/#getTableAlias-detail">getTableAlias()</a></td>
  <td>Returns the table alias to be used by the find methods.</td>
  <td><a href="http://www.yiiframework.com/doc/api/1.1/CActiveRecord">CActiveRecord</a></td>
</tr>
<tr class="inherited" id="getTableSchema">
  <td><a href="http://www.yiiframework.com/doc/api/1.1/CActiveRecord/#getTableSchema-detail">getTableSchema()</a></td>
  <td>Returns the metadata of the table that this AR belongs to</td>
  <td><a href="http://www.yiiframework.com/doc/api/1.1/CActiveRecord">CActiveRecord</a></td>
</tr>
<tr id="getTeacherList">
  <td><a href="User.html#getTeacherList-detail">getTeacherList()</a></td>
  <td>根据查询条件获得老师列表</td>
  <td>User</td>
</tr>
<tr id="getTeacherListCount">
  <td><a href="User.html#getTeacherListCount-detail">getTeacherListCount()</a></td>
  <td>获得查询老师的总条数</td>
  <td>User</td>
</tr>
<tr id="getUserByPkAndPassword">
  <td><a href="User.html#getUserByPkAndPassword-detail">getUserByPkAndPassword()</a></td>
  <td>根据用户ID和密码获得用户。</td>
  <td>User</td>
</tr>
<tr id="getUserByphone">
  <td><a href="User.html#getUserByphone-detail">getUserByphone()</a></td>
  <td>根据手机号码获得用户数据</td>
  <td>User</td>
</tr>
<tr id="getUserList">
  <td><a href="User.html#getUserList-detail">getUserList()</a></td>
  <td>获得老师或机构的ID，name和位置信息的列表，用于视频添加时，联想用户</td>
  <td>User</td>
</tr>
<tr class="inherited" id="getValidatorList">
  <td><a href="http://www.yiiframework.com/doc/api/1.1/CModel/#getValidatorList-detail">getValidatorList()</a></td>
  <td>Returns all the validators declared in the model.</td>
  <td><a href="http://www.yiiframework.com/doc/api/1.1/CModel">CModel</a></td>
</tr>
<tr class="inherited" id="getValidators">
  <td><a href="http://www.yiiframework.com/doc/api/1.1/CModel/#getValidators-detail">getValidators()</a></td>
  <td>Returns the validators applicable to the current <a href="User.html#scenario">scenario</a>.</td>
  <td><a href="http://www.yiiframework.com/doc/api/1.1/CModel">CModel</a></td>
</tr>
<tr class="inherited" id="hasAttribute">
  <td><a href="http://www.yiiframework.com/doc/api/1.1/CActiveRecord/#hasAttribute-detail">hasAttribute()</a></td>
  <td>Checks whether this AR has the named attribute</td>
  <td><a href="http://www.yiiframework.com/doc/api/1.1/CActiveRecord">CActiveRecord</a></td>
</tr>
<tr class="inherited" id="hasErrors">
  <td><a href="http://www.yiiframework.com/doc/api/1.1/CModel/#hasErrors-detail">hasErrors()</a></td>
  <td>Returns a value indicating whether there is any validation error.</td>
  <td><a href="http://www.yiiframework.com/doc/api/1.1/CModel">CModel</a></td>
</tr>
<tr class="inherited" id="hasEvent">
  <td><a href="http://www.yiiframework.com/doc/api/1.1/CComponent/#hasEvent-detail">hasEvent()</a></td>
  <td>Determines whether an event is defined.</td>
  <td><a href="http://www.yiiframework.com/doc/api/1.1/CComponent">CComponent</a></td>
</tr>
<tr class="inherited" id="hasEventHandler">
  <td><a href="http://www.yiiframework.com/doc/api/1.1/CComponent/#hasEventHandler-detail">hasEventHandler()</a></td>
  <td>Checks whether the named event has attached handlers.</td>
  <td><a href="http://www.yiiframework.com/doc/api/1.1/CComponent">CComponent</a></td>
</tr>
<tr class="inherited" id="hasProperty">
  <td><a href="http://www.yiiframework.com/doc/api/1.1/CComponent/#hasProperty-detail">hasProperty()</a></td>
  <td>Determines whether a property is defined.</td>
  <td><a href="http://www.yiiframework.com/doc/api/1.1/CComponent">CComponent</a></td>
</tr>
<tr class="inherited" id="hasRelated">
  <td><a href="http://www.yiiframework.com/doc/api/1.1/CActiveRecord/#hasRelated-detail">hasRelated()</a></td>
  <td>Returns a value indicating whether the named related object(s) has been loaded.</td>
  <td><a href="http://www.yiiframework.com/doc/api/1.1/CActiveRecord">CActiveRecord</a></td>
</tr>
<tr class="inherited" id="init">
  <td><a href="http://www.yiiframework.com/doc/api/1.1/CActiveRecord/#init-detail">init()</a></td>
  <td>Initializes this model.</td>
  <td><a href="http://www.yiiframework.com/doc/api/1.1/CActiveRecord">CActiveRecord</a></td>
</tr>
<tr class="inherited" id="insert">
  <td><a href="http://www.yiiframework.com/doc/api/1.1/CActiveRecord/#insert-detail">insert()</a></td>
  <td>Inserts a row into the table based on this active record attributes.</td>
  <td><a href="http://www.yiiframework.com/doc/api/1.1/CActiveRecord">CActiveRecord</a></td>
</tr>
<tr class="inherited" id="isAttributeRequired">
  <td><a href="http://www.yiiframework.com/doc/api/1.1/CModel/#isAttributeRequired-detail">isAttributeRequired()</a></td>
  <td>Returns a value indicating whether the attribute is required.</td>
  <td><a href="http://www.yiiframework.com/doc/api/1.1/CModel">CModel</a></td>
</tr>
<tr class="inherited" id="isAttributeSafe">
  <td><a href="http://www.yiiframework.com/doc/api/1.1/CModel/#isAttributeSafe-detail">isAttributeSafe()</a></td>
  <td>Returns a value indicating whether the attribute is safe for massive assignments.</td>
  <td><a href="http://www.yiiframework.com/doc/api/1.1/CModel">CModel</a></td>
</tr>
<tr id="merge">
  <td><a href="User.html#merge-detail">merge()</a></td>
  <td>合并查询 密集范围的数据。</td>
  <td>User</td>
</tr>
<tr id="model">
  <td><a href="User.html#model-detail">model()</a></td>
  <td>Returns the static model of the specified AR class.</td>
  <td>User</td>
</tr>
<tr class="inherited" id="offsetExists">
  <td><a href="http://www.yiiframework.com/doc/api/1.1/CActiveRecord/#offsetExists-detail">offsetExists()</a></td>
  <td>Returns whether there is an element at the specified offset.</td>
  <td><a href="http://www.yiiframework.com/doc/api/1.1/CActiveRecord">CActiveRecord</a></td>
</tr>
<tr class="inherited" id="offsetGet">
  <td><a href="http://www.yiiframework.com/doc/api/1.1/CModel/#offsetGet-detail">offsetGet()</a></td>
  <td>Returns the element at the specified offset.</td>
  <td><a href="http://www.yiiframework.com/doc/api/1.1/CModel">CModel</a></td>
</tr>
<tr class="inherited" id="offsetSet">
  <td><a href="http://www.yiiframework.com/doc/api/1.1/CModel/#offsetSet-detail">offsetSet()</a></td>
  <td>Sets the element at the specified offset.</td>
  <td><a href="http://www.yiiframework.com/doc/api/1.1/CModel">CModel</a></td>
</tr>
<tr class="inherited" id="offsetUnset">
  <td><a href="http://www.yiiframework.com/doc/api/1.1/CModel/#offsetUnset-detail">offsetUnset()</a></td>
  <td>Unsets the element at the specified offset.</td>
  <td><a href="http://www.yiiframework.com/doc/api/1.1/CModel">CModel</a></td>
</tr>
<tr class="inherited" id="onAfterConstruct">
  <td><a href="http://www.yiiframework.com/doc/api/1.1/CModel/#onAfterConstruct-detail">onAfterConstruct()</a></td>
  <td>This event is raised after the model instance is created by new operator.</td>
  <td><a href="http://www.yiiframework.com/doc/api/1.1/CModel">CModel</a></td>
</tr>
<tr class="inherited" id="onAfterDelete">
  <td><a href="http://www.yiiframework.com/doc/api/1.1/CActiveRecord/#onAfterDelete-detail">onAfterDelete()</a></td>
  <td>This event is raised after the record is deleted.</td>
  <td><a href="http://www.yiiframework.com/doc/api/1.1/CActiveRecord">CActiveRecord</a></td>
</tr>
<tr class="inherited" id="onAfterFind">
  <td><a href="http://www.yiiframework.com/doc/api/1.1/CActiveRecord/#onAfterFind-detail">onAfterFind()</a></td>
  <td>This event is raised after the record is instantiated by a find method.</td>
  <td><a href="http://www.yiiframework.com/doc/api/1.1/CActiveRecord">CActiveRecord</a></td>
</tr>
<tr class="inherited" id="onAfterSave">
  <td><a href="http://www.yiiframework.com/doc/api/1.1/CActiveRecord/#onAfterSave-detail">onAfterSave()</a></td>
  <td>This event is raised after the record is saved.</td>
  <td><a href="http://www.yiiframework.com/doc/api/1.1/CActiveRecord">CActiveRecord</a></td>
</tr>
<tr class="inherited" id="onAfterValidate">
  <td><a href="http://www.yiiframework.com/doc/api/1.1/CModel/#onAfterValidate-detail">onAfterValidate()</a></td>
  <td>This event is raised after the validation is performed.</td>
  <td><a href="http://www.yiiframework.com/doc/api/1.1/CModel">CModel</a></td>
</tr>
<tr class="inherited" id="onBeforeDelete">
  <td><a href="http://www.yiiframework.com/doc/api/1.1/CActiveRecord/#onBeforeDelete-detail">onBeforeDelete()</a></td>
  <td>This event is raised before the record is deleted.</td>
  <td><a href="http://www.yiiframework.com/doc/api/1.1/CActiveRecord">CActiveRecord</a></td>
</tr>
<tr class="inherited" id="onBeforeFind">
  <td><a href="http://www.yiiframework.com/doc/api/1.1/CActiveRecord/#onBeforeFind-detail">onBeforeFind()</a></td>
  <td>This event is raised before an AR finder performs a find call.</td>
  <td><a href="http://www.yiiframework.com/doc/api/1.1/CActiveRecord">CActiveRecord</a></td>
</tr>
<tr class="inherited" id="onBeforeSave">
  <td><a href="http://www.yiiframework.com/doc/api/1.1/CActiveRecord/#onBeforeSave-detail">onBeforeSave()</a></td>
  <td>This event is raised before the record is saved.</td>
  <td><a href="http://www.yiiframework.com/doc/api/1.1/CActiveRecord">CActiveRecord</a></td>
</tr>
<tr class="inherited" id="onBeforeValidate">
  <td><a href="http://www.yiiframework.com/doc/api/1.1/CModel/#onBeforeValidate-detail">onBeforeValidate()</a></td>
  <td>This event is raised before the validation is performed.</td>
  <td><a href="http://www.yiiframework.com/doc/api/1.1/CModel">CModel</a></td>
</tr>
<tr class="inherited" id="onUnsafeAttribute">
  <td><a href="http://www.yiiframework.com/doc/api/1.1/CModel/#onUnsafeAttribute-detail">onUnsafeAttribute()</a></td>
  <td>This method is invoked when an unsafe attribute is being massively assigned.</td>
  <td><a href="http://www.yiiframework.com/doc/api/1.1/CModel">CModel</a></td>
</tr>
<tr class="inherited" id="populateRecord">
  <td><a href="http://www.yiiframework.com/doc/api/1.1/CActiveRecord/#populateRecord-detail">populateRecord()</a></td>
  <td>Creates an active record with the given attributes.</td>
  <td><a href="http://www.yiiframework.com/doc/api/1.1/CActiveRecord">CActiveRecord</a></td>
</tr>
<tr class="inherited" id="populateRecords">
  <td><a href="http://www.yiiframework.com/doc/api/1.1/CActiveRecord/#populateRecords-detail">populateRecords()</a></td>
  <td>Creates a list of active records based on the input data.</td>
  <td><a href="http://www.yiiframework.com/doc/api/1.1/CActiveRecord">CActiveRecord</a></td>
</tr>
<tr class="inherited" id="primaryKey">
  <td><a href="http://www.yiiframework.com/doc/api/1.1/CActiveRecord/#primaryKey-detail">primaryKey()</a></td>
  <td>Returns the primary key of the associated database table.</td>
  <td><a href="http://www.yiiframework.com/doc/api/1.1/CActiveRecord">CActiveRecord</a></td>
</tr>
<tr class="inherited" id="raiseEvent">
  <td><a href="http://www.yiiframework.com/doc/api/1.1/CComponent/#raiseEvent-detail">raiseEvent()</a></td>
  <td>Raises an event.</td>
  <td><a href="http://www.yiiframework.com/doc/api/1.1/CComponent">CComponent</a></td>
</tr>
<tr class="inherited" id="refresh">
  <td><a href="http://www.yiiframework.com/doc/api/1.1/CActiveRecord/#refresh-detail">refresh()</a></td>
  <td>Repopulates this active record with the latest data.</td>
  <td><a href="http://www.yiiframework.com/doc/api/1.1/CActiveRecord">CActiveRecord</a></td>
</tr>
<tr class="inherited" id="refreshMetaData">
  <td><a href="http://www.yiiframework.com/doc/api/1.1/CActiveRecord/#refreshMetaData-detail">refreshMetaData()</a></td>
  <td>Refreshes the meta data for this AR class.</td>
  <td><a href="http://www.yiiframework.com/doc/api/1.1/CActiveRecord">CActiveRecord</a></td>
</tr>
<tr id="relations">
  <td><a href="User.html#relations-detail">relations()</a></td>
  <td></td>
  <td>User</td>
</tr>
<tr id="resetPassword">
  <td><a href="User.html#resetPassword-detail">resetPassword()</a></td>
  <td>重置密码，user对象为查询出CActiveRecord的user，非自己new创建的user</td>
  <td>User</td>
</tr>
<tr class="inherited" id="resetScope">
  <td><a href="http://www.yiiframework.com/doc/api/1.1/CActiveRecord/#resetScope-detail">resetScope()</a></td>
  <td>Resets all scopes and criterias applied.</td>
  <td><a href="http://www.yiiframework.com/doc/api/1.1/CActiveRecord">CActiveRecord</a></td>
</tr>
<tr id="rules">
  <td><a href="User.html#rules-detail">rules()</a></td>
  <td></td>
  <td>User</td>
</tr>
<tr class="inherited" id="save">
  <td><a href="http://www.yiiframework.com/doc/api/1.1/CActiveRecord/#save-detail">save()</a></td>
  <td>Saves the current record.</td>
  <td><a href="http://www.yiiframework.com/doc/api/1.1/CActiveRecord">CActiveRecord</a></td>
</tr>
<tr class="inherited" id="saveAttributes">
  <td><a href="http://www.yiiframework.com/doc/api/1.1/CActiveRecord/#saveAttributes-detail">saveAttributes()</a></td>
  <td>Saves a selected list of attributes.</td>
  <td><a href="http://www.yiiframework.com/doc/api/1.1/CActiveRecord">CActiveRecord</a></td>
</tr>
<tr class="inherited" id="saveCounters">
  <td><a href="http://www.yiiframework.com/doc/api/1.1/CActiveRecord/#saveCounters-detail">saveCounters()</a></td>
  <td>Saves one or several counter columns for the current AR object.</td>
  <td><a href="http://www.yiiframework.com/doc/api/1.1/CActiveRecord">CActiveRecord</a></td>
</tr>
<tr class="inherited" id="scopes">
  <td><a href="http://www.yiiframework.com/doc/api/1.1/CActiveRecord/#scopes-detail">scopes()</a></td>
  <td>Returns the declaration of named scopes.</td>
  <td><a href="http://www.yiiframework.com/doc/api/1.1/CActiveRecord">CActiveRecord</a></td>
</tr>
<tr id="search">
  <td><a href="User.html#search-detail">search()</a></td>
  <td>Retrieves a list of models based on the current search/filter conditions.</td>
  <td>User</td>
</tr>
<tr class="inherited" id="setAttribute">
  <td><a href="http://www.yiiframework.com/doc/api/1.1/CActiveRecord/#setAttribute-detail">setAttribute()</a></td>
  <td>Sets the named attribute value.</td>
  <td><a href="http://www.yiiframework.com/doc/api/1.1/CActiveRecord">CActiveRecord</a></td>
</tr>
<tr class="inherited" id="setAttributes">
  <td><a href="http://www.yiiframework.com/doc/api/1.1/CModel/#setAttributes-detail">setAttributes()</a></td>
  <td>Sets the attribute values in a massive way.</td>
  <td><a href="http://www.yiiframework.com/doc/api/1.1/CModel">CModel</a></td>
</tr>
<tr class="inherited" id="setDbCriteria">
  <td><a href="http://www.yiiframework.com/doc/api/1.1/CActiveRecord/#setDbCriteria-detail">setDbCriteria()</a></td>
  <td>Sets the query criteria for the current model.</td>
  <td><a href="http://www.yiiframework.com/doc/api/1.1/CActiveRecord">CActiveRecord</a></td>
</tr>
<tr class="inherited" id="setIsNewRecord">
  <td><a href="http://www.yiiframework.com/doc/api/1.1/CActiveRecord/#setIsNewRecord-detail">setIsNewRecord()</a></td>
  <td>Sets if the record is new.</td>
  <td><a href="http://www.yiiframework.com/doc/api/1.1/CActiveRecord">CActiveRecord</a></td>
</tr>
<tr class="inherited" id="setOldPrimaryKey">
  <td><a href="http://www.yiiframework.com/doc/api/1.1/CActiveRecord/#setOldPrimaryKey-detail">setOldPrimaryKey()</a></td>
  <td>Sets the old primary key value.</td>
  <td><a href="http://www.yiiframework.com/doc/api/1.1/CActiveRecord">CActiveRecord</a></td>
</tr>
<tr class="inherited" id="setPrimaryKey">
  <td><a href="http://www.yiiframework.com/doc/api/1.1/CActiveRecord/#setPrimaryKey-detail">setPrimaryKey()</a></td>
  <td>Sets the primary key value.</td>
  <td><a href="http://www.yiiframework.com/doc/api/1.1/CActiveRecord">CActiveRecord</a></td>
</tr>
<tr class="inherited" id="setScenario">
  <td><a href="http://www.yiiframework.com/doc/api/1.1/CModel/#setScenario-detail">setScenario()</a></td>
  <td>Sets the scenario for the model.</td>
  <td><a href="http://www.yiiframework.com/doc/api/1.1/CModel">CModel</a></td>
</tr>
<tr class="inherited" id="setTableAlias">
  <td><a href="http://www.yiiframework.com/doc/api/1.1/CActiveRecord/#setTableAlias-detail">setTableAlias()</a></td>
  <td>Sets the table alias to be used in queries.</td>
  <td><a href="http://www.yiiframework.com/doc/api/1.1/CActiveRecord">CActiveRecord</a></td>
</tr>
<tr id="tableName">
  <td><a href="User.html#tableName-detail">tableName()</a></td>
  <td></td>
  <td>User</td>
</tr>
<tr class="inherited" id="together">
  <td><a href="http://www.yiiframework.com/doc/api/1.1/CActiveRecord/#together-detail">together()</a></td>
  <td>Sets CDbCriteria::together property to be true.</td>
  <td><a href="http://www.yiiframework.com/doc/api/1.1/CActiveRecord">CActiveRecord</a></td>
</tr>
<tr class="inherited" id="unsetAttributes">
  <td><a href="http://www.yiiframework.com/doc/api/1.1/CModel/#unsetAttributes-detail">unsetAttributes()</a></td>
  <td>Sets the attributes to be null.</td>
  <td><a href="http://www.yiiframework.com/doc/api/1.1/CModel">CModel</a></td>
</tr>
<tr class="inherited" id="update">
  <td><a href="http://www.yiiframework.com/doc/api/1.1/CActiveRecord/#update-detail">update()</a></td>
  <td>Updates the row represented by this active record.</td>
  <td><a href="http://www.yiiframework.com/doc/api/1.1/CActiveRecord">CActiveRecord</a></td>
</tr>
<tr id="updateAccount">
  <td><a href="User.html#updateAccount-detail">updateAccount()</a></td>
  <td>根据userId修改账号</td>
  <td>User</td>
</tr>
<tr class="inherited" id="updateAll">
  <td><a href="http://www.yiiframework.com/doc/api/1.1/CActiveRecord/#updateAll-detail">updateAll()</a></td>
  <td>Updates records with the specified condition.</td>
  <td><a href="http://www.yiiframework.com/doc/api/1.1/CActiveRecord">CActiveRecord</a></td>
</tr>
<tr class="inherited" id="updateByPk">
  <td><a href="http://www.yiiframework.com/doc/api/1.1/CActiveRecord/#updateByPk-detail">updateByPk()</a></td>
  <td>Updates records with the specified primary key(s).</td>
  <td><a href="http://www.yiiframework.com/doc/api/1.1/CActiveRecord">CActiveRecord</a></td>
</tr>
<tr class="inherited" id="updateCounters">
  <td><a href="http://www.yiiframework.com/doc/api/1.1/CActiveRecord/#updateCounters-detail">updateCounters()</a></td>
  <td>Updates one or several counter columns.</td>
  <td><a href="http://www.yiiframework.com/doc/api/1.1/CActiveRecord">CActiveRecord</a></td>
</tr>
<tr id="updatePassword">
  <td><a href="User.html#updatePassword-detail">updatePassword()</a></td>
  <td>修改密码</td>
  <td>User</td>
</tr>
<tr class="inherited" id="validate">
  <td><a href="http://www.yiiframework.com/doc/api/1.1/CModel/#validate-detail">validate()</a></td>
  <td>Performs the validation.</td>
  <td><a href="http://www.yiiframework.com/doc/api/1.1/CModel">CModel</a></td>
</tr>
<tr class="inherited" id="with">
  <td><a href="http://www.yiiframework.com/doc/api/1.1/CActiveRecord/#with-detail">with()</a></td>
  <td>Specifies which related objects should be eagerly loaded.</td>
  <td><a href="http://www.yiiframework.com/doc/api/1.1/CActiveRecord">CActiveRecord</a></td>
</tr>
</table>
</div>

<div class="summary docMethod">
<h2>Protected Methods</h2>

<p><a href="#" class="toggle">Hide inherited methods</a></p>

<table class="summaryTable">
<colgroup>
	<col class="col-method" />
	<col class="col-description" />
	<col class="col-defined" />
</colgroup>
<tr>
  <th>Method</th><th>Description</th><th>Defined By</th>
</tr>
<tr class="inherited" id="afterConstruct">
  <td><a href="http://www.yiiframework.com/doc/api/1.1/CModel/#afterConstruct-detail">afterConstruct()</a></td>
  <td>This method is invoked after a model instance is created by new operator.</td>
  <td><a href="http://www.yiiframework.com/doc/api/1.1/CModel">CModel</a></td>
</tr>
<tr class="inherited" id="afterDelete">
  <td><a href="http://www.yiiframework.com/doc/api/1.1/CActiveRecord/#afterDelete-detail">afterDelete()</a></td>
  <td>This method is invoked after deleting a record.</td>
  <td><a href="http://www.yiiframework.com/doc/api/1.1/CActiveRecord">CActiveRecord</a></td>
</tr>
<tr class="inherited" id="afterFind">
  <td><a href="http://www.yiiframework.com/doc/api/1.1/CActiveRecord/#afterFind-detail">afterFind()</a></td>
  <td>This method is invoked after each record is instantiated by a find method.</td>
  <td><a href="http://www.yiiframework.com/doc/api/1.1/CActiveRecord">CActiveRecord</a></td>
</tr>
<tr class="inherited" id="afterSave">
  <td><a href="http://www.yiiframework.com/doc/api/1.1/CActiveRecord/#afterSave-detail">afterSave()</a></td>
  <td>This method is invoked after saving a record successfully.</td>
  <td><a href="http://www.yiiframework.com/doc/api/1.1/CActiveRecord">CActiveRecord</a></td>
</tr>
<tr class="inherited" id="afterValidate">
  <td><a href="http://www.yiiframework.com/doc/api/1.1/CModel/#afterValidate-detail">afterValidate()</a></td>
  <td>This method is invoked after validation ends.</td>
  <td><a href="http://www.yiiframework.com/doc/api/1.1/CModel">CModel</a></td>
</tr>
<tr class="inherited" id="beforeDelete">
  <td><a href="http://www.yiiframework.com/doc/api/1.1/CActiveRecord/#beforeDelete-detail">beforeDelete()</a></td>
  <td>This method is invoked before deleting a record.</td>
  <td><a href="http://www.yiiframework.com/doc/api/1.1/CActiveRecord">CActiveRecord</a></td>
</tr>
<tr class="inherited" id="beforeFind">
  <td><a href="http://www.yiiframework.com/doc/api/1.1/CActiveRecord/#beforeFind-detail">beforeFind()</a></td>
  <td>This method is invoked before an AR finder executes a find call.</td>
  <td><a href="http://www.yiiframework.com/doc/api/1.1/CActiveRecord">CActiveRecord</a></td>
</tr>
<tr class="inherited" id="beforeSave">
  <td><a href="http://www.yiiframework.com/doc/api/1.1/CActiveRecord/#beforeSave-detail">beforeSave()</a></td>
  <td>This method is invoked before saving a record (after validation, if any).</td>
  <td><a href="http://www.yiiframework.com/doc/api/1.1/CActiveRecord">CActiveRecord</a></td>
</tr>
<tr class="inherited" id="beforeValidate">
  <td><a href="http://www.yiiframework.com/doc/api/1.1/CModel/#beforeValidate-detail">beforeValidate()</a></td>
  <td>This method is invoked before validation starts.</td>
  <td><a href="http://www.yiiframework.com/doc/api/1.1/CModel">CModel</a></td>
</tr>
<tr class="inherited" id="instantiate">
  <td><a href="http://www.yiiframework.com/doc/api/1.1/CActiveRecord/#instantiate-detail">instantiate()</a></td>
  <td>Creates an active record instance.</td>
  <td><a href="http://www.yiiframework.com/doc/api/1.1/CActiveRecord">CActiveRecord</a></td>
</tr>
<tr class="inherited" id="query">
  <td><a href="http://www.yiiframework.com/doc/api/1.1/CActiveRecord/#query-detail">query()</a></td>
  <td>Performs the actual DB query and populates the AR objects with the query result.</td>
  <td><a href="http://www.yiiframework.com/doc/api/1.1/CActiveRecord">CActiveRecord</a></td>
</tr>
</table>
</div>

<a name="events"></a>

<div class="summary docEvent">
<h2>Events</h2>

<p><a href="#" class="toggle">Hide inherited events</a></p>

<table class="summaryTable">
<colgroup>
	<col class="col-event" />
	<col class="col-description" />
	<col class="col-defined" />
</colgroup>
<tr>
  <th>Event</th><th>Description</th><th>Defined By</th>
</tr>
<tr class="inherited" id="onBeforeSave">
  <td><a href="http://www.yiiframework.com/doc/api/1.1/CActiveRecord/#onBeforeSave-detail">onBeforeSave</a></td>
  <td>This event is raised before the record is saved.</td>
  <td><a href="http://www.yiiframework.com/doc/api/1.1/CActiveRecord">CActiveRecord</a></td>
</tr>
<tr class="inherited" id="onAfterSave">
  <td><a href="http://www.yiiframework.com/doc/api/1.1/CActiveRecord/#onAfterSave-detail">onAfterSave</a></td>
  <td>This event is raised after the record is saved.</td>
  <td><a href="http://www.yiiframework.com/doc/api/1.1/CActiveRecord">CActiveRecord</a></td>
</tr>
<tr class="inherited" id="onBeforeDelete">
  <td><a href="http://www.yiiframework.com/doc/api/1.1/CActiveRecord/#onBeforeDelete-detail">onBeforeDelete</a></td>
  <td>This event is raised before the record is deleted.</td>
  <td><a href="http://www.yiiframework.com/doc/api/1.1/CActiveRecord">CActiveRecord</a></td>
</tr>
<tr class="inherited" id="onAfterDelete">
  <td><a href="http://www.yiiframework.com/doc/api/1.1/CActiveRecord/#onAfterDelete-detail">onAfterDelete</a></td>
  <td>This event is raised after the record is deleted.</td>
  <td><a href="http://www.yiiframework.com/doc/api/1.1/CActiveRecord">CActiveRecord</a></td>
</tr>
<tr class="inherited" id="onBeforeFind">
  <td><a href="http://www.yiiframework.com/doc/api/1.1/CActiveRecord/#onBeforeFind-detail">onBeforeFind</a></td>
  <td>This event is raised before an AR finder performs a find call.</td>
  <td><a href="http://www.yiiframework.com/doc/api/1.1/CActiveRecord">CActiveRecord</a></td>
</tr>
<tr class="inherited" id="onAfterFind">
  <td><a href="http://www.yiiframework.com/doc/api/1.1/CActiveRecord/#onAfterFind-detail">onAfterFind</a></td>
  <td>This event is raised after the record is instantiated by a find method.</td>
  <td><a href="http://www.yiiframework.com/doc/api/1.1/CActiveRecord">CActiveRecord</a></td>
</tr>
<tr class="inherited" id="onAfterConstruct">
  <td><a href="http://www.yiiframework.com/doc/api/1.1/CModel/#onAfterConstruct-detail">onAfterConstruct</a></td>
  <td>This event is raised after the model instance is created by new operator.</td>
  <td><a href="http://www.yiiframework.com/doc/api/1.1/CModel">CModel</a></td>
</tr>
<tr class="inherited" id="onBeforeValidate">
  <td><a href="http://www.yiiframework.com/doc/api/1.1/CModel/#onBeforeValidate-detail">onBeforeValidate</a></td>
  <td>This event is raised before the validation is performed.</td>
  <td><a href="http://www.yiiframework.com/doc/api/1.1/CModel">CModel</a></td>
</tr>
<tr class="inherited" id="onAfterValidate">
  <td><a href="http://www.yiiframework.com/doc/api/1.1/CModel/#onAfterValidate-detail">onAfterValidate</a></td>
  <td>This event is raised after the validation is performed.</td>
  <td><a href="http://www.yiiframework.com/doc/api/1.1/CModel">CModel</a></td>
</tr>
<tr class="inherited" id="onUnsafeAttribute">
  <td><a href="http://www.yiiframework.com/doc/api/1.1/CModel/#onUnsafeAttribute-detail">onUnsafeAttribute</a></td>
  <td>This method is invoked when an unsafe attribute is being massively assigned.</td>
  <td><a href="http://www.yiiframework.com/doc/api/1.1/CModel">CModel</a></td>
</tr>
</table>
</div>

<h2>Property Details</h2>
<div class="detailHeader" id="collects-detail">
collects<span class="detailHeaderTag">
property
</span>
</div>

<div class="signature">
Collect[] <b>collects</b>;</div>

<p></p>


<div class="detailHeader" id="comments-detail">
comments<span class="detailHeaderTag">
property
</span>
</div>

<div class="signature">
Comments[] <b>comments</b>;</div>

<p></p>


<div class="detailHeader" id="createTime-detail">
createTime<span class="detailHeaderTag">
property
</span>
</div>

<div class="signature">
string <b>createTime</b>;</div>

<p>创建时间</p>


<div class="detailHeader" id="editTime-detail">
editTime<span class="detailHeaderTag">
property
</span>
</div>

<div class="signature">
string <b>editTime</b>;</div>

<p>修改时间</p>


<div class="detailHeader" id="giveNotices-detail">
giveNotices<span class="detailHeaderTag">
property
</span>
</div>

<div class="signature">
Notice[] <b>giveNotices</b>;</div>

<p></p>


<div class="detailHeader" id="id-detail">
id<span class="detailHeaderTag">
property
</span>
</div>

<div class="signature">
string <b>id</b>;</div>

<p>编号</p>


<div class="detailHeader" id="introduction-detail">
introduction<span class="detailHeaderTag">
property
</span>
</div>

<div class="signature">
<a href="Introduction.html">Introduction</a> <b>introduction</b>;</div>

<p></p>


<div class="detailHeader" id="isComplete-detail">
isComplete<span class="detailHeaderTag">
property
</span>
</div>

<div class="signature">
integer <b>isComplete</b>;</div>

<p>是否完善资料</p>


<div class="detailHeader" id="isDelete-detail">
isDelete<span class="detailHeaderTag">
property
</span>
</div>

<div class="signature">
integer <b>isDelete</b>;</div>

<p>是否删除用户</p>


<div class="detailHeader" id="messages-detail">
messages<span class="detailHeaderTag">
property
</span>
</div>

<div class="signature">
Messages[] <b>messages</b>;</div>

<p></p>


<div class="detailHeader" id="messagesDetails-detail">
messagesDetails<span class="detailHeaderTag">
property
</span>
</div>

<div class="signature">
MessagesDetails[] <b>messagesDetails</b>;</div>

<p></p>


<div class="detailHeader" id="messagesOptions-detail">
messagesOptions<span class="detailHeaderTag">
property
</span>
</div>

<div class="signature">
MessagesOption[] <b>messagesOptions</b>;</div>

<p></p>


<div class="detailHeader" id="noticeOptions-detail">
noticeOptions<span class="detailHeaderTag">
property
</span>
</div>

<div class="signature">
NoticeOption[] <b>noticeOptions</b>;</div>

<p></p>


<div class="detailHeader" id="noticeUserDeletes-detail">
noticeUserDeletes<span class="detailHeaderTag">
property
</span>
</div>

<div class="signature">
NoticeUserDelete[] <b>noticeUserDeletes</b>;</div>

<p></p>


<div class="detailHeader" id="order-detail">
order<span class="detailHeaderTag">
property
</span>
</div>

<div class="signature">
string <b>order</b>;</div>

<p>排序</p>


<div class="detailHeader" id="password-detail">
password<span class="detailHeaderTag">
property
</span>
</div>

<div class="signature">
string <b>password</b>;</div>

<p>密码，sha1加密</p>


<div class="detailHeader" id="phone-detail">
phone<span class="detailHeaderTag">
property
</span>
</div>

<div class="signature">
string <b>phone</b>;</div>

<p>手机号码</p>


<div class="detailHeader" id="profile-detail">
profile<span class="detailHeaderTag">
property
</span>
</div>

<div class="signature">
<a href="Profile.html">Profile</a> <b>profile</b>;</div>

<p></p>


<div class="detailHeader" id="receiveNotices-detail">
receiveNotices<span class="detailHeaderTag">
property
</span>
</div>

<div class="signature">
Notice[] <b>receiveNotices</b>;</div>

<p></p>


<div class="detailHeader" id="role-detail">
role<span class="detailHeaderTag">
property
</span>
</div>

<div class="signature">
<a href="Role.html">Role</a> <b>role</b>;</div>

<p></p>


<div class="detailHeader" id="roleId-detail">
roleId<span class="detailHeaderTag">
property
</span>
</div>

<div class="signature">
string <b>roleId</b>;</div>

<p>角色ID</p>


<div class="detailHeader" id="teach-detail">
teach<span class="detailHeaderTag">
property
</span>
</div>

<div class="signature">
<a href="Teach.html">Teach</a> <b>teach</b>;</div>

<p></p>


<div class="detailHeader" id="teachCourseSignUps-detail">
teachCourseSignUps<span class="detailHeaderTag">
property
</span>
</div>

<div class="signature">
TeachCourseSignUp[] <b>teachCourseSignUps</b>;</div>

<p></p>


<div class="detailHeader" id="teachCourses-detail">
teachCourses<span class="detailHeaderTag">
property
</span>
</div>

<div class="signature">
TeachCourse[] <b>teachCourses</b>;</div>

<p></p>


<div class="detailHeader" id="teachStars-detail">
teachStars<span class="detailHeaderTag">
property
</span>
</div>

<div class="signature">
TeachStar[] <b>teachStars</b>;</div>

<p></p>


<div class="detailHeader" id="teachVideoStars-detail">
teachVideoStars<span class="detailHeaderTag">
property
</span>
</div>

<div class="signature">
TeachVideoStar[] <b>teachVideoStars</b>;</div>

<p></p>


<div class="detailHeader" id="teachVideos-detail">
teachVideos<span class="detailHeaderTag">
property
</span>
</div>

<div class="signature">
TeachVideo[] <b>teachVideos</b>;</div>

<p></p>


<div class="detailHeader" id="userAuth-detail">
userAuth<span class="detailHeaderTag">
property
</span>
</div>

<div class="signature">
<a href="UserAuth.html">UserAuth</a> <b>userAuth</b>;</div>

<p></p>


<div class="detailHeader" id="userBindings-detail">
userBindings<span class="detailHeaderTag">
property
</span>
</div>

<div class="signature">
UserBinding[] <b>userBindings</b>;</div>

<p></p>


<div class="detailHeader" id="userCategories-detail">
userCategories<span class="detailHeaderTag">
property
</span>
</div>

<div class="signature">
UserCategory[] <b>userCategories</b>;</div>

<p></p>


<div class="detailHeader" id="userCities-detail">
userCities<span class="detailHeaderTag">
property
</span>
</div>

<div class="signature">
UserCity[] <b>userCities</b>;</div>

<p></p>


<div class="detailHeader" id="userLocation-detail">
userLocation<span class="detailHeaderTag">
property
</span>
</div>

<div class="signature">
<a href="UserLocation.html">UserLocation</a> <b>userLocation</b>;</div>

<p></p>


<div class="detailHeader" id="userSessions-detail">
userSessions<span class="detailHeaderTag">
property
</span>
</div>

<div class="signature">
UserSession[] <b>userSessions</b>;</div>

<p></p>


<div class="detailHeader" id="userSetting-detail">
userSetting<span class="detailHeaderTag">
property
</span>
</div>

<div class="signature">
<a href="UserSetting.html">UserSetting</a> <b>userSetting</b>;</div>

<p></p>


<div class="detailHeader" id="userVipSigns-detail">
userVipSigns<span class="detailHeaderTag">
property
</span>
</div>

<div class="signature">
UserVipSign[] <b>userVipSigns</b>;</div>

<p></p>


<h2>Method Details</h2>

<div class="detailHeader" id="attributeLabels-detail">
attributeLabels()
<span class="detailHeaderTag">
method
</span>
</div>

<table class="summaryTable">
<tr><td colspan="3">
<div class="signature2">
public array <b>attributeLabels</b>()</div>
</td></tr>
<tr>
  <td class="paramNameCol">{return}</td>
  <td class="paramTypeCol">array</td>
  <td class="paramDescCol">customized attribute labels (name=>label)</td>
</tr>
</table>

<div class="sourceCode">
<b>Source Code:</b>  (<b><a href="#" class="show">show</a></b>)
<div class="code"><code><span style="color: #000000">
<span style="color: #0000BB"></span><span style="color: #007700">public&nbsp;function&nbsp;</span><span style="color: #0000BB">attributeLabels</span><span style="color: #007700">()<br />{<br />&nbsp;&nbsp;&nbsp;&nbsp;return&nbsp;array(<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span style="color: #DD0000">'id'&nbsp;</span><span style="color: #007700">=&gt;&nbsp;</span><span style="color: #DD0000">'ID'</span><span style="color: #007700">,<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span style="color: #DD0000">'phone'&nbsp;</span><span style="color: #007700">=&gt;&nbsp;</span><span style="color: #DD0000">'Phone'</span><span style="color: #007700">,<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span style="color: #DD0000">'password'&nbsp;</span><span style="color: #007700">=&gt;&nbsp;</span><span style="color: #DD0000">'Password'</span><span style="color: #007700">,<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span style="color: #DD0000">'isDelete'&nbsp;</span><span style="color: #007700">=&gt;&nbsp;</span><span style="color: #DD0000">'Is&nbsp;Delete'</span><span style="color: #007700">,<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span style="color: #DD0000">'roleId'&nbsp;</span><span style="color: #007700">=&gt;&nbsp;</span><span style="color: #DD0000">'Role'</span><span style="color: #007700">,<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span style="color: #DD0000">'isComplete'&nbsp;</span><span style="color: #007700">=&gt;&nbsp;</span><span style="color: #DD0000">'Is&nbsp;Complete'</span><span style="color: #007700">,<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span style="color: #DD0000">'order'&nbsp;</span><span style="color: #007700">=&gt;&nbsp;</span><span style="color: #DD0000">'Order'</span><span style="color: #007700">,<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span style="color: #DD0000">'createTime'&nbsp;</span><span style="color: #007700">=&gt;&nbsp;</span><span style="color: #DD0000">'Create&nbsp;Time'</span><span style="color: #007700">,<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span style="color: #DD0000">'editTime'&nbsp;</span><span style="color: #007700">=&gt;&nbsp;</span><span style="color: #DD0000">'Edit&nbsp;Time'</span><span style="color: #007700">,<br />&nbsp;&nbsp;&nbsp;&nbsp;);<br />}</span>
</span>
</code></div>
</div>

<p></p>


<div class="detailHeader" id="createAccount-detail">
createAccount()
<span class="detailHeaderTag">
method
</span>
</div>

<table class="summaryTable">
<tr><td colspan="3">
<div class="signature2">
public User <b>createAccount</b>(string $phone, string $password, string $roleId)</div>
</td></tr>
<tr>
  <td class="paramNameCol">$phone</td>
  <td class="paramTypeCol">string</td>
  <td class="paramDescCol"></td>
</tr>
<tr>
  <td class="paramNameCol">$password</td>
  <td class="paramTypeCol">string</td>
  <td class="paramDescCol"></td>
</tr>
<tr>
  <td class="paramNameCol">$roleId</td>
  <td class="paramTypeCol">string</td>
  <td class="paramDescCol"></td>
</tr>
<tr>
  <td class="paramNameCol">{return}</td>
  <td class="paramTypeCol">User</td>
  <td class="paramDescCol"></td>
</tr>
</table>

<div class="sourceCode">
<b>Source Code:</b>  (<b><a href="#" class="show">show</a></b>)
<div class="code"><code><span style="color: #000000">
<span style="color: #0000BB"></span><span style="color: #007700">public&nbsp;function&nbsp;</span><span style="color: #0000BB">createAccount</span><span style="color: #007700">(</span><span style="color: #0000BB">$phone</span><span style="color: #007700">,&nbsp;</span><span style="color: #0000BB">$password</span><span style="color: #007700">,&nbsp;</span><span style="color: #0000BB">$roleId</span><span style="color: #007700">)&nbsp;{<br />&nbsp;&nbsp;&nbsp;&nbsp;</span><span style="color: #0000BB">$user&nbsp;</span><span style="color: #007700">=&nbsp;new&nbsp;</span><span style="color: #0000BB">User</span><span style="color: #007700">();<br />&nbsp;&nbsp;&nbsp;&nbsp;</span><span style="color: #0000BB">$user</span><span style="color: #007700">-&gt;</span><span style="color: #0000BB">id&nbsp;</span><span style="color: #007700">=&nbsp;</span><span style="color: #0000BB">uniqid</span><span style="color: #007700">();<br />&nbsp;&nbsp;&nbsp;&nbsp;</span><span style="color: #0000BB">$user</span><span style="color: #007700">-&gt;</span><span style="color: #0000BB">phone&nbsp;</span><span style="color: #007700">=&nbsp;</span><span style="color: #0000BB">$phone</span><span style="color: #007700">;<br />&nbsp;&nbsp;&nbsp;&nbsp;</span><span style="color: #0000BB">$user</span><span style="color: #007700">-&gt;</span><span style="color: #0000BB">password&nbsp;</span><span style="color: #007700">=&nbsp;</span><span style="color: #0000BB">sha1</span><span style="color: #007700">(</span><span style="color: #0000BB">$password</span><span style="color: #007700">);<br />&nbsp;&nbsp;&nbsp;&nbsp;</span><span style="color: #0000BB">$user</span><span style="color: #007700">-&gt;</span><span style="color: #0000BB">isDelete&nbsp;</span><span style="color: #007700">=&nbsp;</span><span style="color: #0000BB">Contents</span><span style="color: #007700">::</span><span style="color: #0000BB">F</span><span style="color: #007700">;<br />&nbsp;&nbsp;&nbsp;&nbsp;</span><span style="color: #FF8000">//isComplete默认设置成0,是否完善资料，在添加资料的接口内，需要修改这个字段<br />&nbsp;&nbsp;&nbsp;&nbsp;//$user-&gt;isComplete&nbsp;=&nbsp;Contents::F;<br />&nbsp;&nbsp;&nbsp;&nbsp;//isComplete&nbsp;用于标示资料是否完善，因项目逻辑变更，采用一步进行创建账号，因此采用事务，修改完善资料为1<br />&nbsp;&nbsp;&nbsp;&nbsp;</span><span style="color: #0000BB">$user</span><span style="color: #007700">-&gt;</span><span style="color: #0000BB">isComplete&nbsp;</span><span style="color: #007700">=&nbsp;</span><span style="color: #0000BB">Contents</span><span style="color: #007700">::</span><span style="color: #0000BB">T</span><span style="color: #007700">;<br />&nbsp;&nbsp;&nbsp;&nbsp;</span><span style="color: #0000BB">$user</span><span style="color: #007700">-&gt;</span><span style="color: #0000BB">roleId&nbsp;</span><span style="color: #007700">=&nbsp;</span><span style="color: #0000BB">$roleId</span><span style="color: #007700">;<br />&nbsp;&nbsp;&nbsp;&nbsp;</span><span style="color: #0000BB">$user</span><span style="color: #007700">-&gt;</span><span style="color: #0000BB">createTime&nbsp;</span><span style="color: #007700">=&nbsp;</span><span style="color: #0000BB">date</span><span style="color: #007700">(</span><span style="color: #0000BB">Contents</span><span style="color: #007700">::</span><span style="color: #0000BB">DATETIME</span><span style="color: #007700">);<br />&nbsp;&nbsp;&nbsp;&nbsp;</span><span style="color: #0000BB">$user</span><span style="color: #007700">-&gt;</span><span style="color: #0000BB">editTime&nbsp;</span><span style="color: #007700">=&nbsp;</span><span style="color: #0000BB">date</span><span style="color: #007700">(</span><span style="color: #0000BB">Contents</span><span style="color: #007700">::</span><span style="color: #0000BB">DATETIME</span><span style="color: #007700">);<br />&nbsp;&nbsp;&nbsp;&nbsp;if&nbsp;(!</span><span style="color: #0000BB">$user</span><span style="color: #007700">-&gt;</span><span style="color: #0000BB">validate</span><span style="color: #007700">())&nbsp;{<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span style="color: #0000BB">$errors&nbsp;</span><span style="color: #007700">=&nbsp;</span><span style="color: #0000BB">array_values</span><span style="color: #007700">(</span><span style="color: #0000BB">$user</span><span style="color: #007700">-&gt;</span><span style="color: #0000BB">getErrors</span><span style="color: #007700">());<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;throw&nbsp;new&nbsp;</span><span style="color: #0000BB">CHttpException</span><span style="color: #007700">(</span><span style="color: #0000BB">1001</span><span style="color: #007700">,&nbsp;</span><span style="color: #0000BB">$errors</span><span style="color: #007700">[</span><span style="color: #0000BB">0</span><span style="color: #007700">][</span><span style="color: #0000BB">0</span><span style="color: #007700">]);<br />&nbsp;&nbsp;&nbsp;&nbsp;}<br />&nbsp;&nbsp;&nbsp;&nbsp;try&nbsp;{<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span style="color: #0000BB">$user</span><span style="color: #007700">-&gt;</span><span style="color: #0000BB">save</span><span style="color: #007700">();<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;return&nbsp;</span><span style="color: #0000BB">$user</span><span style="color: #007700">;<br />&nbsp;&nbsp;&nbsp;&nbsp;}&nbsp;catch&nbsp;(</span><span style="color: #0000BB">Exception&nbsp;$e</span><span style="color: #007700">)&nbsp;{<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;throw&nbsp;new&nbsp;</span><span style="color: #0000BB">CHttpException</span><span style="color: #007700">(</span><span style="color: #0000BB">1002</span><span style="color: #007700">,&nbsp;</span><span style="color: #0000BB">Contents</span><span style="color: #007700">::</span><span style="color: #0000BB">getErrorByCode</span><span style="color: #007700">(</span><span style="color: #0000BB">1002</span><span style="color: #007700">));<br />&nbsp;&nbsp;&nbsp;&nbsp;}<br />}</span>
</span>
</code></div>
</div>

<p>创建账号</p>


<div class="detailHeader" id="disableUser-detail">
disableUser()
<span class="detailHeaderTag">
method
</span>
</div>

<table class="summaryTable">
<tr><td colspan="3">
<div class="signature2">
public void <b>disableUser</b>(string $userId, $isDelete $isDelete=1)</div>
</td></tr>
<tr>
  <td class="paramNameCol">$userId</td>
  <td class="paramTypeCol">string</td>
  <td class="paramDescCol"></td>
</tr>
<tr>
  <td class="paramNameCol">$isDelete</td>
  <td class="paramTypeCol">$isDelete</td>
  <td class="paramDescCol"></td>
</tr>
</table>

<div class="sourceCode">
<b>Source Code:</b>  (<b><a href="#" class="show">show</a></b>)
<div class="code"><code><span style="color: #000000">
<span style="color: #0000BB"></span><span style="color: #007700">public&nbsp;function&nbsp;</span><span style="color: #0000BB">disableUser</span><span style="color: #007700">(</span><span style="color: #0000BB">$userId</span><span style="color: #007700">,</span><span style="color: #0000BB">$isDelete&nbsp;</span><span style="color: #007700">=&nbsp;</span><span style="color: #0000BB">Contents</span><span style="color: #007700">::</span><span style="color: #0000BB">T</span><span style="color: #007700">){<br />&nbsp;&nbsp;&nbsp;&nbsp;</span><span style="color: #FF8000">/*$update_array&nbsp;=&nbsp;array();<br />&nbsp;&nbsp;&nbsp;&nbsp;//逻辑删除<br />&nbsp;&nbsp;&nbsp;&nbsp;$update_array['isDelete']&nbsp;=&nbsp;$isDelete;<br />&nbsp;&nbsp;&nbsp;&nbsp;$update_array['editTime']&nbsp;=&nbsp;date(Contents::DATETIME);*/<br />&nbsp;&nbsp;&nbsp;&nbsp;</span><span style="color: #007700">try&nbsp;{<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span style="color: #0000BB">$connection&nbsp;</span><span style="color: #007700">=&nbsp;</span><span style="color: #0000BB">Yii</span><span style="color: #007700">::</span><span style="color: #0000BB">app</span><span style="color: #007700">()-&gt;</span><span style="color: #0000BB">db</span><span style="color: #007700">;<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span style="color: #0000BB">$concat_char&nbsp;</span><span style="color: #007700">=&nbsp;</span><span style="color: #DD0000">'_'</span><span style="color: #007700">.</span><span style="color: #0000BB">time</span><span style="color: #007700">();<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span style="color: #0000BB">$sql&nbsp;</span><span style="color: #007700">=&nbsp;</span><span style="color: #DD0000">"update&nbsp;"</span><span style="color: #007700">.</span><span style="color: #0000BB">User</span><span style="color: #007700">::</span><span style="color: #0000BB">model</span><span style="color: #007700">()-&gt;</span><span style="color: #0000BB">tableName</span><span style="color: #007700">()<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;.</span><span style="color: #DD0000">"&nbsp;set&nbsp;phone&nbsp;=&nbsp;concat(phone,'</span><span style="color: #0000BB">$concat_char</span><span style="color: #DD0000">'),&nbsp;isDelete&nbsp;=&nbsp;:isDelete,&nbsp;editTime&nbsp;=&nbsp;:editTime&nbsp;where&nbsp;id&nbsp;=&nbsp;:id"</span><span style="color: #007700">;<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span style="color: #FF8000">/*$sql&nbsp;=&nbsp;"update&nbsp;".User::model()-&gt;tableName()<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;."&nbsp;set&nbsp;username&nbsp;=&nbsp;concat(name,'$concat_char')&nbsp;and&nbsp;isDelete&nbsp;=&nbsp;:isDelete&nbsp;and&nbsp;editTime&nbsp;=&nbsp;:editTime&nbsp;where&nbsp;id&nbsp;in&nbsp;('$inQuery')";*/<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span style="color: #0000BB">$command&nbsp;</span><span style="color: #007700">=&nbsp;</span><span style="color: #0000BB">$connection</span><span style="color: #007700">-&gt;</span><span style="color: #0000BB">createCommand</span><span style="color: #007700">(</span><span style="color: #0000BB">$sql</span><span style="color: #007700">);<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span style="color: #0000BB">$command</span><span style="color: #007700">-&gt;</span><span style="color: #0000BB">bindValue</span><span style="color: #007700">(</span><span style="color: #DD0000">'id'</span><span style="color: #007700">,&nbsp;</span><span style="color: #0000BB">$userId</span><span style="color: #007700">);<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span style="color: #0000BB">$command</span><span style="color: #007700">-&gt;</span><span style="color: #0000BB">bindValue</span><span style="color: #007700">(</span><span style="color: #DD0000">'isDelete'</span><span style="color: #007700">,&nbsp;</span><span style="color: #0000BB">Contents</span><span style="color: #007700">::</span><span style="color: #0000BB">T</span><span style="color: #007700">);<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span style="color: #0000BB">$command</span><span style="color: #007700">-&gt;</span><span style="color: #0000BB">bindValue</span><span style="color: #007700">(</span><span style="color: #DD0000">'editTime'</span><span style="color: #007700">,&nbsp;</span><span style="color: #0000BB">date</span><span style="color: #007700">(</span><span style="color: #0000BB">Contents</span><span style="color: #007700">::</span><span style="color: #0000BB">DATETIME</span><span style="color: #007700">));<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span style="color: #0000BB">$command</span><span style="color: #007700">-&gt;</span><span style="color: #0000BB">execute</span><span style="color: #007700">();<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span style="color: #FF8000">//User::model()-&gt;updateByPk($userId,&nbsp;$update_array);<br />&nbsp;&nbsp;&nbsp;&nbsp;</span><span style="color: #007700">}catch(</span><span style="color: #0000BB">Exception&nbsp;$e</span><span style="color: #007700">){<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;throw&nbsp;new&nbsp;</span><span style="color: #0000BB">CHttpException</span><span style="color: #007700">(</span><span style="color: #0000BB">1004</span><span style="color: #007700">,</span><span style="color: #0000BB">Contents</span><span style="color: #007700">::</span><span style="color: #0000BB">getErrorByCode</span><span style="color: #007700">(</span><span style="color: #0000BB">1004</span><span style="color: #007700">));<br />&nbsp;&nbsp;&nbsp;&nbsp;}<br />}</span>
</span>
</code></div>
</div>

<p>逻辑删除账号，冻结</p>


<div class="detailHeader" id="getByPhoneAndPassword-detail">
getByPhoneAndPassword()
<span class="detailHeaderTag">
method
</span>
</div>

<table class="summaryTable">
<tr><td colspan="3">
<div class="signature2">
public User <b>getByPhoneAndPassword</b>(string $phone, string $password)</div>
</td></tr>
<tr>
  <td class="paramNameCol">$phone</td>
  <td class="paramTypeCol">string</td>
  <td class="paramDescCol">phone</td>
</tr>
<tr>
  <td class="paramNameCol">$password</td>
  <td class="paramTypeCol">string</td>
  <td class="paramDescCol">password</td>
</tr>
<tr>
  <td class="paramNameCol">{return}</td>
  <td class="paramTypeCol">User</td>
  <td class="paramDescCol"></td>
</tr>
</table>

<div class="sourceCode">
<b>Source Code:</b>  (<b><a href="#" class="show">show</a></b>)
<div class="code"><code><span style="color: #000000">
<span style="color: #0000BB"></span><span style="color: #007700">public&nbsp;function&nbsp;</span><span style="color: #0000BB">getByPhoneAndPassword</span><span style="color: #007700">(</span><span style="color: #0000BB">$phone</span><span style="color: #007700">,&nbsp;</span><span style="color: #0000BB">$password</span><span style="color: #007700">)&nbsp;{<br />&nbsp;&nbsp;&nbsp;&nbsp;return&nbsp;</span><span style="color: #0000BB">User</span><span style="color: #007700">::</span><span style="color: #0000BB">model</span><span style="color: #007700">()<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;-&gt;</span><span style="color: #0000BB">find</span><span style="color: #007700">(</span><span style="color: #DD0000">'phone&nbsp;=&nbsp;:phone&nbsp;and&nbsp;password&nbsp;=&nbsp;:password&nbsp;and&nbsp;(roleId&nbsp;=&nbsp;:role_teacher&nbsp;or&nbsp;roleId&nbsp;=&nbsp;:role_stu&nbsp;or&nbsp;roleId&nbsp;=&nbsp;:role_anonymous)'</span><span style="color: #007700">,<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;array(</span><span style="color: #DD0000">'phone'&nbsp;</span><span style="color: #007700">=&gt;&nbsp;</span><span style="color: #0000BB">$phone</span><span style="color: #007700">,&nbsp;</span><span style="color: #DD0000">'password'&nbsp;</span><span style="color: #007700">=&gt;&nbsp;</span><span style="color: #0000BB">sha1</span><span style="color: #007700">(</span><span style="color: #0000BB">$password</span><span style="color: #007700">),<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span style="color: #DD0000">'role_teacher'&nbsp;</span><span style="color: #007700">=&gt;&nbsp;</span><span style="color: #0000BB">Contents</span><span style="color: #007700">::</span><span style="color: #0000BB">ROLE_TEACHER</span><span style="color: #007700">,<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span style="color: #DD0000">'role_stu'&nbsp;</span><span style="color: #007700">=&gt;&nbsp;</span><span style="color: #0000BB">Contents</span><span style="color: #007700">::</span><span style="color: #0000BB">ROLE_STU</span><span style="color: #007700">,<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span style="color: #DD0000">'role_anonymous'&nbsp;</span><span style="color: #007700">=&gt;&nbsp;</span><span style="color: #0000BB">Contents</span><span style="color: #007700">::</span><span style="color: #0000BB">ROLE_ANONYMOUS</span><span style="color: #007700">));<br />}</span>
</span>
</code></div>
</div>

<p>根据电话号码和密码取得用户数据，适用于老师或学生在手机端登录。
Retrieve a model by phone and password</p>


<div class="detailHeader" id="getByUsernameAndPassword-detail">
getByUsernameAndPassword()
<span class="detailHeaderTag">
method
</span>
</div>

<table class="summaryTable">
<tr><td colspan="3">
<div class="signature2">
public User <b>getByUsernameAndPassword</b>(string $username, string $password)</div>
</td></tr>
<tr>
  <td class="paramNameCol">$username</td>
  <td class="paramTypeCol">string</td>
  <td class="paramDescCol"></td>
</tr>
<tr>
  <td class="paramNameCol">$password</td>
  <td class="paramTypeCol">string</td>
  <td class="paramDescCol"></td>
</tr>
<tr>
  <td class="paramNameCol">{return}</td>
  <td class="paramTypeCol">User</td>
  <td class="paramDescCol"></td>
</tr>
</table>

<div class="sourceCode">
<b>Source Code:</b>  (<b><a href="#" class="show">show</a></b>)
<div class="code"><code><span style="color: #000000">
<span style="color: #0000BB"></span><span style="color: #007700">public&nbsp;function&nbsp;</span><span style="color: #0000BB">getByUsernameAndPassword</span><span style="color: #007700">(</span><span style="color: #0000BB">$username</span><span style="color: #007700">,&nbsp;</span><span style="color: #0000BB">$password</span><span style="color: #007700">){<br />&nbsp;&nbsp;&nbsp;&nbsp;return&nbsp;</span><span style="color: #0000BB">User</span><span style="color: #007700">::</span><span style="color: #0000BB">model</span><span style="color: #007700">()-&gt;</span><span style="color: #0000BB">find</span><span style="color: #007700">(</span><span style="color: #DD0000">'phone&nbsp;=&nbsp;:phone&nbsp;and&nbsp;password&nbsp;=&nbsp;:password&nbsp;and&nbsp;(roleId&nbsp;=&nbsp;:role_admin)'</span><span style="color: #007700">,&nbsp;array(</span><span style="color: #DD0000">'phone'&nbsp;</span><span style="color: #007700">=&gt;&nbsp;</span><span style="color: #0000BB">$username</span><span style="color: #007700">,&nbsp;</span><span style="color: #DD0000">'password'&nbsp;</span><span style="color: #007700">=&gt;&nbsp;</span><span style="color: #0000BB">sha1</span><span style="color: #007700">(</span><span style="color: #0000BB">$password</span><span style="color: #007700">),&nbsp;</span><span style="color: #DD0000">'role_admin'&nbsp;</span><span style="color: #007700">=&gt;&nbsp;</span><span style="color: #0000BB">Contents</span><span style="color: #007700">::</span><span style="color: #0000BB">ROLE_ADMIN</span><span style="color: #007700">));<br />}</span>
</span>
</code></div>
</div>

<p>根据账号和密码获得用户，适用于管理员在网站登录</p>


<div class="detailHeader" id="getList-detail">
getList()
<span class="detailHeaderTag">
method
</span>
</div>

<table class="summaryTable">
<tr><td colspan="3">
<div class="signature2">
public array <b>getList</b>(string $categoryIds, string $name, string $locationX, string $locationY, string $roleId, string $count, string $page, string $userId, string $order, $mile $mile, $cityId $cityId, bool $isMap=false)</div>
</td></tr>
<tr>
  <td class="paramNameCol">$categoryIds</td>
  <td class="paramTypeCol">string</td>
  <td class="paramDescCol"></td>
</tr>
<tr>
  <td class="paramNameCol">$name</td>
  <td class="paramTypeCol">string</td>
  <td class="paramDescCol"></td>
</tr>
<tr>
  <td class="paramNameCol">$locationX</td>
  <td class="paramTypeCol">string</td>
  <td class="paramDescCol"></td>
</tr>
<tr>
  <td class="paramNameCol">$locationY</td>
  <td class="paramTypeCol">string</td>
  <td class="paramDescCol"></td>
</tr>
<tr>
  <td class="paramNameCol">$roleId</td>
  <td class="paramTypeCol">string</td>
  <td class="paramDescCol"></td>
</tr>
<tr>
  <td class="paramNameCol">$count</td>
  <td class="paramTypeCol">string</td>
  <td class="paramDescCol"></td>
</tr>
<tr>
  <td class="paramNameCol">$page</td>
  <td class="paramTypeCol">string</td>
  <td class="paramDescCol"></td>
</tr>
<tr>
  <td class="paramNameCol">$userId</td>
  <td class="paramTypeCol">string</td>
  <td class="paramDescCol"></td>
</tr>
<tr>
  <td class="paramNameCol">$order</td>
  <td class="paramTypeCol">string</td>
  <td class="paramDescCol"></td>
</tr>
<tr>
  <td class="paramNameCol">$mile</td>
  <td class="paramTypeCol">$mile</td>
  <td class="paramDescCol"></td>
</tr>
<tr>
  <td class="paramNameCol">$cityId</td>
  <td class="paramTypeCol">$cityId</td>
  <td class="paramDescCol"></td>
</tr>
<tr>
  <td class="paramNameCol">$isMap</td>
  <td class="paramTypeCol">bool</td>
  <td class="paramDescCol"></td>
</tr>
<tr>
  <td class="paramNameCol">{return}</td>
  <td class="paramTypeCol">array</td>
  <td class="paramDescCol">Teach</td>
</tr>
</table>

<div class="sourceCode">
<b>Source Code:</b>  (<b><a href="#" class="show">show</a></b>)
<div class="code"><code><span style="color: #000000">
<span style="color: #0000BB"></span><span style="color: #007700">public&nbsp;function&nbsp;</span><span style="color: #0000BB">getList</span><span style="color: #007700">(</span><span style="color: #0000BB">$categoryIds</span><span style="color: #007700">,</span><span style="color: #0000BB">$name</span><span style="color: #007700">,&nbsp;</span><span style="color: #0000BB">$locationX</span><span style="color: #007700">,&nbsp;</span><span style="color: #0000BB">$locationY</span><span style="color: #007700">,&nbsp;</span><span style="color: #0000BB">$roleId</span><span style="color: #007700">,&nbsp;</span><span style="color: #0000BB">$count</span><span style="color: #007700">,&nbsp;</span><span style="color: #0000BB">$page</span><span style="color: #007700">,</span><span style="color: #0000BB">$userId</span><span style="color: #007700">,</span><span style="color: #0000BB">$order</span><span style="color: #007700">,</span><span style="color: #0000BB">$mile</span><span style="color: #007700">,</span><span style="color: #0000BB">$cityId</span><span style="color: #007700">,</span><span style="color: #0000BB">$isMap&nbsp;</span><span style="color: #007700">=&nbsp;</span><span style="color: #0000BB">false</span><span style="color: #007700">)&nbsp;{<br />&nbsp;&nbsp;&nbsp;&nbsp;</span><span style="color: #FF8000">//if&nbsp;this&nbsp;line&nbsp;throw&nbsp;a&nbsp;exception,&nbsp;Change&nbsp;EConfig's&nbsp;$strictMode&nbsp;value&nbsp;to&nbsp;false<br />&nbsp;&nbsp;&nbsp;&nbsp;/*$radius&nbsp;=&nbsp;Yii::app()-&gt;config-&gt;get(Contents::USER_RADIUS_MILE_KEY);<br />&nbsp;&nbsp;&nbsp;&nbsp;if($radius&nbsp;==&nbsp;null){<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;Yii::app()-&gt;config-&gt;set(Contents::USER_RADIUS_MILE_KEY,Contents::USER_RADIUS_MILE);<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;$radius&nbsp;=&nbsp;Contents::USER_RADIUS_MILE;<br />&nbsp;&nbsp;&nbsp;&nbsp;}*/<br />&nbsp;&nbsp;&nbsp;&nbsp;</span><span style="color: #007700">if(!</span><span style="color: #0000BB">Tools</span><span style="color: #007700">::</span><span style="color: #0000BB">isEmpty</span><span style="color: #007700">(</span><span style="color: #0000BB">$mile</span><span style="color: #007700">)){<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span style="color: #0000BB">$around&nbsp;</span><span style="color: #007700">=&nbsp;</span><span style="color: #0000BB">LocationTool</span><span style="color: #007700">::</span><span style="color: #0000BB">getAround</span><span style="color: #007700">(</span><span style="color: #0000BB">$locationX</span><span style="color: #007700">,&nbsp;</span><span style="color: #0000BB">$locationY</span><span style="color: #007700">,&nbsp;</span><span style="color: #0000BB">$mile</span><span style="color: #007700">);<br />&nbsp;&nbsp;&nbsp;&nbsp;}<br />&nbsp;&nbsp;&nbsp;&nbsp;</span><span style="color: #0000BB">$connection&nbsp;</span><span style="color: #007700">=&nbsp;</span><span style="color: #0000BB">Yii</span><span style="color: #007700">::</span><span style="color: #0000BB">app</span><span style="color: #007700">()-&gt;</span><span style="color: #0000BB">db</span><span style="color: #007700">;<br />&nbsp;&nbsp;&nbsp;&nbsp;</span><span style="color: #0000BB">$command&nbsp;</span><span style="color: #007700">=&nbsp;</span><span style="color: #0000BB">$connection</span><span style="color: #007700">-&gt;</span><span style="color: #0000BB">createCommand</span><span style="color: #007700">();<br />&nbsp;&nbsp;&nbsp;&nbsp;</span><span style="color: #0000BB">$command<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span style="color: #007700">-&gt;</span><span style="color: #0000BB">selectDistinct</span><span style="color: #007700">(</span><span style="color: #DD0000">'t&nbsp;.*,&nbsp;p.name,p.shortName,&nbsp;u.roleId,&nbsp;u.phone,&nbsp;p.photo,<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;IFNULL(avg(ts.`star`),&nbsp;0)&nbsp;as&nbsp;star,COUNT(DISTINCT&nbsp;c.id)&nbsp;as&nbsp;collectCount&nbsp;,COUNT(DISTINCT&nbsp;cm.id)&nbsp;as&nbsp;commentCount,<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;CEILING(&nbsp;(2&nbsp;*&nbsp;6378.137*&nbsp;ASIN(SQRT(POW(SIN(PI()&nbsp;*&nbsp;('</span><span style="color: #007700">.</span><span style="color: #0000BB">$locationX</span><span style="color: #007700">.</span><span style="color: #DD0000">'&nbsp;-&nbsp;t.usuallyLocationX)/360),&nbsp;2)&nbsp;+&nbsp;COS(PI()&nbsp;*&nbsp;'</span><span style="color: #007700">.</span><span style="color: #0000BB">$locationX</span><span style="color: #007700">.</span><span style="color: #DD0000">'&nbsp;/&nbsp;180)<br />*&nbsp;COS(t.usuallyLocationX&nbsp;*&nbsp;PI()&nbsp;/&nbsp;180)&nbsp;*&nbsp;POW(SIN(PI()&nbsp;*&nbsp;('</span><span style="color: #007700">.</span><span style="color: #0000BB">$locationY</span><span style="color: #007700">.</span><span style="color: #DD0000">'&nbsp;-&nbsp;t.usuallyLocationY)&nbsp;/&nbsp;360),&nbsp;2))))&nbsp;*&nbsp;1000)&nbsp;as&nbsp;mile'</span><span style="color: #007700">)<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;-&gt;</span><span style="color: #0000BB">from</span><span style="color: #007700">(</span><span style="color: #0000BB">Teach</span><span style="color: #007700">::</span><span style="color: #0000BB">model</span><span style="color: #007700">()-&gt;</span><span style="color: #0000BB">tableName</span><span style="color: #007700">().</span><span style="color: #DD0000">'&nbsp;t'</span><span style="color: #007700">)<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;-&gt;</span><span style="color: #0000BB">join</span><span style="color: #007700">(</span><span style="color: #0000BB">User</span><span style="color: #007700">::</span><span style="color: #0000BB">model</span><span style="color: #007700">()-&gt;</span><span style="color: #0000BB">tableName</span><span style="color: #007700">().</span><span style="color: #DD0000">'&nbsp;u'</span><span style="color: #007700">,</span><span style="color: #DD0000">'t.id&nbsp;=&nbsp;u.id'</span><span style="color: #007700">)<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span style="color: #FF8000">//增加机构附近列表不可见<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span style="color: #007700">-&gt;</span><span style="color: #0000BB">join</span><span style="color: #007700">(</span><span style="color: #0000BB">UserSetting</span><span style="color: #007700">::</span><span style="color: #0000BB">model</span><span style="color: #007700">()-&gt;</span><span style="color: #0000BB">tableName</span><span style="color: #007700">().</span><span style="color: #DD0000">'&nbsp;us'</span><span style="color: #007700">,</span><span style="color: #DD0000">'us.id&nbsp;=&nbsp;u.id'</span><span style="color: #007700">)<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span style="color: #FF8000">//结束修改<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span style="color: #007700">-&gt;</span><span style="color: #0000BB">join</span><span style="color: #007700">(</span><span style="color: #0000BB">Profile</span><span style="color: #007700">::</span><span style="color: #0000BB">model</span><span style="color: #007700">()-&gt;</span><span style="color: #0000BB">tableName</span><span style="color: #007700">().</span><span style="color: #DD0000">'&nbsp;p'</span><span style="color: #007700">,</span><span style="color: #DD0000">'p.id&nbsp;=&nbsp;u.id'</span><span style="color: #007700">)<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;-&gt;</span><span style="color: #0000BB">join</span><span style="color: #007700">(</span><span style="color: #0000BB">TeachCategory</span><span style="color: #007700">::</span><span style="color: #0000BB">model</span><span style="color: #007700">()-&gt;</span><span style="color: #0000BB">tableName</span><span style="color: #007700">().</span><span style="color: #DD0000">'&nbsp;tc'</span><span style="color: #007700">,</span><span style="color: #DD0000">'tc.teachId&nbsp;=&nbsp;u.id'</span><span style="color: #007700">);<br />&nbsp;&nbsp;&nbsp;&nbsp;</span><span style="color: #FF8000">/*<br />&nbsp;&nbsp;&nbsp;&nbsp;//登录用户且查询的分类为空<br />&nbsp;&nbsp;&nbsp;&nbsp;if($userId&nbsp;!=&nbsp;null&nbsp;&amp;&amp;&nbsp;empty($categoryIds)&nbsp;&amp;&amp;&nbsp;Tools::isEmpty($name)){<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;$command<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;-&gt;join(UserCategory::model()-&gt;tableName().'&nbsp;uc','uc.categoryId&nbsp;=&nbsp;tc.categoryId');<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;//登录用户且查询的分类为空，直接关联查询<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;$command-&gt;andWhere('uc.userId&nbsp;=&nbsp;:userId',array('userId'=&gt;$userId));<br />&nbsp;&nbsp;&nbsp;&nbsp;}*/<br /><br />&nbsp;&nbsp;&nbsp;&nbsp;//区域<br />&nbsp;&nbsp;&nbsp;&nbsp;</span><span style="color: #007700">if(!</span><span style="color: #0000BB">Tools</span><span style="color: #007700">::</span><span style="color: #0000BB">isEmpty</span><span style="color: #007700">(</span><span style="color: #0000BB">$cityId</span><span style="color: #007700">)){<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span style="color: #0000BB">$command<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span style="color: #007700">-&gt;</span><span style="color: #0000BB">join</span><span style="color: #007700">(</span><span style="color: #0000BB">UserCity</span><span style="color: #007700">::</span><span style="color: #0000BB">model</span><span style="color: #007700">()-&gt;</span><span style="color: #0000BB">tableName</span><span style="color: #007700">().</span><span style="color: #DD0000">'&nbsp;uc'</span><span style="color: #007700">,</span><span style="color: #DD0000">'uc.userId&nbsp;=&nbsp;u.id'</span><span style="color: #007700">)<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;-&gt;</span><span style="color: #0000BB">join</span><span style="color: #007700">(</span><span style="color: #0000BB">City</span><span style="color: #007700">::</span><span style="color: #0000BB">model</span><span style="color: #007700">()-&gt;</span><span style="color: #0000BB">tableName</span><span style="color: #007700">().</span><span style="color: #DD0000">'&nbsp;c1'</span><span style="color: #007700">,</span><span style="color: #DD0000">'uc.cityId&nbsp;=&nbsp;c1.id'</span><span style="color: #007700">)<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;-&gt;</span><span style="color: #0000BB">join</span><span style="color: #007700">(</span><span style="color: #0000BB">City</span><span style="color: #007700">::</span><span style="color: #0000BB">model</span><span style="color: #007700">()-&gt;</span><span style="color: #0000BB">tableName</span><span style="color: #007700">().</span><span style="color: #DD0000">'&nbsp;c2'</span><span style="color: #007700">,</span><span style="color: #DD0000">'1&nbsp;=&nbsp;1'</span><span style="color: #007700">);<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span style="color: #0000BB">$command</span><span style="color: #007700">-&gt;</span><span style="color: #0000BB">andWhere</span><span style="color: #007700">(</span><span style="color: #DD0000">"c1.code&nbsp;LIKE&nbsp;CONCAT(c2.code,'%')&nbsp;and&nbsp;c2.id&nbsp;=&nbsp;:cityId"</span><span style="color: #007700">,array(</span><span style="color: #DD0000">'cityId'</span><span style="color: #007700">=&gt;</span><span style="color: #0000BB">$cityId</span><span style="color: #007700">));<br />&nbsp;&nbsp;&nbsp;&nbsp;}<br /><br />&nbsp;&nbsp;&nbsp;&nbsp;</span><span style="color: #0000BB">$command</span><span style="color: #007700">-&gt;</span><span style="color: #0000BB">leftJoin</span><span style="color: #007700">(</span><span style="color: #0000BB">TeachStar</span><span style="color: #007700">::</span><span style="color: #0000BB">model</span><span style="color: #007700">()-&gt;</span><span style="color: #0000BB">tableName</span><span style="color: #007700">().</span><span style="color: #DD0000">'&nbsp;ts'</span><span style="color: #007700">,</span><span style="color: #DD0000">'ts.teachId&nbsp;=&nbsp;u.id'</span><span style="color: #007700">)<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;-&gt;</span><span style="color: #0000BB">leftJoin</span><span style="color: #007700">(</span><span style="color: #0000BB">Collect</span><span style="color: #007700">::</span><span style="color: #0000BB">model</span><span style="color: #007700">()-&gt;</span><span style="color: #0000BB">tableName</span><span style="color: #007700">().</span><span style="color: #DD0000">'&nbsp;c'</span><span style="color: #007700">,</span><span style="color: #DD0000">'c.collectId&nbsp;=&nbsp;u.id'</span><span style="color: #007700">)<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;-&gt;</span><span style="color: #0000BB">leftJoin</span><span style="color: #007700">(</span><span style="color: #0000BB">Comments</span><span style="color: #007700">::</span><span style="color: #0000BB">model</span><span style="color: #007700">()-&gt;</span><span style="color: #0000BB">tableName</span><span style="color: #007700">().</span><span style="color: #DD0000">'&nbsp;cm'</span><span style="color: #007700">,</span><span style="color: #DD0000">'cm.commentsId&nbsp;=&nbsp;u.id&nbsp;and&nbsp;cm.isDelete&nbsp;=&nbsp;'</span><span style="color: #007700">.</span><span style="color: #0000BB">Contents</span><span style="color: #007700">::</span><span style="color: #0000BB">F</span><span style="color: #007700">);<br />&nbsp;&nbsp;&nbsp;&nbsp;if(!</span><span style="color: #0000BB">Tools</span><span style="color: #007700">::</span><span style="color: #0000BB">isEmpty</span><span style="color: #007700">(</span><span style="color: #0000BB">$mile</span><span style="color: #007700">)){<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span style="color: #0000BB">$command</span><span style="color: #007700">-&gt;</span><span style="color: #0000BB">andWhere</span><span style="color: #007700">(</span><span style="color: #DD0000">'t.usuallyLocationX&nbsp;&gt;&nbsp;:minLat'</span><span style="color: #007700">,array(</span><span style="color: #DD0000">'minLat'</span><span style="color: #007700">=&gt;</span><span style="color: #0000BB">$around</span><span style="color: #007700">[</span><span style="color: #DD0000">'minLat'</span><span style="color: #007700">]))<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;-&gt;</span><span style="color: #0000BB">andWhere</span><span style="color: #007700">(</span><span style="color: #DD0000">'t.usuallyLocationX&nbsp;&lt;&nbsp;:maxLat'</span><span style="color: #007700">,array(</span><span style="color: #DD0000">'maxLat'</span><span style="color: #007700">=&gt;</span><span style="color: #0000BB">$around</span><span style="color: #007700">[</span><span style="color: #DD0000">'maxLat'</span><span style="color: #007700">]))<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;-&gt;</span><span style="color: #0000BB">andWhere</span><span style="color: #007700">(</span><span style="color: #DD0000">'t.usuallyLocationY&nbsp;&gt;&nbsp;:minLng'</span><span style="color: #007700">,array(</span><span style="color: #DD0000">'minLng'</span><span style="color: #007700">=&gt;</span><span style="color: #0000BB">$around</span><span style="color: #007700">[</span><span style="color: #DD0000">'minLng'</span><span style="color: #007700">]))<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;-&gt;</span><span style="color: #0000BB">andWhere</span><span style="color: #007700">(</span><span style="color: #DD0000">'t.usuallyLocationY&nbsp;&lt;&nbsp;:maxLng'</span><span style="color: #007700">,array(</span><span style="color: #DD0000">'maxLng'</span><span style="color: #007700">=&gt;</span><span style="color: #0000BB">$around</span><span style="color: #007700">[</span><span style="color: #DD0000">'maxLng'</span><span style="color: #007700">]));<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span style="color: #0000BB">$command</span><span style="color: #007700">-&gt;</span><span style="color: #0000BB">having</span><span style="color: #007700">(</span><span style="color: #DD0000">'mile&nbsp;&lt;=&nbsp;:mile'</span><span style="color: #007700">,array(</span><span style="color: #DD0000">'mile'</span><span style="color: #007700">=&gt;</span><span style="color: #0000BB">$mile</span><span style="color: #007700">));<br />&nbsp;&nbsp;&nbsp;&nbsp;}<br />&nbsp;&nbsp;&nbsp;&nbsp;</span><span style="color: #0000BB">$command</span><span style="color: #007700">-&gt;</span><span style="color: #0000BB">andWhere</span><span style="color: #007700">(</span><span style="color: #DD0000">'u.isDelete&nbsp;=&nbsp;:isDelete'</span><span style="color: #007700">,array(</span><span style="color: #DD0000">'isDelete'</span><span style="color: #007700">=&gt;</span><span style="color: #0000BB">Contents</span><span style="color: #007700">::</span><span style="color: #0000BB">F</span><span style="color: #007700">))<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span style="color: #FF8000">//增加机构附近列表可见<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span style="color: #007700">-&gt;</span><span style="color: #0000BB">andWhere</span><span style="color: #007700">(</span><span style="color: #DD0000">'us.map&nbsp;=&nbsp;:map'</span><span style="color: #007700">,array(</span><span style="color: #DD0000">'map'</span><span style="color: #007700">=&gt;</span><span style="color: #0000BB">Contents</span><span style="color: #007700">::</span><span style="color: #0000BB">T</span><span style="color: #007700">));<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span style="color: #FF8000">//增加统计评论时，删除的评论一并被统计了<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;//-&gt;andWhere('cm.isDelete&nbsp;=&nbsp;:isDelete',array('isDelete'=&gt;Contents::F));<br /><br />&nbsp;&nbsp;&nbsp;&nbsp;</span><span style="color: #007700">if(</span><span style="color: #0000BB">$userId&nbsp;</span><span style="color: #007700">!=&nbsp;</span><span style="color: #0000BB">null</span><span style="color: #007700">){<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span style="color: #FF8000">//登录用户&nbsp;不查询出自己。<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span style="color: #0000BB">$command</span><span style="color: #007700">-&gt;</span><span style="color: #0000BB">andWhere</span><span style="color: #007700">(</span><span style="color: #DD0000">'u.id&nbsp;!=&nbsp;:userId'</span><span style="color: #007700">,array(</span><span style="color: #DD0000">'userId'</span><span style="color: #007700">=&gt;</span><span style="color: #0000BB">$userId</span><span style="color: #007700">));<br />&nbsp;&nbsp;&nbsp;&nbsp;}<br />&nbsp;&nbsp;&nbsp;&nbsp;</span><span style="color: #FF8000">//搜索分类时的查询<br />&nbsp;&nbsp;&nbsp;&nbsp;</span><span style="color: #007700">if(!empty(</span><span style="color: #0000BB">$categoryIds</span><span style="color: #007700">)){<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span style="color: #0000BB">CategoryHot</span><span style="color: #007700">::</span><span style="color: #0000BB">model</span><span style="color: #007700">()-&gt;</span><span style="color: #0000BB">addCategoryHots</span><span style="color: #007700">(</span><span style="color: #0000BB">$categoryIds</span><span style="color: #007700">);<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span style="color: #0000BB">$command<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span style="color: #007700">-&gt;</span><span style="color: #0000BB">join</span><span style="color: #007700">(</span><span style="color: #0000BB">Category</span><span style="color: #007700">::</span><span style="color: #0000BB">model</span><span style="color: #007700">()-&gt;</span><span style="color: #0000BB">tableName</span><span style="color: #007700">().</span><span style="color: #DD0000">'&nbsp;tc1'</span><span style="color: #007700">,</span><span style="color: #DD0000">'tc1.id&nbsp;=&nbsp;tc.categoryId'</span><span style="color: #007700">);<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span style="color: #0000BB">$command</span><span style="color: #007700">-&gt;</span><span style="color: #0000BB">andWhere</span><span style="color: #007700">(<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;array(</span><span style="color: #DD0000">'OR'</span><span style="color: #007700">,<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;array(</span><span style="color: #DD0000">'in'</span><span style="color: #007700">,&nbsp;</span><span style="color: #DD0000">'tc1.id'</span><span style="color: #007700">,&nbsp;</span><span style="color: #0000BB">$categoryIds</span><span style="color: #007700">),</span><span style="color: #FF8000">//当前分类<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span style="color: #007700">array(</span><span style="color: #DD0000">'in'</span><span style="color: #007700">,&nbsp;</span><span style="color: #DD0000">'tc1.parentId'</span><span style="color: #007700">,&nbsp;</span><span style="color: #0000BB">$categoryIds</span><span style="color: #007700">),</span><span style="color: #FF8000">//父类是传入的ID<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span style="color: #007700">)<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;);<br />&nbsp;&nbsp;&nbsp;&nbsp;}<br />&nbsp;&nbsp;&nbsp;&nbsp;</span><span style="color: #FF8000">//搜索名称时候的查询<br />&nbsp;&nbsp;&nbsp;&nbsp;</span><span style="color: #007700">if(!</span><span style="color: #0000BB">Tools</span><span style="color: #007700">::</span><span style="color: #0000BB">isEmpty</span><span style="color: #007700">(</span><span style="color: #0000BB">$name</span><span style="color: #007700">)){<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span style="color: #FF8000">//添加关键字搜索分类名称<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span style="color: #0000BB">$command<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span style="color: #007700">-&gt;</span><span style="color: #0000BB">leftJoin</span><span style="color: #007700">(</span><span style="color: #0000BB">Category</span><span style="color: #007700">::</span><span style="color: #0000BB">model</span><span style="color: #007700">()-&gt;</span><span style="color: #0000BB">tableName</span><span style="color: #007700">().</span><span style="color: #DD0000">'&nbsp;category'</span><span style="color: #007700">,</span><span style="color: #DD0000">'category.id&nbsp;=&nbsp;tc.categoryId'</span><span style="color: #007700">);<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span style="color: #0000BB">$searchKey&nbsp;</span><span style="color: #007700">=&nbsp;</span><span style="color: #0000BB">preg_split</span><span style="color: #007700">(</span><span style="color: #DD0000">'/[\s]+/'</span><span style="color: #007700">,</span><span style="color: #0000BB">$name</span><span style="color: #007700">);<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;foreach(</span><span style="color: #0000BB">$searchKey&nbsp;</span><span style="color: #007700">as&nbsp;</span><span style="color: #0000BB">$key</span><span style="color: #007700">=&gt;</span><span style="color: #0000BB">$value</span><span style="color: #007700">){<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span style="color: #0000BB">$command</span><span style="color: #007700">-&gt;</span><span style="color: #0000BB">andWhere</span><span style="color: #007700">(<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;array(</span><span style="color: #DD0000">'OR'</span><span style="color: #007700">,<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;array(</span><span style="color: #DD0000">'like'</span><span style="color: #007700">,&nbsp;</span><span style="color: #DD0000">'p.name'</span><span style="color: #007700">,&nbsp;</span><span style="color: #DD0000">'%'</span><span style="color: #007700">.</span><span style="color: #0000BB">$value</span><span style="color: #007700">.</span><span style="color: #DD0000">'%'</span><span style="color: #007700">),</span><span style="color: #FF8000">//老师或机构名字<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span style="color: #007700">array(</span><span style="color: #DD0000">'like'</span><span style="color: #007700">,&nbsp;</span><span style="color: #DD0000">'category.name'</span><span style="color: #007700">,&nbsp;</span><span style="color: #DD0000">'%'</span><span style="color: #007700">.</span><span style="color: #0000BB">$value</span><span style="color: #007700">.</span><span style="color: #DD0000">'%'</span><span style="color: #007700">),</span><span style="color: #FF8000">//分类名称<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span style="color: #007700">)<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;);<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;}<br />&nbsp;&nbsp;&nbsp;&nbsp;}<br />&nbsp;&nbsp;&nbsp;&nbsp;if(</span><span style="color: #0000BB">$roleId&nbsp;</span><span style="color: #007700">!=&nbsp;</span><span style="color: #0000BB">null&nbsp;</span><span style="color: #007700">&amp;&amp;&nbsp;</span><span style="color: #0000BB">trim</span><span style="color: #007700">(</span><span style="color: #0000BB">$roleId</span><span style="color: #007700">)&nbsp;!=&nbsp;</span><span style="color: #DD0000">''</span><span style="color: #007700">){<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span style="color: #0000BB">$command</span><span style="color: #007700">-&gt;</span><span style="color: #0000BB">andWhere</span><span style="color: #007700">(</span><span style="color: #DD0000">'u.roleId&nbsp;=&nbsp;:roleId'</span><span style="color: #007700">,array(</span><span style="color: #DD0000">'roleId'</span><span style="color: #007700">=&gt;</span><span style="color: #0000BB">$roleId</span><span style="color: #007700">));<br />&nbsp;&nbsp;&nbsp;&nbsp;}<br />&nbsp;&nbsp;&nbsp;&nbsp;</span><span style="color: #0000BB">$order_num&nbsp;</span><span style="color: #007700">=&nbsp;</span><span style="color: #DD0000">"CAST(IF(TRIM(u.order)=''&nbsp;,9999999999,u.order)&nbsp;AS&nbsp;UNSIGNED)"</span><span style="color: #007700">;<br />&nbsp;&nbsp;&nbsp;&nbsp;</span><span style="color: #0000BB">$order_sql&nbsp;</span><span style="color: #007700">=&nbsp;</span><span style="color: #DD0000">"</span><span style="color: #0000BB">$order_num</span><span style="color: #DD0000">&nbsp;ASC,mile&nbsp;ASC"</span><span style="color: #007700">;<br />&nbsp;&nbsp;&nbsp;&nbsp;if(</span><span style="color: #0000BB">$order&nbsp;</span><span style="color: #007700">==&nbsp;</span><span style="color: #0000BB">Contents</span><span style="color: #007700">::</span><span style="color: #0000BB">USER_LIST_ORDER_COLLECT</span><span style="color: #007700">){<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span style="color: #0000BB">$order_sql&nbsp;</span><span style="color: #007700">=</span><span style="color: #DD0000">"</span><span style="color: #0000BB">$order_num</span><span style="color: #DD0000">&nbsp;ASC,collectCount&nbsp;DESC,mile&nbsp;ASC"</span><span style="color: #007700">;<br />&nbsp;&nbsp;&nbsp;&nbsp;}else&nbsp;if(</span><span style="color: #0000BB">$order&nbsp;</span><span style="color: #007700">==&nbsp;</span><span style="color: #0000BB">Contents</span><span style="color: #007700">::</span><span style="color: #0000BB">USER_LIST_ORDER_COMMENT</span><span style="color: #007700">){<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span style="color: #0000BB">$order_sql&nbsp;</span><span style="color: #007700">=</span><span style="color: #DD0000">"</span><span style="color: #0000BB">$order_num</span><span style="color: #DD0000">&nbsp;ASC,commentCount&nbsp;DESC,mile&nbsp;ASC"</span><span style="color: #007700">;<br />&nbsp;&nbsp;&nbsp;&nbsp;}else&nbsp;if(</span><span style="color: #0000BB">$order&nbsp;</span><span style="color: #007700">==&nbsp;</span><span style="color: #0000BB">Contents</span><span style="color: #007700">::</span><span style="color: #0000BB">USER_LIST_ORDER_STAR</span><span style="color: #007700">){<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span style="color: #0000BB">$order_sql&nbsp;</span><span style="color: #007700">=</span><span style="color: #DD0000">"</span><span style="color: #0000BB">$order_num</span><span style="color: #DD0000">&nbsp;ASC,star&nbsp;DESC,mile&nbsp;ASC"</span><span style="color: #007700">;<br />&nbsp;&nbsp;&nbsp;&nbsp;}<br />&nbsp;&nbsp;&nbsp;&nbsp;</span><span style="color: #0000BB">$command</span><span style="color: #007700">-&gt;</span><span style="color: #0000BB">group</span><span style="color: #007700">(</span><span style="color: #DD0000">'t.id'</span><span style="color: #007700">);<br />&nbsp;&nbsp;&nbsp;&nbsp;</span><span style="color: #0000BB">$command</span><span style="color: #007700">-&gt;</span><span style="color: #0000BB">order</span><span style="color: #007700">(</span><span style="color: #0000BB">$order_sql</span><span style="color: #007700">)<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;-&gt;</span><span style="color: #0000BB">limit</span><span style="color: #007700">(</span><span style="color: #0000BB">$count</span><span style="color: #007700">)<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;-&gt;</span><span style="color: #0000BB">offset</span><span style="color: #007700">((</span><span style="color: #0000BB">$page</span><span style="color: #007700">-</span><span style="color: #0000BB">1</span><span style="color: #007700">)&nbsp;*&nbsp;</span><span style="color: #0000BB">$count</span><span style="color: #007700">);<br />&nbsp;&nbsp;&nbsp;&nbsp;</span><span style="color: #FF8000">//$list&nbsp;=&nbsp;$command-&gt;query();<br />&nbsp;&nbsp;&nbsp;&nbsp;</span><span style="color: #0000BB">$teachList&nbsp;</span><span style="color: #007700">=&nbsp;</span><span style="color: #0000BB">Teach</span><span style="color: #007700">::</span><span style="color: #0000BB">model</span><span style="color: #007700">()-&gt;</span><span style="color: #0000BB">findAllBySql</span><span style="color: #007700">(</span><span style="color: #0000BB">$command</span><span style="color: #007700">-&gt;</span><span style="color: #0000BB">text</span><span style="color: #007700">,</span><span style="color: #0000BB">$command</span><span style="color: #007700">-&gt;</span><span style="color: #0000BB">params</span><span style="color: #007700">);<br />&nbsp;&nbsp;&nbsp;&nbsp;</span><span style="color: #0000BB">$data&nbsp;</span><span style="color: #007700">=&nbsp;array();<br />&nbsp;&nbsp;&nbsp;&nbsp;foreach&nbsp;(</span><span style="color: #0000BB">$teachList&nbsp;</span><span style="color: #007700">as&nbsp;</span><span style="color: #0000BB">$key</span><span style="color: #007700">=&gt;</span><span style="color: #0000BB">$value</span><span style="color: #007700">){<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span style="color: #0000BB">$array&nbsp;</span><span style="color: #007700">=&nbsp;array();<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;if(</span><span style="color: #0000BB">Tools</span><span style="color: #007700">::</span><span style="color: #0000BB">isEmpty</span><span style="color: #007700">(</span><span style="color: #0000BB">$value</span><span style="color: #007700">-&gt;</span><span style="color: #0000BB">id</span><span style="color: #007700">)){<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;continue;<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;}<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span style="color: #0000BB">$array</span><span style="color: #007700">[</span><span style="color: #DD0000">'userId'</span><span style="color: #007700">]&nbsp;=&nbsp;</span><span style="color: #0000BB">$value</span><span style="color: #007700">-&gt;</span><span style="color: #0000BB">id</span><span style="color: #007700">;<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span style="color: #0000BB">$array</span><span style="color: #007700">[</span><span style="color: #DD0000">'skill'</span><span style="color: #007700">]&nbsp;=&nbsp;</span><span style="color: #0000BB">$value</span><span style="color: #007700">-&gt;</span><span style="color: #0000BB">skill</span><span style="color: #007700">;<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span style="color: #0000BB">$array</span><span style="color: #007700">[</span><span style="color: #DD0000">'location'</span><span style="color: #007700">][</span><span style="color: #DD0000">'x'</span><span style="color: #007700">]&nbsp;=&nbsp;</span><span style="color: #0000BB">$value</span><span style="color: #007700">-&gt;</span><span style="color: #0000BB">usuallyLocationX</span><span style="color: #007700">;<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span style="color: #0000BB">$array</span><span style="color: #007700">[</span><span style="color: #DD0000">'location'</span><span style="color: #007700">][</span><span style="color: #DD0000">'y'</span><span style="color: #007700">]&nbsp;=&nbsp;</span><span style="color: #0000BB">$value</span><span style="color: #007700">-&gt;</span><span style="color: #0000BB">usuallyLocationY</span><span style="color: #007700">;<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span style="color: #0000BB">$array</span><span style="color: #007700">[</span><span style="color: #DD0000">'location'</span><span style="color: #007700">][</span><span style="color: #DD0000">'info'</span><span style="color: #007700">]&nbsp;=&nbsp;</span><span style="color: #0000BB">$value</span><span style="color: #007700">-&gt;</span><span style="color: #0000BB">usuallyLocationInfo</span><span style="color: #007700">;<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;if(</span><span style="color: #0000BB">$value</span><span style="color: #007700">-&gt;</span><span style="color: #0000BB">avgPrice&nbsp;</span><span style="color: #007700">==&nbsp;</span><span style="color: #0000BB">0</span><span style="color: #007700">){<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span style="color: #0000BB">$array</span><span style="color: #007700">[</span><span style="color: #DD0000">'price'</span><span style="color: #007700">]&nbsp;=&nbsp;</span><span style="color: #0000BB">$value</span><span style="color: #007700">-&gt;</span><span style="color: #0000BB">price</span><span style="color: #007700">;<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;}else{<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span style="color: #0000BB">$array</span><span style="color: #007700">[</span><span style="color: #DD0000">'price'</span><span style="color: #007700">]&nbsp;=&nbsp;</span><span style="color: #0000BB">$value</span><span style="color: #007700">-&gt;</span><span style="color: #0000BB">avgPrice</span><span style="color: #007700">;<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;}<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span style="color: #0000BB">$array</span><span style="color: #007700">[</span><span style="color: #DD0000">'mile'</span><span style="color: #007700">]&nbsp;=&nbsp;</span><span style="color: #0000BB">$value</span><span style="color: #007700">-&gt;</span><span style="color: #0000BB">mile</span><span style="color: #007700">;<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span style="color: #0000BB">$array</span><span style="color: #007700">[</span><span style="color: #DD0000">'name'</span><span style="color: #007700">]&nbsp;=&nbsp;</span><span style="color: #0000BB">$value</span><span style="color: #007700">-&gt;</span><span style="color: #0000BB">name</span><span style="color: #007700">;<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span style="color: #0000BB">$array</span><span style="color: #007700">[</span><span style="color: #DD0000">'shortName'</span><span style="color: #007700">]&nbsp;=&nbsp;</span><span style="color: #0000BB">$value</span><span style="color: #007700">-&gt;</span><span style="color: #0000BB">shortName</span><span style="color: #007700">;<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span style="color: #0000BB">$array</span><span style="color: #007700">[</span><span style="color: #DD0000">'photo'</span><span style="color: #007700">]&nbsp;=&nbsp;</span><span style="color: #0000BB">$value</span><span style="color: #007700">-&gt;</span><span style="color: #0000BB">photo</span><span style="color: #007700">;<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span style="color: #0000BB">$array</span><span style="color: #007700">[</span><span style="color: #DD0000">'roleId'</span><span style="color: #007700">]&nbsp;=&nbsp;</span><span style="color: #0000BB">$value</span><span style="color: #007700">-&gt;</span><span style="color: #0000BB">roleId</span><span style="color: #007700">;<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span style="color: #FF8000">//获得被收藏的数量<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;/*$user_collect_count&nbsp;=&nbsp;Collect::model()-&gt;getCountByCollectId($array['userId']);<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;$array['collectCount']&nbsp;=&nbsp;$user_collect_count;*/<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span style="color: #0000BB">$array</span><span style="color: #007700">[</span><span style="color: #DD0000">'collectCount'</span><span style="color: #007700">]&nbsp;=&nbsp;</span><span style="color: #0000BB">$value</span><span style="color: #007700">-&gt;</span><span style="color: #0000BB">collectCount</span><span style="color: #007700">;<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span style="color: #FF8000">//评价星级<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;/*$user_video_star&nbsp;=&nbsp;$value-&gt;teachStarsAvg;<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;$array['star']&nbsp;=&nbsp;$user_video_star;*/<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span style="color: #0000BB">$array</span><span style="color: #007700">[</span><span style="color: #DD0000">'star'</span><span style="color: #007700">]&nbsp;=&nbsp;</span><span style="color: #0000BB">$value</span><span style="color: #007700">-&gt;</span><span style="color: #0000BB">star</span><span style="color: #007700">;<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span style="color: #FF8000">//评论数<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span style="color: #0000BB">$array</span><span style="color: #007700">[</span><span style="color: #DD0000">'commentCount'</span><span style="color: #007700">]&nbsp;=&nbsp;</span><span style="color: #0000BB">$value</span><span style="color: #007700">-&gt;</span><span style="color: #0000BB">commentCount</span><span style="color: #007700">;<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span style="color: #0000BB">$array</span><span style="color: #007700">[</span><span style="color: #DD0000">'phone'</span><span style="color: #007700">]&nbsp;=&nbsp;</span><span style="color: #DD0000">''</span><span style="color: #007700">;<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;if(</span><span style="color: #0000BB">$array</span><span style="color: #007700">[</span><span style="color: #DD0000">'roleId'</span><span style="color: #007700">]&nbsp;==&nbsp;</span><span style="color: #0000BB">Contents</span><span style="color: #007700">::</span><span style="color: #0000BB">ROLE_ORG</span><span style="color: #007700">){<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span style="color: #0000BB">$array</span><span style="color: #007700">[</span><span style="color: #DD0000">'phone'</span><span style="color: #007700">]&nbsp;=&nbsp;</span><span style="color: #0000BB">$value</span><span style="color: #007700">-&gt;</span><span style="color: #0000BB">phone</span><span style="color: #007700">;<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;}<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span style="color: #0000BB">$isCollect&nbsp;</span><span style="color: #007700">=&nbsp;</span><span style="color: #0000BB">false</span><span style="color: #007700">;<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span style="color: #FF8000">//当前用户是否收藏<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span style="color: #007700">if(</span><span style="color: #0000BB">$userId&nbsp;</span><span style="color: #007700">!=&nbsp;</span><span style="color: #0000BB">null</span><span style="color: #007700">){<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span style="color: #0000BB">$collect&nbsp;</span><span style="color: #007700">=&nbsp;</span><span style="color: #0000BB">Collect</span><span style="color: #007700">::</span><span style="color: #0000BB">model</span><span style="color: #007700">()-&gt;</span><span style="color: #0000BB">getCollectByUCT</span><span style="color: #007700">(</span><span style="color: #0000BB">$userId</span><span style="color: #007700">,</span><span style="color: #0000BB">$array</span><span style="color: #007700">[</span><span style="color: #DD0000">'userId'</span><span style="color: #007700">],</span><span style="color: #0000BB">$array</span><span style="color: #007700">[</span><span style="color: #DD0000">'roleId'</span><span style="color: #007700">]);<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;if(</span><span style="color: #0000BB">$collect</span><span style="color: #007700">){<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span style="color: #0000BB">$isCollect&nbsp;</span><span style="color: #007700">=&nbsp;</span><span style="color: #0000BB">true</span><span style="color: #007700">;<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;}<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;}<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span style="color: #0000BB">$array</span><span style="color: #007700">[</span><span style="color: #DD0000">'introduction_image'</span><span style="color: #007700">]&nbsp;=&nbsp;</span><span style="color: #DD0000">''</span><span style="color: #007700">;<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span style="color: #0000BB">$array</span><span style="color: #007700">[</span><span style="color: #DD0000">'introduction_video'</span><span style="color: #007700">]&nbsp;=&nbsp;</span><span style="color: #DD0000">''</span><span style="color: #007700">;<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span style="color: #FF8000">//获得自我介绍<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span style="color: #0000BB">$user_introduction&nbsp;</span><span style="color: #007700">=&nbsp;</span><span style="color: #0000BB">$value</span><span style="color: #007700">-&gt;</span><span style="color: #0000BB">introduction</span><span style="color: #007700">;<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;if(</span><span style="color: #0000BB">$user_introduction</span><span style="color: #007700">){<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span style="color: #0000BB">$array</span><span style="color: #007700">[</span><span style="color: #DD0000">'introduction_video'</span><span style="color: #007700">]&nbsp;=&nbsp;</span><span style="color: #0000BB">$user_introduction</span><span style="color: #007700">-&gt;</span><span style="color: #0000BB">video</span><span style="color: #007700">;<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span style="color: #0000BB">$array</span><span style="color: #007700">[</span><span style="color: #DD0000">'introduction_image'</span><span style="color: #007700">]&nbsp;=&nbsp;</span><span style="color: #0000BB">$user_introduction</span><span style="color: #007700">-&gt;</span><span style="color: #0000BB">videoImage</span><span style="color: #007700">;<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;}<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span style="color: #FF8000">//获得一张个人介绍图片<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span style="color: #0000BB">$user_introduction_image&nbsp;</span><span style="color: #007700">=&nbsp;</span><span style="color: #0000BB">$value</span><span style="color: #007700">-&gt;</span><span style="color: #0000BB">introductionImage</span><span style="color: #007700">;<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;if(</span><span style="color: #0000BB">$user_introduction_image&nbsp;</span><span style="color: #007700">&amp;&amp;&nbsp;empty(</span><span style="color: #0000BB">$array</span><span style="color: #007700">[</span><span style="color: #DD0000">'introduction_image'</span><span style="color: #007700">])){<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span style="color: #FF8000">//没有视频截图时，使用个人介绍图片<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span style="color: #0000BB">$array</span><span style="color: #007700">[</span><span style="color: #DD0000">'introduction_image'</span><span style="color: #007700">]&nbsp;=&nbsp;</span><span style="color: #0000BB">$user_introduction_image</span><span style="color: #007700">-&gt;</span><span style="color: #0000BB">image</span><span style="color: #007700">;<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;}<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span style="color: #0000BB">$array</span><span style="color: #007700">[</span><span style="color: #DD0000">'isCollect'</span><span style="color: #007700">]&nbsp;=&nbsp;</span><span style="color: #0000BB">$isCollect</span><span style="color: #007700">;<br /><br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span style="color: #FF8000">//V信息<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span style="color: #0000BB">$user_vip_sign&nbsp;</span><span style="color: #007700">=&nbsp;</span><span style="color: #0000BB">$value</span><span style="color: #007700">-&gt;</span><span style="color: #0000BB">userVipSigns</span><span style="color: #007700">;<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span style="color: #0000BB">$v&nbsp;</span><span style="color: #007700">=&nbsp;array();<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;foreach&nbsp;(</span><span style="color: #0000BB">$user_vip_sign&nbsp;</span><span style="color: #007700">as&nbsp;</span><span style="color: #0000BB">$v_key</span><span style="color: #007700">=&gt;</span><span style="color: #0000BB">$v_value</span><span style="color: #007700">){<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span style="color: #0000BB">$v</span><span style="color: #007700">[</span><span style="color: #0000BB">$v_key</span><span style="color: #007700">][</span><span style="color: #DD0000">'id'</span><span style="color: #007700">]&nbsp;=&nbsp;</span><span style="color: #0000BB">$v_value</span><span style="color: #007700">-&gt;</span><span style="color: #0000BB">id</span><span style="color: #007700">;<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span style="color: #0000BB">$v</span><span style="color: #007700">[</span><span style="color: #0000BB">$v_key</span><span style="color: #007700">][</span><span style="color: #DD0000">'name'</span><span style="color: #007700">]&nbsp;=&nbsp;</span><span style="color: #0000BB">$v_value</span><span style="color: #007700">-&gt;</span><span style="color: #0000BB">name</span><span style="color: #007700">;<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span style="color: #0000BB">$v</span><span style="color: #007700">[</span><span style="color: #0000BB">$v_key</span><span style="color: #007700">][</span><span style="color: #DD0000">'icon'</span><span style="color: #007700">]&nbsp;=&nbsp;</span><span style="color: #0000BB">$v_value</span><span style="color: #007700">-&gt;</span><span style="color: #0000BB">icon</span><span style="color: #007700">;<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;}<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span style="color: #0000BB">$array</span><span style="color: #007700">[</span><span style="color: #DD0000">'v'</span><span style="color: #007700">]&nbsp;=&nbsp;</span><span style="color: #0000BB">$v</span><span style="color: #007700">;<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span style="color: #0000BB">$data</span><span style="color: #007700">[</span><span style="color: #0000BB">$key</span><span style="color: #007700">]&nbsp;=&nbsp;</span><span style="color: #0000BB">$array</span><span style="color: #007700">;<br />&nbsp;&nbsp;&nbsp;&nbsp;}<br /><br />&nbsp;&nbsp;&nbsp;&nbsp;</span><span style="color: #0000BB">$categoryArray&nbsp;</span><span style="color: #007700">=&nbsp;array();<br />&nbsp;&nbsp;&nbsp;&nbsp;if(!empty(</span><span style="color: #0000BB">$categoryIds</span><span style="color: #007700">)){<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span style="color: #0000BB">$criteria</span><span style="color: #007700">=&nbsp;new&nbsp;</span><span style="color: #0000BB">CDbCriteria</span><span style="color: #007700">;<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span style="color: #0000BB">$criteria</span><span style="color: #007700">-&gt;</span><span style="color: #0000BB">addInCondition</span><span style="color: #007700">(</span><span style="color: #DD0000">'id'</span><span style="color: #007700">,&nbsp;</span><span style="color: #0000BB">$categoryIds</span><span style="color: #007700">);<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span style="color: #0000BB">$categoryList&nbsp;</span><span style="color: #007700">=&nbsp;</span><span style="color: #0000BB">Category</span><span style="color: #007700">::</span><span style="color: #0000BB">model</span><span style="color: #007700">()-&gt;</span><span style="color: #0000BB">findAll</span><span style="color: #007700">(</span><span style="color: #0000BB">$criteria</span><span style="color: #007700">);<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;foreach&nbsp;(</span><span style="color: #0000BB">$categoryList&nbsp;</span><span style="color: #007700">as&nbsp;</span><span style="color: #0000BB">$key</span><span style="color: #007700">=&gt;</span><span style="color: #0000BB">$value</span><span style="color: #007700">){<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span style="color: #0000BB">$categoryArray</span><span style="color: #007700">[</span><span style="color: #0000BB">$key</span><span style="color: #007700">][</span><span style="color: #DD0000">'id'</span><span style="color: #007700">]&nbsp;=&nbsp;</span><span style="color: #0000BB">$value</span><span style="color: #007700">-&gt;</span><span style="color: #0000BB">id</span><span style="color: #007700">;<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span style="color: #0000BB">$categoryArray</span><span style="color: #007700">[</span><span style="color: #0000BB">$key</span><span style="color: #007700">][</span><span style="color: #DD0000">'name'</span><span style="color: #007700">]&nbsp;=&nbsp;</span><span style="color: #0000BB">$value</span><span style="color: #007700">-&gt;</span><span style="color: #0000BB">name</span><span style="color: #007700">;<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span style="color: #0000BB">$categoryArray</span><span style="color: #007700">[</span><span style="color: #0000BB">$key</span><span style="color: #007700">][</span><span style="color: #DD0000">'parentId'</span><span style="color: #007700">]&nbsp;=&nbsp;</span><span style="color: #0000BB">$value</span><span style="color: #007700">-&gt;</span><span style="color: #0000BB">parentId</span><span style="color: #007700">;<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span style="color: #0000BB">$categoryArray</span><span style="color: #007700">[</span><span style="color: #0000BB">$key</span><span style="color: #007700">][</span><span style="color: #DD0000">'icon'</span><span style="color: #007700">]&nbsp;=&nbsp;</span><span style="color: #0000BB">$value</span><span style="color: #007700">-&gt;</span><span style="color: #0000BB">icon</span><span style="color: #007700">;<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span style="color: #0000BB">$categoryArray</span><span style="color: #007700">[</span><span style="color: #0000BB">$key</span><span style="color: #007700">][</span><span style="color: #DD0000">'isDelete'</span><span style="color: #007700">]&nbsp;=&nbsp;</span><span style="color: #0000BB">$value</span><span style="color: #007700">-&gt;</span><span style="color: #0000BB">isDelete</span><span style="color: #007700">;<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;}<br />&nbsp;&nbsp;&nbsp;&nbsp;}<br /><br />&nbsp;&nbsp;&nbsp;&nbsp;if(</span><span style="color: #0000BB">$isMap</span><span style="color: #007700">){<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span style="color: #0000BB">$mergrData&nbsp;</span><span style="color: #007700">=&nbsp;array();<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span style="color: #0000BB">$this</span><span style="color: #007700">-&gt;</span><span style="color: #0000BB">merge</span><span style="color: #007700">(</span><span style="color: #0000BB">$data</span><span style="color: #007700">,</span><span style="color: #0000BB">$mergrData</span><span style="color: #007700">);<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;return&nbsp;array(</span><span style="color: #DD0000">'category'</span><span style="color: #007700">=&gt;</span><span style="color: #0000BB">$categoryArray</span><span style="color: #007700">,</span><span style="color: #DD0000">'userList'</span><span style="color: #007700">=&gt;</span><span style="color: #0000BB">$mergrData</span><span style="color: #007700">);<br />&nbsp;&nbsp;&nbsp;&nbsp;}<br />&nbsp;&nbsp;&nbsp;&nbsp;return&nbsp;array(</span><span style="color: #DD0000">'category'</span><span style="color: #007700">=&gt;</span><span style="color: #0000BB">$categoryArray</span><span style="color: #007700">,</span><span style="color: #DD0000">'userList'</span><span style="color: #007700">=&gt;</span><span style="color: #0000BB">$data</span><span style="color: #007700">);<br />}</span>
</span>
</code></div>
</div>

<p>根据用户经纬度获取附近的机构或老师，目前因为数据较小，以及用户较小，查询时，后台处理了距离，并分页。
如果用户量较多，并发量较高，服务器承受不住压力，应该去除分页功能并且固定显示附近的100或150用户，
例如：微信，忽略距离限制，始终固定显示100用户。
可实现如下:
查询3公里是否有100个用户，有返回，没有，则查询5公里，是否有100用户，有返回，如果还有没有，查询10公里或20公里，如果还是没有，返回用户，在里附近没有用户。
$isMap 是否是查询地图数据，</p>


<div class="detailHeader" id="getListCount-detail">
getListCount()
<span class="detailHeaderTag">
method
</span>
</div>

<table class="summaryTable">
<tr><td colspan="3">
<div class="signature2">
public integer <b>getListCount</b>(array $categoryIds, string $locationX, string $locationY, string $roleId, string $userId)</div>
</td></tr>
<tr>
  <td class="paramNameCol">$categoryIds</td>
  <td class="paramTypeCol">array</td>
  <td class="paramDescCol"></td>
</tr>
<tr>
  <td class="paramNameCol">$locationX</td>
  <td class="paramTypeCol">string</td>
  <td class="paramDescCol"></td>
</tr>
<tr>
  <td class="paramNameCol">$locationY</td>
  <td class="paramTypeCol">string</td>
  <td class="paramDescCol"></td>
</tr>
<tr>
  <td class="paramNameCol">$roleId</td>
  <td class="paramTypeCol">string</td>
  <td class="paramDescCol"></td>
</tr>
<tr>
  <td class="paramNameCol">$userId</td>
  <td class="paramTypeCol">string</td>
  <td class="paramDescCol"></td>
</tr>
<tr>
  <td class="paramNameCol">{return}</td>
  <td class="paramTypeCol">integer</td>
  <td class="paramDescCol"></td>
</tr>
</table>

<div class="sourceCode">
<b>Source Code:</b>  (<b><a href="#" class="show">show</a></b>)
<div class="code"><code><span style="color: #000000">
<span style="color: #0000BB"></span><span style="color: #007700">public&nbsp;function&nbsp;</span><span style="color: #0000BB">getListCount</span><span style="color: #007700">(</span><span style="color: #0000BB">$categoryIds</span><span style="color: #007700">,&nbsp;</span><span style="color: #0000BB">$locationX</span><span style="color: #007700">,&nbsp;</span><span style="color: #0000BB">$locationY</span><span style="color: #007700">,&nbsp;</span><span style="color: #0000BB">$roleId</span><span style="color: #007700">,</span><span style="color: #0000BB">$userId</span><span style="color: #007700">)&nbsp;{<br />&nbsp;&nbsp;&nbsp;&nbsp;</span><span style="color: #FF8000">//if&nbsp;this&nbsp;line&nbsp;throw&nbsp;a&nbsp;exception,&nbsp;Change&nbsp;EConfig's&nbsp;$strictMode&nbsp;value&nbsp;to&nbsp;false<br />&nbsp;&nbsp;&nbsp;&nbsp;</span><span style="color: #0000BB">$radius&nbsp;</span><span style="color: #007700">=&nbsp;</span><span style="color: #0000BB">Yii</span><span style="color: #007700">::</span><span style="color: #0000BB">app</span><span style="color: #007700">()-&gt;</span><span style="color: #0000BB">config</span><span style="color: #007700">-&gt;</span><span style="color: #0000BB">get</span><span style="color: #007700">(</span><span style="color: #0000BB">Contents</span><span style="color: #007700">::</span><span style="color: #0000BB">USER_RADIUS_MILE_KEY</span><span style="color: #007700">);<br />&nbsp;&nbsp;&nbsp;&nbsp;if(</span><span style="color: #0000BB">$radius&nbsp;</span><span style="color: #007700">==&nbsp;</span><span style="color: #0000BB">null</span><span style="color: #007700">){<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span style="color: #0000BB">Yii</span><span style="color: #007700">::</span><span style="color: #0000BB">app</span><span style="color: #007700">()-&gt;</span><span style="color: #0000BB">config</span><span style="color: #007700">-&gt;</span><span style="color: #0000BB">set</span><span style="color: #007700">(</span><span style="color: #0000BB">Contents</span><span style="color: #007700">::</span><span style="color: #0000BB">USER_RADIUS_MILE_KEY</span><span style="color: #007700">,</span><span style="color: #0000BB">Contents</span><span style="color: #007700">::</span><span style="color: #0000BB">USER_RADIUS_MILE</span><span style="color: #007700">);<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span style="color: #0000BB">$radius&nbsp;</span><span style="color: #007700">=&nbsp;</span><span style="color: #0000BB">Contents</span><span style="color: #007700">::</span><span style="color: #0000BB">USER_RADIUS_MILE</span><span style="color: #007700">;<br />&nbsp;&nbsp;&nbsp;&nbsp;}<br />&nbsp;&nbsp;&nbsp;&nbsp;</span><span style="color: #0000BB">$around&nbsp;</span><span style="color: #007700">=&nbsp;</span><span style="color: #0000BB">LocationTool</span><span style="color: #007700">::</span><span style="color: #0000BB">getAround</span><span style="color: #007700">(</span><span style="color: #0000BB">$locationX</span><span style="color: #007700">,&nbsp;</span><span style="color: #0000BB">$locationY</span><span style="color: #007700">,&nbsp;</span><span style="color: #0000BB">$radius</span><span style="color: #007700">);<br />&nbsp;&nbsp;&nbsp;&nbsp;</span><span style="color: #0000BB">$connection&nbsp;</span><span style="color: #007700">=&nbsp;</span><span style="color: #0000BB">Yii</span><span style="color: #007700">::</span><span style="color: #0000BB">app</span><span style="color: #007700">()-&gt;</span><span style="color: #0000BB">db</span><span style="color: #007700">;<br />&nbsp;&nbsp;&nbsp;&nbsp;</span><span style="color: #0000BB">$command&nbsp;</span><span style="color: #007700">=&nbsp;</span><span style="color: #0000BB">$connection</span><span style="color: #007700">-&gt;</span><span style="color: #0000BB">createCommand</span><span style="color: #007700">();<br />&nbsp;&nbsp;&nbsp;&nbsp;</span><span style="color: #0000BB">$command<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span style="color: #007700">-&gt;</span><span style="color: #0000BB">select</span><span style="color: #007700">(</span><span style="color: #DD0000">'count(distinct&nbsp;t.id)'</span><span style="color: #007700">)<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;-&gt;</span><span style="color: #0000BB">from</span><span style="color: #007700">(</span><span style="color: #0000BB">Teach</span><span style="color: #007700">::</span><span style="color: #0000BB">model</span><span style="color: #007700">()-&gt;</span><span style="color: #0000BB">tableName</span><span style="color: #007700">().</span><span style="color: #DD0000">'&nbsp;t'</span><span style="color: #007700">)<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;-&gt;</span><span style="color: #0000BB">join</span><span style="color: #007700">(</span><span style="color: #0000BB">User</span><span style="color: #007700">::</span><span style="color: #0000BB">model</span><span style="color: #007700">()-&gt;</span><span style="color: #0000BB">tableName</span><span style="color: #007700">().</span><span style="color: #DD0000">'&nbsp;u'</span><span style="color: #007700">,</span><span style="color: #DD0000">'t.id&nbsp;=&nbsp;u.id'</span><span style="color: #007700">)<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span style="color: #FF8000">//增加机构附近列表不可见<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span style="color: #007700">-&gt;</span><span style="color: #0000BB">join</span><span style="color: #007700">(</span><span style="color: #0000BB">UserSetting</span><span style="color: #007700">::</span><span style="color: #0000BB">model</span><span style="color: #007700">()-&gt;</span><span style="color: #0000BB">tableName</span><span style="color: #007700">().</span><span style="color: #DD0000">'&nbsp;us'</span><span style="color: #007700">,</span><span style="color: #DD0000">'us.id&nbsp;=&nbsp;u.id'</span><span style="color: #007700">)<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span style="color: #FF8000">//结束修改<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span style="color: #007700">-&gt;</span><span style="color: #0000BB">join</span><span style="color: #007700">(</span><span style="color: #0000BB">Profile</span><span style="color: #007700">::</span><span style="color: #0000BB">model</span><span style="color: #007700">()-&gt;</span><span style="color: #0000BB">tableName</span><span style="color: #007700">().</span><span style="color: #DD0000">'&nbsp;p'</span><span style="color: #007700">,</span><span style="color: #DD0000">'p.id&nbsp;=&nbsp;u.id'</span><span style="color: #007700">)<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;-&gt;</span><span style="color: #0000BB">join</span><span style="color: #007700">(</span><span style="color: #0000BB">TeachCategory</span><span style="color: #007700">::</span><span style="color: #0000BB">model</span><span style="color: #007700">()-&gt;</span><span style="color: #0000BB">tableName</span><span style="color: #007700">().</span><span style="color: #DD0000">'&nbsp;tc'</span><span style="color: #007700">,</span><span style="color: #DD0000">'tc.teachId&nbsp;=&nbsp;u.id'</span><span style="color: #007700">);<br />&nbsp;&nbsp;&nbsp;&nbsp;</span><span style="color: #FF8000">//登录用户，直接关联查询，不使用$categoryIds&nbsp;查询<br />&nbsp;&nbsp;&nbsp;&nbsp;</span><span style="color: #007700">if(</span><span style="color: #0000BB">$userId&nbsp;</span><span style="color: #007700">!=&nbsp;</span><span style="color: #0000BB">null</span><span style="color: #007700">){<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span style="color: #0000BB">$command</span><span style="color: #007700">-&gt;</span><span style="color: #0000BB">join</span><span style="color: #007700">(</span><span style="color: #0000BB">UserCategory</span><span style="color: #007700">::</span><span style="color: #0000BB">model</span><span style="color: #007700">()-&gt;</span><span style="color: #0000BB">tableName</span><span style="color: #007700">().</span><span style="color: #DD0000">'&nbsp;uc'</span><span style="color: #007700">,</span><span style="color: #DD0000">'uc.categoryId&nbsp;=&nbsp;tc.categoryId'</span><span style="color: #007700">);<br />&nbsp;&nbsp;&nbsp;&nbsp;}<br />&nbsp;&nbsp;&nbsp;&nbsp;</span><span style="color: #0000BB">$command</span><span style="color: #007700">-&gt;</span><span style="color: #0000BB">where</span><span style="color: #007700">(</span><span style="color: #DD0000">'t.usuallyLocationX&nbsp;&gt;&nbsp;:minLat'</span><span style="color: #007700">,array(</span><span style="color: #DD0000">'minLat'</span><span style="color: #007700">=&gt;</span><span style="color: #0000BB">$around</span><span style="color: #007700">[</span><span style="color: #DD0000">'minLat'</span><span style="color: #007700">]))<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;-&gt;</span><span style="color: #0000BB">andWhere</span><span style="color: #007700">(</span><span style="color: #DD0000">'t.usuallyLocationX&nbsp;&lt;&nbsp;:maxLat'</span><span style="color: #007700">,array(</span><span style="color: #DD0000">'maxLat'</span><span style="color: #007700">=&gt;</span><span style="color: #0000BB">$around</span><span style="color: #007700">[</span><span style="color: #DD0000">'maxLat'</span><span style="color: #007700">]))<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;-&gt;</span><span style="color: #0000BB">andWhere</span><span style="color: #007700">(</span><span style="color: #DD0000">'t.usuallyLocationY&nbsp;&gt;&nbsp;:minLng'</span><span style="color: #007700">,array(</span><span style="color: #DD0000">'minLng'</span><span style="color: #007700">=&gt;</span><span style="color: #0000BB">$around</span><span style="color: #007700">[</span><span style="color: #DD0000">'minLng'</span><span style="color: #007700">]))<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;-&gt;</span><span style="color: #0000BB">andWhere</span><span style="color: #007700">(</span><span style="color: #DD0000">'t.usuallyLocationY&nbsp;&lt;&nbsp;:maxLng'</span><span style="color: #007700">,array(</span><span style="color: #DD0000">'maxLng'</span><span style="color: #007700">=&gt;</span><span style="color: #0000BB">$around</span><span style="color: #007700">[</span><span style="color: #DD0000">'maxLng'</span><span style="color: #007700">]))<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;-&gt;</span><span style="color: #0000BB">andWhere</span><span style="color: #007700">(</span><span style="color: #DD0000">'u.isDelete&nbsp;=&nbsp;:isDelete'</span><span style="color: #007700">,array(</span><span style="color: #DD0000">'isDelete'</span><span style="color: #007700">=&gt;</span><span style="color: #0000BB">Contents</span><span style="color: #007700">::</span><span style="color: #0000BB">F</span><span style="color: #007700">))<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span style="color: #FF8000">//增加机构附近列表可见<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span style="color: #007700">-&gt;</span><span style="color: #0000BB">andWhere</span><span style="color: #007700">(</span><span style="color: #DD0000">'us.map&nbsp;=&nbsp;:map'</span><span style="color: #007700">,array(</span><span style="color: #DD0000">'map'</span><span style="color: #007700">=&gt;</span><span style="color: #0000BB">Contents</span><span style="color: #007700">::</span><span style="color: #0000BB">T</span><span style="color: #007700">));<br />&nbsp;&nbsp;&nbsp;&nbsp;</span><span style="color: #FF8000">//非登录用户，根据传递的$categoryIds&nbsp;查询<br />&nbsp;&nbsp;&nbsp;&nbsp;</span><span style="color: #007700">if(</span><span style="color: #0000BB">$userId&nbsp;</span><span style="color: #007700">==&nbsp;</span><span style="color: #0000BB">null</span><span style="color: #007700">){<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span style="color: #FF8000">//不为空才查询，为空，查询所有。<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span style="color: #007700">if(!empty(</span><span style="color: #0000BB">$categoryIds</span><span style="color: #007700">)){<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span style="color: #0000BB">$command</span><span style="color: #007700">-&gt;</span><span style="color: #0000BB">andWhere</span><span style="color: #007700">(array(</span><span style="color: #DD0000">'in'</span><span style="color: #007700">,&nbsp;</span><span style="color: #DD0000">'tc.categoryId'</span><span style="color: #007700">,&nbsp;</span><span style="color: #0000BB">$categoryIds</span><span style="color: #007700">));<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;}<br />&nbsp;&nbsp;&nbsp;&nbsp;}else{<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span style="color: #FF8000">//登录用户，直接关联查询，不使用$categoryIds&nbsp;查询<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span style="color: #0000BB">$command</span><span style="color: #007700">-&gt;</span><span style="color: #0000BB">andWhere</span><span style="color: #007700">(</span><span style="color: #DD0000">'uc.userId&nbsp;=&nbsp;:userId'</span><span style="color: #007700">,array(</span><span style="color: #DD0000">'userId'</span><span style="color: #007700">=&gt;</span><span style="color: #0000BB">$userId</span><span style="color: #007700">));<br />&nbsp;&nbsp;&nbsp;&nbsp;}<br />&nbsp;&nbsp;&nbsp;&nbsp;if(</span><span style="color: #0000BB">$roleId&nbsp;</span><span style="color: #007700">!=&nbsp;</span><span style="color: #0000BB">null&nbsp;</span><span style="color: #007700">&amp;&amp;&nbsp;</span><span style="color: #0000BB">trim</span><span style="color: #007700">(</span><span style="color: #0000BB">$roleId</span><span style="color: #007700">)&nbsp;!=&nbsp;</span><span style="color: #DD0000">''</span><span style="color: #007700">){<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span style="color: #0000BB">$command</span><span style="color: #007700">-&gt;</span><span style="color: #0000BB">andWhere</span><span style="color: #007700">(</span><span style="color: #DD0000">'u.roleId&nbsp;=&nbsp;:roleId'</span><span style="color: #007700">,array(</span><span style="color: #DD0000">'roleId'</span><span style="color: #007700">=&gt;</span><span style="color: #0000BB">$roleId</span><span style="color: #007700">));<br />&nbsp;&nbsp;&nbsp;&nbsp;}<br />&nbsp;&nbsp;&nbsp;&nbsp;</span><span style="color: #FF8000">//$list&nbsp;=&nbsp;$command-&gt;query();<br />&nbsp;&nbsp;&nbsp;&nbsp;</span><span style="color: #0000BB">$teachList&nbsp;</span><span style="color: #007700">=&nbsp;</span><span style="color: #0000BB">Teach</span><span style="color: #007700">::</span><span style="color: #0000BB">model</span><span style="color: #007700">()-&gt;</span><span style="color: #0000BB">countBySql</span><span style="color: #007700">(</span><span style="color: #0000BB">$command</span><span style="color: #007700">-&gt;</span><span style="color: #0000BB">text</span><span style="color: #007700">,</span><span style="color: #0000BB">$command</span><span style="color: #007700">-&gt;</span><span style="color: #0000BB">params</span><span style="color: #007700">);<br />&nbsp;&nbsp;&nbsp;&nbsp;return&nbsp;</span><span style="color: #0000BB">$teachList</span><span style="color: #007700">;<br />}</span>
</span>
</code></div>
</div>

<p>获得查询附近的老师或机构（getList）所返回的总条数</p>


<div class="detailHeader" id="getOrgList-detail">
getOrgList()
<span class="detailHeaderTag">
method
</span>
</div>

<table class="summaryTable">
<tr><td colspan="3">
<div class="signature2">
public array <b>getOrgList</b>(string $searchKey, int|string $count=20, int|string $page=1)</div>
</td></tr>
<tr>
  <td class="paramNameCol">$searchKey</td>
  <td class="paramTypeCol">string</td>
  <td class="paramDescCol"></td>
</tr>
<tr>
  <td class="paramNameCol">$count</td>
  <td class="paramTypeCol">int|string</td>
  <td class="paramDescCol"></td>
</tr>
<tr>
  <td class="paramNameCol">$page</td>
  <td class="paramTypeCol">int|string</td>
  <td class="paramDescCol"></td>
</tr>
<tr>
  <td class="paramNameCol">{return}</td>
  <td class="paramTypeCol">array</td>
  <td class="paramDescCol">Teach</td>
</tr>
</table>

<div class="sourceCode">
<b>Source Code:</b>  (<b><a href="#" class="show">show</a></b>)
<div class="code"><code><span style="color: #000000">
<span style="color: #0000BB"></span><span style="color: #007700">public&nbsp;function&nbsp;</span><span style="color: #0000BB">getOrgList</span><span style="color: #007700">(</span><span style="color: #0000BB">$searchKey</span><span style="color: #007700">,</span><span style="color: #0000BB">$count</span><span style="color: #007700">=</span><span style="color: #0000BB">Contents</span><span style="color: #007700">::</span><span style="color: #0000BB">COUNT</span><span style="color: #007700">,&nbsp;</span><span style="color: #0000BB">$page</span><span style="color: #007700">=</span><span style="color: #0000BB">Contents</span><span style="color: #007700">::</span><span style="color: #0000BB">PAGE</span><span style="color: #007700">){<br />&nbsp;&nbsp;&nbsp;&nbsp;</span><span style="color: #0000BB">$connection&nbsp;</span><span style="color: #007700">=&nbsp;</span><span style="color: #0000BB">Yii</span><span style="color: #007700">::</span><span style="color: #0000BB">app</span><span style="color: #007700">()-&gt;</span><span style="color: #0000BB">db</span><span style="color: #007700">;<br />&nbsp;&nbsp;&nbsp;&nbsp;</span><span style="color: #0000BB">$command&nbsp;</span><span style="color: #007700">=&nbsp;</span><span style="color: #0000BB">$connection</span><span style="color: #007700">-&gt;</span><span style="color: #0000BB">createCommand</span><span style="color: #007700">();<br />&nbsp;&nbsp;&nbsp;&nbsp;</span><span style="color: #0000BB">$command<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span style="color: #007700">-&gt;</span><span style="color: #0000BB">selectDistinct</span><span style="color: #007700">(</span><span style="color: #DD0000">'t.*,p.name,u.phone,u.order,us.map&nbsp;as&nbsp;isShow'</span><span style="color: #007700">)<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;-&gt;</span><span style="color: #0000BB">from</span><span style="color: #007700">(</span><span style="color: #0000BB">Teach</span><span style="color: #007700">::</span><span style="color: #0000BB">model</span><span style="color: #007700">()-&gt;</span><span style="color: #0000BB">tableName</span><span style="color: #007700">().</span><span style="color: #DD0000">'&nbsp;t'</span><span style="color: #007700">)<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;-&gt;</span><span style="color: #0000BB">join</span><span style="color: #007700">(</span><span style="color: #0000BB">User</span><span style="color: #007700">::</span><span style="color: #0000BB">model</span><span style="color: #007700">()-&gt;</span><span style="color: #0000BB">tableName</span><span style="color: #007700">().</span><span style="color: #DD0000">'&nbsp;u'</span><span style="color: #007700">,</span><span style="color: #DD0000">'t.id&nbsp;=&nbsp;u.id'</span><span style="color: #007700">)<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;-&gt;</span><span style="color: #0000BB">join</span><span style="color: #007700">(</span><span style="color: #0000BB">Profile</span><span style="color: #007700">::</span><span style="color: #0000BB">model</span><span style="color: #007700">()-&gt;</span><span style="color: #0000BB">tableName</span><span style="color: #007700">().</span><span style="color: #DD0000">'&nbsp;p'</span><span style="color: #007700">,</span><span style="color: #DD0000">'p.id&nbsp;=&nbsp;u.id'</span><span style="color: #007700">)<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;-&gt;</span><span style="color: #0000BB">join</span><span style="color: #007700">(</span><span style="color: #0000BB">UserSetting</span><span style="color: #007700">::</span><span style="color: #0000BB">model</span><span style="color: #007700">()-&gt;</span><span style="color: #0000BB">tableName</span><span style="color: #007700">().</span><span style="color: #DD0000">'&nbsp;us'</span><span style="color: #007700">,</span><span style="color: #DD0000">'us.id&nbsp;=&nbsp;u.id'</span><span style="color: #007700">)<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;-&gt;</span><span style="color: #0000BB">where</span><span style="color: #007700">(</span><span style="color: #DD0000">'u.roleId&nbsp;=&nbsp;:roleId'</span><span style="color: #007700">,array(</span><span style="color: #DD0000">'roleId'</span><span style="color: #007700">=&gt;</span><span style="color: #0000BB">Contents</span><span style="color: #007700">::</span><span style="color: #0000BB">ROLE_ORG</span><span style="color: #007700">))<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;-&gt;</span><span style="color: #0000BB">andWhere</span><span style="color: #007700">(</span><span style="color: #DD0000">'u.isDelete&nbsp;=&nbsp;:isDelete'</span><span style="color: #007700">,array(</span><span style="color: #DD0000">'isDelete'</span><span style="color: #007700">=&gt;</span><span style="color: #0000BB">Contents</span><span style="color: #007700">::</span><span style="color: #0000BB">F</span><span style="color: #007700">));<br />&nbsp;&nbsp;&nbsp;&nbsp;if(!</span><span style="color: #0000BB">Tools</span><span style="color: #007700">::</span><span style="color: #0000BB">isEmpty</span><span style="color: #007700">(</span><span style="color: #0000BB">$searchKey</span><span style="color: #007700">)){<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span style="color: #0000BB">$command<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span style="color: #007700">-&gt;</span><span style="color: #0000BB">leftJoin</span><span style="color: #007700">(</span><span style="color: #0000BB">TeachCategory</span><span style="color: #007700">::</span><span style="color: #0000BB">model</span><span style="color: #007700">()-&gt;</span><span style="color: #0000BB">tableName</span><span style="color: #007700">().</span><span style="color: #DD0000">'&nbsp;tc'</span><span style="color: #007700">,</span><span style="color: #DD0000">'tc.teachId&nbsp;=&nbsp;t.id'</span><span style="color: #007700">)<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;-&gt;</span><span style="color: #0000BB">leftJoin</span><span style="color: #007700">(</span><span style="color: #0000BB">Category</span><span style="color: #007700">::</span><span style="color: #0000BB">model</span><span style="color: #007700">()-&gt;</span><span style="color: #0000BB">tableName</span><span style="color: #007700">().</span><span style="color: #DD0000">'&nbsp;c'</span><span style="color: #007700">,</span><span style="color: #DD0000">'c.id&nbsp;=&nbsp;tc.categoryId'</span><span style="color: #007700">);<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span style="color: #0000BB">$searchKey&nbsp;</span><span style="color: #007700">=&nbsp;</span><span style="color: #0000BB">preg_split</span><span style="color: #007700">(</span><span style="color: #DD0000">'/[\s]+/'</span><span style="color: #007700">,</span><span style="color: #0000BB">$searchKey</span><span style="color: #007700">);<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;foreach(</span><span style="color: #0000BB">$searchKey&nbsp;</span><span style="color: #007700">as&nbsp;</span><span style="color: #0000BB">$key</span><span style="color: #007700">=&gt;</span><span style="color: #0000BB">$value</span><span style="color: #007700">){<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span style="color: #0000BB">$command</span><span style="color: #007700">-&gt;</span><span style="color: #0000BB">andWhere</span><span style="color: #007700">(<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;array(</span><span style="color: #DD0000">'OR'</span><span style="color: #007700">,<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;array(</span><span style="color: #DD0000">'like'</span><span style="color: #007700">,&nbsp;</span><span style="color: #DD0000">'c.name'</span><span style="color: #007700">,&nbsp;</span><span style="color: #DD0000">'%'</span><span style="color: #007700">.</span><span style="color: #0000BB">$value</span><span style="color: #007700">.</span><span style="color: #DD0000">'%'</span><span style="color: #007700">),</span><span style="color: #FF8000">//分类名字<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span style="color: #007700">array(</span><span style="color: #DD0000">'like'</span><span style="color: #007700">,&nbsp;</span><span style="color: #DD0000">'p.name'</span><span style="color: #007700">,&nbsp;</span><span style="color: #DD0000">'%'</span><span style="color: #007700">.</span><span style="color: #0000BB">$value</span><span style="color: #007700">.</span><span style="color: #DD0000">'%'</span><span style="color: #007700">),</span><span style="color: #FF8000">//老师名字<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span style="color: #007700">array(</span><span style="color: #DD0000">'like'</span><span style="color: #007700">,&nbsp;</span><span style="color: #DD0000">'t.usuallyLocationInfo'</span><span style="color: #007700">,&nbsp;</span><span style="color: #DD0000">'%'</span><span style="color: #007700">.</span><span style="color: #0000BB">$value</span><span style="color: #007700">.</span><span style="color: #DD0000">'%'</span><span style="color: #007700">),</span><span style="color: #FF8000">//地点名字<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span style="color: #007700">array(</span><span style="color: #DD0000">'like'</span><span style="color: #007700">,&nbsp;</span><span style="color: #DD0000">'u.phone'</span><span style="color: #007700">,&nbsp;</span><span style="color: #DD0000">'%'</span><span style="color: #007700">.</span><span style="color: #0000BB">$value</span><span style="color: #007700">.</span><span style="color: #DD0000">'%'</span><span style="color: #007700">)</span><span style="color: #FF8000">//电话号码<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span style="color: #007700">));<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;}<br />&nbsp;&nbsp;&nbsp;&nbsp;}<br />&nbsp;&nbsp;&nbsp;&nbsp;</span><span style="color: #0000BB">$command<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span style="color: #007700">-&gt;</span><span style="color: #0000BB">order</span><span style="color: #007700">(</span><span style="color: #DD0000">"CAST(IF(TRIM(u.order)=''&nbsp;,9999999999,u.order)&nbsp;AS&nbsp;UNSIGNED)&nbsp;ASC,&nbsp;t.createTime&nbsp;DESC"</span><span style="color: #007700">)<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;-&gt;</span><span style="color: #0000BB">limit</span><span style="color: #007700">(</span><span style="color: #0000BB">$count</span><span style="color: #007700">)<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;-&gt;</span><span style="color: #0000BB">offset</span><span style="color: #007700">((</span><span style="color: #0000BB">$page</span><span style="color: #007700">-</span><span style="color: #0000BB">1</span><span style="color: #007700">)&nbsp;*&nbsp;</span><span style="color: #0000BB">$count</span><span style="color: #007700">);<br />&nbsp;&nbsp;&nbsp;&nbsp;</span><span style="color: #0000BB">$orgList&nbsp;</span><span style="color: #007700">=&nbsp;</span><span style="color: #0000BB">Teach</span><span style="color: #007700">::</span><span style="color: #0000BB">model</span><span style="color: #007700">()-&gt;</span><span style="color: #0000BB">with</span><span style="color: #007700">(array(</span><span style="color: #DD0000">'teachCategories'</span><span style="color: #007700">,</span><span style="color: #DD0000">'teachCategories.category'</span><span style="color: #007700">))-&gt;</span><span style="color: #0000BB">findAllBySql</span><span style="color: #007700">(</span><span style="color: #0000BB">$command</span><span style="color: #007700">-&gt;</span><span style="color: #0000BB">text</span><span style="color: #007700">,</span><span style="color: #0000BB">$command</span><span style="color: #007700">-&gt;</span><span style="color: #0000BB">params</span><span style="color: #007700">);<br />&nbsp;&nbsp;&nbsp;&nbsp;</span><span style="color: #0000BB">$data&nbsp;</span><span style="color: #007700">=&nbsp;array();<br />&nbsp;&nbsp;&nbsp;&nbsp;foreach&nbsp;(</span><span style="color: #0000BB">$orgList&nbsp;</span><span style="color: #007700">as&nbsp;</span><span style="color: #0000BB">$key</span><span style="color: #007700">=&gt;</span><span style="color: #0000BB">$value</span><span style="color: #007700">){<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span style="color: #0000BB">$array&nbsp;</span><span style="color: #007700">=&nbsp;array();<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span style="color: #0000BB">$array</span><span style="color: #007700">[</span><span style="color: #DD0000">'orgId'</span><span style="color: #007700">]&nbsp;=&nbsp;</span><span style="color: #0000BB">$value</span><span style="color: #007700">-&gt;</span><span style="color: #0000BB">id</span><span style="color: #007700">;<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span style="color: #0000BB">$array</span><span style="color: #007700">[</span><span style="color: #DD0000">'name'</span><span style="color: #007700">]&nbsp;=&nbsp;</span><span style="color: #0000BB">$value</span><span style="color: #007700">-&gt;</span><span style="color: #0000BB">name</span><span style="color: #007700">;<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span style="color: #0000BB">$array</span><span style="color: #007700">[</span><span style="color: #DD0000">'phone'</span><span style="color: #007700">]&nbsp;=&nbsp;</span><span style="color: #0000BB">$value</span><span style="color: #007700">-&gt;</span><span style="color: #0000BB">phone</span><span style="color: #007700">;<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span style="color: #0000BB">$array</span><span style="color: #007700">[</span><span style="color: #DD0000">'location'</span><span style="color: #007700">][</span><span style="color: #DD0000">'x'</span><span style="color: #007700">]&nbsp;=&nbsp;</span><span style="color: #0000BB">$value</span><span style="color: #007700">-&gt;</span><span style="color: #0000BB">usuallyLocationX</span><span style="color: #007700">;<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span style="color: #0000BB">$array</span><span style="color: #007700">[</span><span style="color: #DD0000">'location'</span><span style="color: #007700">][</span><span style="color: #DD0000">'y'</span><span style="color: #007700">]&nbsp;=&nbsp;</span><span style="color: #0000BB">$value</span><span style="color: #007700">-&gt;</span><span style="color: #0000BB">usuallyLocationY</span><span style="color: #007700">;<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span style="color: #0000BB">$array</span><span style="color: #007700">[</span><span style="color: #DD0000">'location'</span><span style="color: #007700">][</span><span style="color: #DD0000">'info'</span><span style="color: #007700">]&nbsp;=&nbsp;</span><span style="color: #0000BB">$value</span><span style="color: #007700">-&gt;</span><span style="color: #0000BB">usuallyLocationInfo</span><span style="color: #007700">;<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span style="color: #0000BB">$array</span><span style="color: #007700">[</span><span style="color: #DD0000">'order'</span><span style="color: #007700">]&nbsp;=&nbsp;</span><span style="color: #0000BB">$value</span><span style="color: #007700">-&gt;</span><span style="color: #0000BB">order</span><span style="color: #007700">;<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span style="color: #0000BB">$array</span><span style="color: #007700">[</span><span style="color: #DD0000">'isShow'</span><span style="color: #007700">]&nbsp;=&nbsp;</span><span style="color: #0000BB">$value</span><span style="color: #007700">-&gt;</span><span style="color: #0000BB">isShow</span><span style="color: #007700">;<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span style="color: #0000BB">$teachCategory&nbsp;</span><span style="color: #007700">=&nbsp;</span><span style="color: #0000BB">$value</span><span style="color: #007700">-&gt;</span><span style="color: #0000BB">teachCategories</span><span style="color: #007700">;<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span style="color: #0000BB">$categoryList&nbsp;</span><span style="color: #007700">=&nbsp;array();<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;foreach&nbsp;(</span><span style="color: #0000BB">$teachCategory&nbsp;</span><span style="color: #007700">as&nbsp;</span><span style="color: #0000BB">$k</span><span style="color: #007700">=&gt;</span><span style="color: #0000BB">$v</span><span style="color: #007700">){<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span style="color: #0000BB">$categoryList</span><span style="color: #007700">[</span><span style="color: #0000BB">$k</span><span style="color: #007700">][</span><span style="color: #DD0000">'id'</span><span style="color: #007700">]&nbsp;=&nbsp;</span><span style="color: #0000BB">$v</span><span style="color: #007700">-&gt;</span><span style="color: #0000BB">category</span><span style="color: #007700">-&gt;</span><span style="color: #0000BB">id</span><span style="color: #007700">;<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span style="color: #0000BB">$categoryList</span><span style="color: #007700">[</span><span style="color: #0000BB">$k</span><span style="color: #007700">][</span><span style="color: #DD0000">'name'</span><span style="color: #007700">]&nbsp;=&nbsp;</span><span style="color: #0000BB">$v</span><span style="color: #007700">-&gt;</span><span style="color: #0000BB">category</span><span style="color: #007700">-&gt;</span><span style="color: #0000BB">name</span><span style="color: #007700">;<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;}<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span style="color: #0000BB">$array</span><span style="color: #007700">[</span><span style="color: #DD0000">'categoryList'</span><span style="color: #007700">]&nbsp;=&nbsp;</span><span style="color: #0000BB">$categoryList</span><span style="color: #007700">;<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span style="color: #0000BB">$data</span><span style="color: #007700">[</span><span style="color: #0000BB">$key</span><span style="color: #007700">]&nbsp;=&nbsp;</span><span style="color: #0000BB">$array</span><span style="color: #007700">;<br />&nbsp;&nbsp;&nbsp;&nbsp;}<br />&nbsp;&nbsp;&nbsp;&nbsp;return&nbsp;</span><span style="color: #0000BB">$data</span><span style="color: #007700">;<br />}</span>
</span>
</code></div>
</div>

<p>根据查询条件获得机构列表</p>


<div class="detailHeader" id="getOrgListCount-detail">
getOrgListCount()
<span class="detailHeaderTag">
method
</span>
</div>

<table class="summaryTable">
<tr><td colspan="3">
<div class="signature2">
public integer <b>getOrgListCount</b>(string $searchKey)</div>
</td></tr>
<tr>
  <td class="paramNameCol">$searchKey</td>
  <td class="paramTypeCol">string</td>
  <td class="paramDescCol"></td>
</tr>
<tr>
  <td class="paramNameCol">{return}</td>
  <td class="paramTypeCol">integer</td>
  <td class="paramDescCol"></td>
</tr>
</table>

<div class="sourceCode">
<b>Source Code:</b>  (<b><a href="#" class="show">show</a></b>)
<div class="code"><code><span style="color: #000000">
<span style="color: #0000BB"></span><span style="color: #007700">public&nbsp;function&nbsp;</span><span style="color: #0000BB">getOrgListCount</span><span style="color: #007700">(</span><span style="color: #0000BB">$searchKey</span><span style="color: #007700">){<br />&nbsp;&nbsp;&nbsp;&nbsp;</span><span style="color: #0000BB">$connection&nbsp;</span><span style="color: #007700">=&nbsp;</span><span style="color: #0000BB">Yii</span><span style="color: #007700">::</span><span style="color: #0000BB">app</span><span style="color: #007700">()-&gt;</span><span style="color: #0000BB">db</span><span style="color: #007700">;<br />&nbsp;&nbsp;&nbsp;&nbsp;</span><span style="color: #0000BB">$command&nbsp;</span><span style="color: #007700">=&nbsp;</span><span style="color: #0000BB">$connection</span><span style="color: #007700">-&gt;</span><span style="color: #0000BB">createCommand</span><span style="color: #007700">();<br />&nbsp;&nbsp;&nbsp;&nbsp;</span><span style="color: #0000BB">$command<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span style="color: #007700">-&gt;</span><span style="color: #0000BB">select</span><span style="color: #007700">(</span><span style="color: #DD0000">'count(distinct&nbsp;t.id)'</span><span style="color: #007700">)<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;-&gt;</span><span style="color: #0000BB">from</span><span style="color: #007700">(</span><span style="color: #0000BB">Teach</span><span style="color: #007700">::</span><span style="color: #0000BB">model</span><span style="color: #007700">()-&gt;</span><span style="color: #0000BB">tableName</span><span style="color: #007700">().</span><span style="color: #DD0000">'&nbsp;t'</span><span style="color: #007700">)<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;-&gt;</span><span style="color: #0000BB">join</span><span style="color: #007700">(</span><span style="color: #0000BB">User</span><span style="color: #007700">::</span><span style="color: #0000BB">model</span><span style="color: #007700">()-&gt;</span><span style="color: #0000BB">tableName</span><span style="color: #007700">().</span><span style="color: #DD0000">'&nbsp;u'</span><span style="color: #007700">,</span><span style="color: #DD0000">'t.id&nbsp;=&nbsp;u.id'</span><span style="color: #007700">)<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;-&gt;</span><span style="color: #0000BB">join</span><span style="color: #007700">(</span><span style="color: #0000BB">Profile</span><span style="color: #007700">::</span><span style="color: #0000BB">model</span><span style="color: #007700">()-&gt;</span><span style="color: #0000BB">tableName</span><span style="color: #007700">().</span><span style="color: #DD0000">'&nbsp;p'</span><span style="color: #007700">,</span><span style="color: #DD0000">'p.id&nbsp;=&nbsp;u.id'</span><span style="color: #007700">)<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;-&gt;</span><span style="color: #0000BB">join</span><span style="color: #007700">(</span><span style="color: #0000BB">UserSetting</span><span style="color: #007700">::</span><span style="color: #0000BB">model</span><span style="color: #007700">()-&gt;</span><span style="color: #0000BB">tableName</span><span style="color: #007700">().</span><span style="color: #DD0000">'&nbsp;us'</span><span style="color: #007700">,</span><span style="color: #DD0000">'us.id&nbsp;=&nbsp;u.id'</span><span style="color: #007700">)<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;-&gt;</span><span style="color: #0000BB">where</span><span style="color: #007700">(</span><span style="color: #DD0000">'u.roleId&nbsp;=&nbsp;:roleId'</span><span style="color: #007700">,array(</span><span style="color: #DD0000">'roleId'</span><span style="color: #007700">=&gt;</span><span style="color: #0000BB">Contents</span><span style="color: #007700">::</span><span style="color: #0000BB">ROLE_ORG</span><span style="color: #007700">))<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;-&gt;</span><span style="color: #0000BB">andWhere</span><span style="color: #007700">(</span><span style="color: #DD0000">'u.isDelete&nbsp;=&nbsp;:isDelete'</span><span style="color: #007700">,array(</span><span style="color: #DD0000">'isDelete'</span><span style="color: #007700">=&gt;</span><span style="color: #0000BB">Contents</span><span style="color: #007700">::</span><span style="color: #0000BB">F</span><span style="color: #007700">));<br />&nbsp;&nbsp;&nbsp;&nbsp;if(!</span><span style="color: #0000BB">Tools</span><span style="color: #007700">::</span><span style="color: #0000BB">isEmpty</span><span style="color: #007700">(</span><span style="color: #0000BB">$searchKey</span><span style="color: #007700">)){<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span style="color: #0000BB">$command<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span style="color: #007700">-&gt;</span><span style="color: #0000BB">leftJoin</span><span style="color: #007700">(</span><span style="color: #0000BB">TeachCategory</span><span style="color: #007700">::</span><span style="color: #0000BB">model</span><span style="color: #007700">()-&gt;</span><span style="color: #0000BB">tableName</span><span style="color: #007700">().</span><span style="color: #DD0000">'&nbsp;tc'</span><span style="color: #007700">,</span><span style="color: #DD0000">'tc.teachId&nbsp;=&nbsp;t.id'</span><span style="color: #007700">)<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;-&gt;</span><span style="color: #0000BB">leftJoin</span><span style="color: #007700">(</span><span style="color: #0000BB">Category</span><span style="color: #007700">::</span><span style="color: #0000BB">model</span><span style="color: #007700">()-&gt;</span><span style="color: #0000BB">tableName</span><span style="color: #007700">().</span><span style="color: #DD0000">'&nbsp;c'</span><span style="color: #007700">,</span><span style="color: #DD0000">'c.id&nbsp;=&nbsp;tc.categoryId'</span><span style="color: #007700">);<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span style="color: #0000BB">$searchKey&nbsp;</span><span style="color: #007700">=&nbsp;</span><span style="color: #0000BB">preg_split</span><span style="color: #007700">(</span><span style="color: #DD0000">'/[\s]+/'</span><span style="color: #007700">,</span><span style="color: #0000BB">$searchKey</span><span style="color: #007700">);<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;foreach(</span><span style="color: #0000BB">$searchKey&nbsp;</span><span style="color: #007700">as&nbsp;</span><span style="color: #0000BB">$key</span><span style="color: #007700">=&gt;</span><span style="color: #0000BB">$value</span><span style="color: #007700">){<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span style="color: #0000BB">$command</span><span style="color: #007700">-&gt;</span><span style="color: #0000BB">andWhere</span><span style="color: #007700">(<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;array(</span><span style="color: #DD0000">'OR'</span><span style="color: #007700">,<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;array(</span><span style="color: #DD0000">'like'</span><span style="color: #007700">,&nbsp;</span><span style="color: #DD0000">'c.name'</span><span style="color: #007700">,&nbsp;</span><span style="color: #DD0000">'%'</span><span style="color: #007700">.</span><span style="color: #0000BB">$value</span><span style="color: #007700">.</span><span style="color: #DD0000">'%'</span><span style="color: #007700">),</span><span style="color: #FF8000">//分类名字<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span style="color: #007700">array(</span><span style="color: #DD0000">'like'</span><span style="color: #007700">,&nbsp;</span><span style="color: #DD0000">'p.name'</span><span style="color: #007700">,&nbsp;</span><span style="color: #DD0000">'%'</span><span style="color: #007700">.</span><span style="color: #0000BB">$value</span><span style="color: #007700">.</span><span style="color: #DD0000">'%'</span><span style="color: #007700">),</span><span style="color: #FF8000">//老师名字<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span style="color: #007700">array(</span><span style="color: #DD0000">'like'</span><span style="color: #007700">,&nbsp;</span><span style="color: #DD0000">'t.usuallyLocationInfo'</span><span style="color: #007700">,&nbsp;</span><span style="color: #DD0000">'%'</span><span style="color: #007700">.</span><span style="color: #0000BB">$value</span><span style="color: #007700">.</span><span style="color: #DD0000">'%'</span><span style="color: #007700">),</span><span style="color: #FF8000">//地点名字<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span style="color: #007700">array(</span><span style="color: #DD0000">'like'</span><span style="color: #007700">,&nbsp;</span><span style="color: #DD0000">'u.phone'</span><span style="color: #007700">,&nbsp;</span><span style="color: #DD0000">'%'</span><span style="color: #007700">.</span><span style="color: #0000BB">$value</span><span style="color: #007700">.</span><span style="color: #DD0000">'%'</span><span style="color: #007700">)</span><span style="color: #FF8000">//电话号码<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span style="color: #007700">));<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;}<br />&nbsp;&nbsp;&nbsp;&nbsp;}<br />&nbsp;&nbsp;&nbsp;&nbsp;</span><span style="color: #0000BB">$userList&nbsp;</span><span style="color: #007700">=&nbsp;</span><span style="color: #0000BB">Teach</span><span style="color: #007700">::</span><span style="color: #0000BB">model</span><span style="color: #007700">()-&gt;</span><span style="color: #0000BB">countBySql</span><span style="color: #007700">(</span><span style="color: #0000BB">$command</span><span style="color: #007700">-&gt;</span><span style="color: #0000BB">text</span><span style="color: #007700">,</span><span style="color: #0000BB">$command</span><span style="color: #007700">-&gt;</span><span style="color: #0000BB">params</span><span style="color: #007700">);<br />&nbsp;&nbsp;&nbsp;&nbsp;return&nbsp;</span><span style="color: #0000BB">$userList</span><span style="color: #007700">;<br />}</span>
</span>
</code></div>
</div>

<p>获得查询机构的总条数</p>


<div class="detailHeader" id="getStuList-detail">
getStuList()
<span class="detailHeaderTag">
method
</span>
</div>

<table class="summaryTable">
<tr><td colspan="3">
<div class="signature2">
public array <b>getStuList</b>($searchKey $searchKey, string $count=20, string $page=1)</div>
</td></tr>
<tr>
  <td class="paramNameCol">$searchKey</td>
  <td class="paramTypeCol">$searchKey</td>
  <td class="paramDescCol"></td>
</tr>
<tr>
  <td class="paramNameCol">$count</td>
  <td class="paramTypeCol">string</td>
  <td class="paramDescCol"></td>
</tr>
<tr>
  <td class="paramNameCol">$page</td>
  <td class="paramTypeCol">string</td>
  <td class="paramDescCol"></td>
</tr>
<tr>
  <td class="paramNameCol">{return}</td>
  <td class="paramTypeCol">array</td>
  <td class="paramDescCol">Profile</td>
</tr>
</table>

<div class="sourceCode">
<b>Source Code:</b>  (<b><a href="#" class="show">show</a></b>)
<div class="code"><code><span style="color: #000000">
<span style="color: #0000BB"></span><span style="color: #007700">public&nbsp;function&nbsp;</span><span style="color: #0000BB">getStuList</span><span style="color: #007700">(</span><span style="color: #0000BB">$searchKey</span><span style="color: #007700">,</span><span style="color: #0000BB">$count</span><span style="color: #007700">=</span><span style="color: #0000BB">Contents</span><span style="color: #007700">::</span><span style="color: #0000BB">COUNT</span><span style="color: #007700">,&nbsp;</span><span style="color: #0000BB">$page</span><span style="color: #007700">=</span><span style="color: #0000BB">Contents</span><span style="color: #007700">::</span><span style="color: #0000BB">PAGE</span><span style="color: #007700">){<br />&nbsp;&nbsp;&nbsp;&nbsp;</span><span style="color: #0000BB">$connection&nbsp;</span><span style="color: #007700">=&nbsp;</span><span style="color: #0000BB">Yii</span><span style="color: #007700">::</span><span style="color: #0000BB">app</span><span style="color: #007700">()-&gt;</span><span style="color: #0000BB">db</span><span style="color: #007700">;<br />&nbsp;&nbsp;&nbsp;&nbsp;</span><span style="color: #0000BB">$command&nbsp;</span><span style="color: #007700">=&nbsp;</span><span style="color: #0000BB">$connection</span><span style="color: #007700">-&gt;</span><span style="color: #0000BB">createCommand</span><span style="color: #007700">();<br />&nbsp;&nbsp;&nbsp;&nbsp;</span><span style="color: #0000BB">$command<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span style="color: #007700">-&gt;</span><span style="color: #0000BB">selectDistinct</span><span style="color: #007700">(</span><span style="color: #DD0000">'p.*,u.phone,u.roleId,u.order'</span><span style="color: #007700">)<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;-&gt;</span><span style="color: #0000BB">from</span><span style="color: #007700">(</span><span style="color: #0000BB">Profile</span><span style="color: #007700">::</span><span style="color: #0000BB">model</span><span style="color: #007700">()-&gt;</span><span style="color: #0000BB">tableName</span><span style="color: #007700">().</span><span style="color: #DD0000">'&nbsp;p'</span><span style="color: #007700">)<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;-&gt;</span><span style="color: #0000BB">join</span><span style="color: #007700">(</span><span style="color: #0000BB">User</span><span style="color: #007700">::</span><span style="color: #0000BB">model</span><span style="color: #007700">()-&gt;</span><span style="color: #0000BB">tableName</span><span style="color: #007700">().</span><span style="color: #DD0000">'&nbsp;u'</span><span style="color: #007700">,</span><span style="color: #DD0000">'p.id&nbsp;=&nbsp;u.id'</span><span style="color: #007700">)<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;-&gt;</span><span style="color: #0000BB">where</span><span style="color: #007700">(</span><span style="color: #DD0000">'u.roleId&nbsp;=&nbsp;:roleId'</span><span style="color: #007700">,array(</span><span style="color: #DD0000">'roleId'</span><span style="color: #007700">=&gt;</span><span style="color: #0000BB">Contents</span><span style="color: #007700">::</span><span style="color: #0000BB">ROLE_STU</span><span style="color: #007700">))<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;-&gt;</span><span style="color: #0000BB">andWhere</span><span style="color: #007700">(</span><span style="color: #DD0000">'u.isDelete&nbsp;=&nbsp;:isDelete'</span><span style="color: #007700">,array(</span><span style="color: #DD0000">'isDelete'</span><span style="color: #007700">=&gt;</span><span style="color: #0000BB">Contents</span><span style="color: #007700">::</span><span style="color: #0000BB">F</span><span style="color: #007700">));<br />&nbsp;&nbsp;&nbsp;&nbsp;if(!</span><span style="color: #0000BB">Tools</span><span style="color: #007700">::</span><span style="color: #0000BB">isEmpty</span><span style="color: #007700">(</span><span style="color: #0000BB">$searchKey</span><span style="color: #007700">)){<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span style="color: #0000BB">$searchKey&nbsp;</span><span style="color: #007700">=&nbsp;</span><span style="color: #0000BB">preg_split</span><span style="color: #007700">(</span><span style="color: #DD0000">'/[\s]+/'</span><span style="color: #007700">,</span><span style="color: #0000BB">$searchKey</span><span style="color: #007700">);<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;foreach(</span><span style="color: #0000BB">$searchKey&nbsp;</span><span style="color: #007700">as&nbsp;</span><span style="color: #0000BB">$key</span><span style="color: #007700">=&gt;</span><span style="color: #0000BB">$value</span><span style="color: #007700">){<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span style="color: #0000BB">$command</span><span style="color: #007700">-&gt;</span><span style="color: #0000BB">andWhere</span><span style="color: #007700">(<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;array(</span><span style="color: #DD0000">'OR'</span><span style="color: #007700">,<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;array(</span><span style="color: #DD0000">'like'</span><span style="color: #007700">,&nbsp;</span><span style="color: #DD0000">'p.name'</span><span style="color: #007700">,&nbsp;</span><span style="color: #DD0000">'%'</span><span style="color: #007700">.</span><span style="color: #0000BB">$value</span><span style="color: #007700">.</span><span style="color: #DD0000">'%'</span><span style="color: #007700">),</span><span style="color: #FF8000">//名字<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span style="color: #007700">array(</span><span style="color: #DD0000">'like'</span><span style="color: #007700">,&nbsp;</span><span style="color: #DD0000">'p.college'</span><span style="color: #007700">,&nbsp;</span><span style="color: #DD0000">'%'</span><span style="color: #007700">.</span><span style="color: #0000BB">$value</span><span style="color: #007700">.</span><span style="color: #DD0000">'%'</span><span style="color: #007700">),</span><span style="color: #FF8000">//学校<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span style="color: #007700">array(</span><span style="color: #DD0000">'like'</span><span style="color: #007700">,&nbsp;</span><span style="color: #DD0000">'u.phone'</span><span style="color: #007700">,&nbsp;</span><span style="color: #DD0000">'%'</span><span style="color: #007700">.</span><span style="color: #0000BB">$value</span><span style="color: #007700">.</span><span style="color: #DD0000">'%'</span><span style="color: #007700">)</span><span style="color: #FF8000">//电话号码<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span style="color: #007700">));<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;}<br />&nbsp;&nbsp;&nbsp;&nbsp;}<br />&nbsp;&nbsp;&nbsp;&nbsp;</span><span style="color: #0000BB">$command<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span style="color: #007700">-&gt;</span><span style="color: #0000BB">order</span><span style="color: #007700">(</span><span style="color: #DD0000">"CAST(IF(TRIM(u.order)=''&nbsp;,9999999999,u.order)&nbsp;AS&nbsp;UNSIGNED),&nbsp;p.createTime&nbsp;DESC"</span><span style="color: #007700">)<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;-&gt;</span><span style="color: #0000BB">limit</span><span style="color: #007700">(</span><span style="color: #0000BB">$count</span><span style="color: #007700">)<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;-&gt;</span><span style="color: #0000BB">offset</span><span style="color: #007700">((</span><span style="color: #0000BB">$page</span><span style="color: #007700">-</span><span style="color: #0000BB">1</span><span style="color: #007700">)&nbsp;*&nbsp;</span><span style="color: #0000BB">$count</span><span style="color: #007700">);<br />&nbsp;&nbsp;&nbsp;&nbsp;</span><span style="color: #0000BB">$userList&nbsp;</span><span style="color: #007700">=&nbsp;</span><span style="color: #0000BB">Profile</span><span style="color: #007700">::</span><span style="color: #0000BB">model</span><span style="color: #007700">()-&gt;</span><span style="color: #0000BB">findAllBySql</span><span style="color: #007700">(</span><span style="color: #0000BB">$command</span><span style="color: #007700">-&gt;</span><span style="color: #0000BB">text</span><span style="color: #007700">,</span><span style="color: #0000BB">$command</span><span style="color: #007700">-&gt;</span><span style="color: #0000BB">params</span><span style="color: #007700">);<br />&nbsp;&nbsp;&nbsp;&nbsp;</span><span style="color: #0000BB">$data&nbsp;</span><span style="color: #007700">=&nbsp;array();<br />&nbsp;&nbsp;&nbsp;&nbsp;foreach&nbsp;(</span><span style="color: #0000BB">$userList&nbsp;</span><span style="color: #007700">as&nbsp;</span><span style="color: #0000BB">$key</span><span style="color: #007700">=&gt;</span><span style="color: #0000BB">$value</span><span style="color: #007700">){<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span style="color: #0000BB">$array&nbsp;</span><span style="color: #007700">=&nbsp;array();<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span style="color: #0000BB">$array</span><span style="color: #007700">[</span><span style="color: #DD0000">'userId'</span><span style="color: #007700">]&nbsp;=&nbsp;</span><span style="color: #0000BB">$value</span><span style="color: #007700">-&gt;</span><span style="color: #0000BB">id</span><span style="color: #007700">;<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span style="color: #0000BB">$array</span><span style="color: #007700">[</span><span style="color: #DD0000">'name'</span><span style="color: #007700">]&nbsp;=&nbsp;</span><span style="color: #0000BB">$value</span><span style="color: #007700">-&gt;</span><span style="color: #0000BB">name</span><span style="color: #007700">;<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span style="color: #0000BB">$array</span><span style="color: #007700">[</span><span style="color: #DD0000">'phone'</span><span style="color: #007700">]&nbsp;=&nbsp;</span><span style="color: #0000BB">$value</span><span style="color: #007700">-&gt;</span><span style="color: #0000BB">phone</span><span style="color: #007700">;<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span style="color: #0000BB">$array</span><span style="color: #007700">[</span><span style="color: #DD0000">'sex'</span><span style="color: #007700">]&nbsp;=&nbsp;</span><span style="color: #0000BB">$value</span><span style="color: #007700">-&gt;</span><span style="color: #0000BB">sex</span><span style="color: #007700">;<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span style="color: #0000BB">$array</span><span style="color: #007700">[</span><span style="color: #DD0000">'college'</span><span style="color: #007700">]&nbsp;=&nbsp;</span><span style="color: #0000BB">$value</span><span style="color: #007700">-&gt;</span><span style="color: #0000BB">college</span><span style="color: #007700">;<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span style="color: #0000BB">$array</span><span style="color: #007700">[</span><span style="color: #DD0000">'roleId'</span><span style="color: #007700">]&nbsp;=&nbsp;</span><span style="color: #0000BB">$value</span><span style="color: #007700">-&gt;</span><span style="color: #0000BB">roleId</span><span style="color: #007700">;<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span style="color: #0000BB">$array</span><span style="color: #007700">[</span><span style="color: #DD0000">'order'</span><span style="color: #007700">]&nbsp;=&nbsp;</span><span style="color: #0000BB">$value</span><span style="color: #007700">-&gt;</span><span style="color: #0000BB">order</span><span style="color: #007700">;<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span style="color: #0000BB">$array</span><span style="color: #007700">[</span><span style="color: #DD0000">'birthday'</span><span style="color: #007700">]&nbsp;=&nbsp;</span><span style="color: #0000BB">$value</span><span style="color: #007700">-&gt;</span><span style="color: #0000BB">birthday</span><span style="color: #007700">;<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span style="color: #0000BB">$array</span><span style="color: #007700">[</span><span style="color: #DD0000">'age'</span><span style="color: #007700">]&nbsp;=&nbsp;</span><span style="color: #0000BB">Tools</span><span style="color: #007700">::</span><span style="color: #0000BB">age</span><span style="color: #007700">(</span><span style="color: #0000BB">$value</span><span style="color: #007700">-&gt;</span><span style="color: #0000BB">birthday</span><span style="color: #007700">);<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span style="color: #0000BB">$data</span><span style="color: #007700">[</span><span style="color: #0000BB">$key</span><span style="color: #007700">]&nbsp;=&nbsp;</span><span style="color: #0000BB">$array</span><span style="color: #007700">;<br />&nbsp;&nbsp;&nbsp;&nbsp;}<br />&nbsp;&nbsp;&nbsp;&nbsp;return&nbsp;</span><span style="color: #0000BB">$data</span><span style="color: #007700">;<br />}</span>
</span>
</code></div>
</div>

<p>根据查询条件获得学生列表</p>


<div class="detailHeader" id="getStuListCount-detail">
getStuListCount()
<span class="detailHeaderTag">
method
</span>
</div>

<table class="summaryTable">
<tr><td colspan="3">
<div class="signature2">
public integer <b>getStuListCount</b>($searchKey $searchKey)</div>
</td></tr>
<tr>
  <td class="paramNameCol">$searchKey</td>
  <td class="paramTypeCol">$searchKey</td>
  <td class="paramDescCol"></td>
</tr>
<tr>
  <td class="paramNameCol">{return}</td>
  <td class="paramTypeCol">integer</td>
  <td class="paramDescCol"></td>
</tr>
</table>

<div class="sourceCode">
<b>Source Code:</b>  (<b><a href="#" class="show">show</a></b>)
<div class="code"><code><span style="color: #000000">
<span style="color: #0000BB"></span><span style="color: #007700">public&nbsp;function&nbsp;</span><span style="color: #0000BB">getStuListCount</span><span style="color: #007700">(</span><span style="color: #0000BB">$searchKey</span><span style="color: #007700">){<br />&nbsp;&nbsp;&nbsp;&nbsp;</span><span style="color: #0000BB">$connection&nbsp;</span><span style="color: #007700">=&nbsp;</span><span style="color: #0000BB">Yii</span><span style="color: #007700">::</span><span style="color: #0000BB">app</span><span style="color: #007700">()-&gt;</span><span style="color: #0000BB">db</span><span style="color: #007700">;<br />&nbsp;&nbsp;&nbsp;&nbsp;</span><span style="color: #0000BB">$command&nbsp;</span><span style="color: #007700">=&nbsp;</span><span style="color: #0000BB">$connection</span><span style="color: #007700">-&gt;</span><span style="color: #0000BB">createCommand</span><span style="color: #007700">();<br />&nbsp;&nbsp;&nbsp;&nbsp;</span><span style="color: #0000BB">$command<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span style="color: #007700">-&gt;</span><span style="color: #0000BB">select</span><span style="color: #007700">(</span><span style="color: #DD0000">'count(distinct&nbsp;p.id)'</span><span style="color: #007700">)<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;-&gt;</span><span style="color: #0000BB">from</span><span style="color: #007700">(</span><span style="color: #0000BB">Profile</span><span style="color: #007700">::</span><span style="color: #0000BB">model</span><span style="color: #007700">()-&gt;</span><span style="color: #0000BB">tableName</span><span style="color: #007700">().</span><span style="color: #DD0000">'&nbsp;p'</span><span style="color: #007700">)<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;-&gt;</span><span style="color: #0000BB">join</span><span style="color: #007700">(</span><span style="color: #0000BB">User</span><span style="color: #007700">::</span><span style="color: #0000BB">model</span><span style="color: #007700">()-&gt;</span><span style="color: #0000BB">tableName</span><span style="color: #007700">().</span><span style="color: #DD0000">'&nbsp;u'</span><span style="color: #007700">,</span><span style="color: #DD0000">'p.id&nbsp;=&nbsp;u.id'</span><span style="color: #007700">)<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;-&gt;</span><span style="color: #0000BB">where</span><span style="color: #007700">(</span><span style="color: #DD0000">'u.roleId&nbsp;=&nbsp;:roleId'</span><span style="color: #007700">,array(</span><span style="color: #DD0000">'roleId'</span><span style="color: #007700">=&gt;</span><span style="color: #0000BB">Contents</span><span style="color: #007700">::</span><span style="color: #0000BB">ROLE_STU</span><span style="color: #007700">))<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;-&gt;</span><span style="color: #0000BB">andWhere</span><span style="color: #007700">(</span><span style="color: #DD0000">'u.isDelete&nbsp;=&nbsp;:isDelete'</span><span style="color: #007700">,array(</span><span style="color: #DD0000">'isDelete'</span><span style="color: #007700">=&gt;</span><span style="color: #0000BB">Contents</span><span style="color: #007700">::</span><span style="color: #0000BB">F</span><span style="color: #007700">));<br />&nbsp;&nbsp;&nbsp;&nbsp;if(!</span><span style="color: #0000BB">Tools</span><span style="color: #007700">::</span><span style="color: #0000BB">isEmpty</span><span style="color: #007700">(</span><span style="color: #0000BB">$searchKey</span><span style="color: #007700">)){<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span style="color: #0000BB">$searchKey&nbsp;</span><span style="color: #007700">=&nbsp;</span><span style="color: #0000BB">preg_split</span><span style="color: #007700">(</span><span style="color: #DD0000">'/[\s]+/'</span><span style="color: #007700">,</span><span style="color: #0000BB">$searchKey</span><span style="color: #007700">);<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;foreach(</span><span style="color: #0000BB">$searchKey&nbsp;</span><span style="color: #007700">as&nbsp;</span><span style="color: #0000BB">$key</span><span style="color: #007700">=&gt;</span><span style="color: #0000BB">$value</span><span style="color: #007700">){<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span style="color: #0000BB">$command</span><span style="color: #007700">-&gt;</span><span style="color: #0000BB">andWhere</span><span style="color: #007700">(<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;array(</span><span style="color: #DD0000">'OR'</span><span style="color: #007700">,<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;array(</span><span style="color: #DD0000">'like'</span><span style="color: #007700">,&nbsp;</span><span style="color: #DD0000">'p.name'</span><span style="color: #007700">,&nbsp;</span><span style="color: #DD0000">'%'</span><span style="color: #007700">.</span><span style="color: #0000BB">$value</span><span style="color: #007700">.</span><span style="color: #DD0000">'%'</span><span style="color: #007700">),</span><span style="color: #FF8000">//名字<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span style="color: #007700">array(</span><span style="color: #DD0000">'like'</span><span style="color: #007700">,&nbsp;</span><span style="color: #DD0000">'p.college'</span><span style="color: #007700">,&nbsp;</span><span style="color: #DD0000">'%'</span><span style="color: #007700">.</span><span style="color: #0000BB">$value</span><span style="color: #007700">.</span><span style="color: #DD0000">'%'</span><span style="color: #007700">),</span><span style="color: #FF8000">//学校<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span style="color: #007700">array(</span><span style="color: #DD0000">'like'</span><span style="color: #007700">,&nbsp;</span><span style="color: #DD0000">'u.phone'</span><span style="color: #007700">,&nbsp;</span><span style="color: #DD0000">'%'</span><span style="color: #007700">.</span><span style="color: #0000BB">$value</span><span style="color: #007700">.</span><span style="color: #DD0000">'%'</span><span style="color: #007700">)</span><span style="color: #FF8000">//电话号码<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span style="color: #007700">));<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;}<br />&nbsp;&nbsp;&nbsp;&nbsp;}<br />&nbsp;&nbsp;&nbsp;&nbsp;</span><span style="color: #0000BB">$userList&nbsp;</span><span style="color: #007700">=&nbsp;</span><span style="color: #0000BB">Profile</span><span style="color: #007700">::</span><span style="color: #0000BB">model</span><span style="color: #007700">()-&gt;</span><span style="color: #0000BB">countBySql</span><span style="color: #007700">(</span><span style="color: #0000BB">$command</span><span style="color: #007700">-&gt;</span><span style="color: #0000BB">text</span><span style="color: #007700">,</span><span style="color: #0000BB">$command</span><span style="color: #007700">-&gt;</span><span style="color: #0000BB">params</span><span style="color: #007700">);<br />&nbsp;&nbsp;&nbsp;&nbsp;return&nbsp;</span><span style="color: #0000BB">$userList</span><span style="color: #007700">;<br />}</span>
</span>
</code></div>
</div>

<p>获得查询学生的总条数</p>


<div class="detailHeader" id="getTeacherList-detail">
getTeacherList()
<span class="detailHeaderTag">
method
</span>
</div>

<table class="summaryTable">
<tr><td colspan="3">
<div class="signature2">
public array <b>getTeacherList</b>($searchKey $searchKey, string $count=20, string $page=1)</div>
</td></tr>
<tr>
  <td class="paramNameCol">$searchKey</td>
  <td class="paramTypeCol">$searchKey</td>
  <td class="paramDescCol"></td>
</tr>
<tr>
  <td class="paramNameCol">$count</td>
  <td class="paramTypeCol">string</td>
  <td class="paramDescCol"></td>
</tr>
<tr>
  <td class="paramNameCol">$page</td>
  <td class="paramTypeCol">string</td>
  <td class="paramDescCol"></td>
</tr>
<tr>
  <td class="paramNameCol">{return}</td>
  <td class="paramTypeCol">array</td>
  <td class="paramDescCol">Profile</td>
</tr>
</table>

<div class="sourceCode">
<b>Source Code:</b>  (<b><a href="#" class="show">show</a></b>)
<div class="code"><code><span style="color: #000000">
<span style="color: #0000BB"></span><span style="color: #007700">public&nbsp;function&nbsp;</span><span style="color: #0000BB">getTeacherList</span><span style="color: #007700">(</span><span style="color: #0000BB">$searchKey</span><span style="color: #007700">,</span><span style="color: #0000BB">$count</span><span style="color: #007700">=</span><span style="color: #0000BB">Contents</span><span style="color: #007700">::</span><span style="color: #0000BB">COUNT</span><span style="color: #007700">,&nbsp;</span><span style="color: #0000BB">$page</span><span style="color: #007700">=</span><span style="color: #0000BB">Contents</span><span style="color: #007700">::</span><span style="color: #0000BB">PAGE</span><span style="color: #007700">){<br />&nbsp;&nbsp;&nbsp;&nbsp;</span><span style="color: #0000BB">$connection&nbsp;</span><span style="color: #007700">=&nbsp;</span><span style="color: #0000BB">Yii</span><span style="color: #007700">::</span><span style="color: #0000BB">app</span><span style="color: #007700">()-&gt;</span><span style="color: #0000BB">db</span><span style="color: #007700">;<br />&nbsp;&nbsp;&nbsp;&nbsp;</span><span style="color: #0000BB">$command&nbsp;</span><span style="color: #007700">=&nbsp;</span><span style="color: #0000BB">$connection</span><span style="color: #007700">-&gt;</span><span style="color: #0000BB">createCommand</span><span style="color: #007700">();<br />&nbsp;&nbsp;&nbsp;&nbsp;</span><span style="color: #0000BB">$command<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span style="color: #007700">-&gt;</span><span style="color: #0000BB">selectDistinct</span><span style="color: #007700">(</span><span style="color: #DD0000">'p.*,u.phone,u.roleId,u.order'</span><span style="color: #007700">)<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;-&gt;</span><span style="color: #0000BB">from</span><span style="color: #007700">(</span><span style="color: #0000BB">Profile</span><span style="color: #007700">::</span><span style="color: #0000BB">model</span><span style="color: #007700">()-&gt;</span><span style="color: #0000BB">tableName</span><span style="color: #007700">().</span><span style="color: #DD0000">'&nbsp;p'</span><span style="color: #007700">)<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;-&gt;</span><span style="color: #0000BB">join</span><span style="color: #007700">(</span><span style="color: #0000BB">User</span><span style="color: #007700">::</span><span style="color: #0000BB">model</span><span style="color: #007700">()-&gt;</span><span style="color: #0000BB">tableName</span><span style="color: #007700">().</span><span style="color: #DD0000">'&nbsp;u'</span><span style="color: #007700">,</span><span style="color: #DD0000">'p.id&nbsp;=&nbsp;u.id'</span><span style="color: #007700">)<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;-&gt;</span><span style="color: #0000BB">where</span><span style="color: #007700">(</span><span style="color: #DD0000">'u.roleId&nbsp;=&nbsp;:roleId'</span><span style="color: #007700">,array(</span><span style="color: #DD0000">'roleId'</span><span style="color: #007700">=&gt;</span><span style="color: #0000BB">Contents</span><span style="color: #007700">::</span><span style="color: #0000BB">ROLE_TEACHER</span><span style="color: #007700">))<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;-&gt;</span><span style="color: #0000BB">andWhere</span><span style="color: #007700">(</span><span style="color: #DD0000">'u.isDelete&nbsp;=&nbsp;:isDelete'</span><span style="color: #007700">,array(</span><span style="color: #DD0000">'isDelete'</span><span style="color: #007700">=&gt;</span><span style="color: #0000BB">Contents</span><span style="color: #007700">::</span><span style="color: #0000BB">F</span><span style="color: #007700">));<br />&nbsp;&nbsp;&nbsp;&nbsp;</span><span style="color: #0000BB">$command<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span style="color: #007700">-&gt;</span><span style="color: #0000BB">order</span><span style="color: #007700">(</span><span style="color: #DD0000">"CAST(IF(TRIM(u.order)=''&nbsp;,9999999999,u.order)&nbsp;AS&nbsp;UNSIGNED)&nbsp;ASC,&nbsp;p.createTime&nbsp;DESC"</span><span style="color: #007700">)<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;-&gt;</span><span style="color: #0000BB">limit</span><span style="color: #007700">(</span><span style="color: #0000BB">$count</span><span style="color: #007700">)<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;-&gt;</span><span style="color: #0000BB">offset</span><span style="color: #007700">((</span><span style="color: #0000BB">$page</span><span style="color: #007700">-</span><span style="color: #0000BB">1</span><span style="color: #007700">)&nbsp;*&nbsp;</span><span style="color: #0000BB">$count</span><span style="color: #007700">);<br />&nbsp;&nbsp;&nbsp;&nbsp;if(!</span><span style="color: #0000BB">Tools</span><span style="color: #007700">::</span><span style="color: #0000BB">isEmpty</span><span style="color: #007700">(</span><span style="color: #0000BB">$searchKey</span><span style="color: #007700">)){<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span style="color: #0000BB">$command<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span style="color: #007700">-&gt;</span><span style="color: #0000BB">leftJoin</span><span style="color: #007700">(</span><span style="color: #0000BB">TeachCategory</span><span style="color: #007700">::</span><span style="color: #0000BB">model</span><span style="color: #007700">()-&gt;</span><span style="color: #0000BB">tableName</span><span style="color: #007700">().</span><span style="color: #DD0000">'&nbsp;tc'</span><span style="color: #007700">,</span><span style="color: #DD0000">'tc.teachId&nbsp;=&nbsp;p.id'</span><span style="color: #007700">)<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;-&gt;</span><span style="color: #0000BB">leftJoin</span><span style="color: #007700">(</span><span style="color: #0000BB">Category</span><span style="color: #007700">::</span><span style="color: #0000BB">model</span><span style="color: #007700">()-&gt;</span><span style="color: #0000BB">tableName</span><span style="color: #007700">().</span><span style="color: #DD0000">'&nbsp;c'</span><span style="color: #007700">,</span><span style="color: #DD0000">'c.id&nbsp;=&nbsp;tc.categoryId'</span><span style="color: #007700">);<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span style="color: #0000BB">$searchKey&nbsp;</span><span style="color: #007700">=&nbsp;</span><span style="color: #0000BB">preg_split</span><span style="color: #007700">(</span><span style="color: #DD0000">'/[\s]+/'</span><span style="color: #007700">,</span><span style="color: #0000BB">$searchKey</span><span style="color: #007700">);<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;foreach(</span><span style="color: #0000BB">$searchKey&nbsp;</span><span style="color: #007700">as&nbsp;</span><span style="color: #0000BB">$key</span><span style="color: #007700">=&gt;</span><span style="color: #0000BB">$value</span><span style="color: #007700">){<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span style="color: #0000BB">$command</span><span style="color: #007700">-&gt;</span><span style="color: #0000BB">andWhere</span><span style="color: #007700">(<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;array(</span><span style="color: #DD0000">'OR'</span><span style="color: #007700">,<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;array(</span><span style="color: #DD0000">'like'</span><span style="color: #007700">,&nbsp;</span><span style="color: #DD0000">'c.name'</span><span style="color: #007700">,&nbsp;</span><span style="color: #DD0000">'%'</span><span style="color: #007700">.</span><span style="color: #0000BB">$value</span><span style="color: #007700">.</span><span style="color: #DD0000">'%'</span><span style="color: #007700">),</span><span style="color: #FF8000">//分类名字<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span style="color: #007700">array(</span><span style="color: #DD0000">'like'</span><span style="color: #007700">,&nbsp;</span><span style="color: #DD0000">'p.name'</span><span style="color: #007700">,&nbsp;</span><span style="color: #DD0000">'%'</span><span style="color: #007700">.</span><span style="color: #0000BB">$value</span><span style="color: #007700">.</span><span style="color: #DD0000">'%'</span><span style="color: #007700">),</span><span style="color: #FF8000">//名字<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span style="color: #007700">array(</span><span style="color: #DD0000">'like'</span><span style="color: #007700">,&nbsp;</span><span style="color: #DD0000">'p.college'</span><span style="color: #007700">,&nbsp;</span><span style="color: #DD0000">'%'</span><span style="color: #007700">.</span><span style="color: #0000BB">$value</span><span style="color: #007700">.</span><span style="color: #DD0000">'%'</span><span style="color: #007700">),</span><span style="color: #FF8000">//学校<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span style="color: #007700">array(</span><span style="color: #DD0000">'like'</span><span style="color: #007700">,&nbsp;</span><span style="color: #DD0000">'u.phone'</span><span style="color: #007700">,&nbsp;</span><span style="color: #DD0000">'%'</span><span style="color: #007700">.</span><span style="color: #0000BB">$value</span><span style="color: #007700">.</span><span style="color: #DD0000">'%'</span><span style="color: #007700">)</span><span style="color: #FF8000">//电话号码<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span style="color: #007700">));<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;}<br />&nbsp;&nbsp;&nbsp;&nbsp;}<br />&nbsp;&nbsp;&nbsp;&nbsp;</span><span style="color: #0000BB">$userList&nbsp;</span><span style="color: #007700">=&nbsp;</span><span style="color: #0000BB">Profile</span><span style="color: #007700">::</span><span style="color: #0000BB">model</span><span style="color: #007700">()-&gt;</span><span style="color: #0000BB">findAllBySql</span><span style="color: #007700">(</span><span style="color: #0000BB">$command</span><span style="color: #007700">-&gt;</span><span style="color: #0000BB">text</span><span style="color: #007700">,</span><span style="color: #0000BB">$command</span><span style="color: #007700">-&gt;</span><span style="color: #0000BB">params</span><span style="color: #007700">);<br />&nbsp;&nbsp;&nbsp;&nbsp;</span><span style="color: #0000BB">$data&nbsp;</span><span style="color: #007700">=&nbsp;array();<br />&nbsp;&nbsp;&nbsp;&nbsp;foreach&nbsp;(</span><span style="color: #0000BB">$userList&nbsp;</span><span style="color: #007700">as&nbsp;</span><span style="color: #0000BB">$key</span><span style="color: #007700">=&gt;</span><span style="color: #0000BB">$value</span><span style="color: #007700">){<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span style="color: #0000BB">$array&nbsp;</span><span style="color: #007700">=&nbsp;array();<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span style="color: #0000BB">$array</span><span style="color: #007700">[</span><span style="color: #DD0000">'userId'</span><span style="color: #007700">]&nbsp;=&nbsp;</span><span style="color: #0000BB">$value</span><span style="color: #007700">-&gt;</span><span style="color: #0000BB">id</span><span style="color: #007700">;<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span style="color: #0000BB">$array</span><span style="color: #007700">[</span><span style="color: #DD0000">'name'</span><span style="color: #007700">]&nbsp;=&nbsp;</span><span style="color: #0000BB">$value</span><span style="color: #007700">-&gt;</span><span style="color: #0000BB">name</span><span style="color: #007700">;<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span style="color: #0000BB">$array</span><span style="color: #007700">[</span><span style="color: #DD0000">'phone'</span><span style="color: #007700">]&nbsp;=&nbsp;</span><span style="color: #0000BB">$value</span><span style="color: #007700">-&gt;</span><span style="color: #0000BB">phone</span><span style="color: #007700">;<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span style="color: #0000BB">$array</span><span style="color: #007700">[</span><span style="color: #DD0000">'sex'</span><span style="color: #007700">]&nbsp;=&nbsp;</span><span style="color: #0000BB">$value</span><span style="color: #007700">-&gt;</span><span style="color: #0000BB">sex</span><span style="color: #007700">;<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span style="color: #0000BB">$array</span><span style="color: #007700">[</span><span style="color: #DD0000">'roleId'</span><span style="color: #007700">]&nbsp;=&nbsp;</span><span style="color: #0000BB">$value</span><span style="color: #007700">-&gt;</span><span style="color: #0000BB">roleId</span><span style="color: #007700">;<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span style="color: #0000BB">$array</span><span style="color: #007700">[</span><span style="color: #DD0000">'college'</span><span style="color: #007700">]&nbsp;=&nbsp;</span><span style="color: #0000BB">$value</span><span style="color: #007700">-&gt;</span><span style="color: #0000BB">college</span><span style="color: #007700">;<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span style="color: #0000BB">$array</span><span style="color: #007700">[</span><span style="color: #DD0000">'birthday'</span><span style="color: #007700">]&nbsp;=&nbsp;</span><span style="color: #0000BB">$value</span><span style="color: #007700">-&gt;</span><span style="color: #0000BB">birthday</span><span style="color: #007700">;<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span style="color: #0000BB">$array</span><span style="color: #007700">[</span><span style="color: #DD0000">'age'</span><span style="color: #007700">]&nbsp;=&nbsp;</span><span style="color: #0000BB">Tools</span><span style="color: #007700">::</span><span style="color: #0000BB">age</span><span style="color: #007700">(</span><span style="color: #0000BB">$value</span><span style="color: #007700">-&gt;</span><span style="color: #0000BB">birthday</span><span style="color: #007700">);<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span style="color: #0000BB">$array</span><span style="color: #007700">[</span><span style="color: #DD0000">'order'</span><span style="color: #007700">]&nbsp;=&nbsp;</span><span style="color: #0000BB">$value</span><span style="color: #007700">-&gt;</span><span style="color: #0000BB">order</span><span style="color: #007700">;<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span style="color: #0000BB">$teachCategory&nbsp;</span><span style="color: #007700">=&nbsp;</span><span style="color: #0000BB">TeachCategory</span><span style="color: #007700">::</span><span style="color: #0000BB">model</span><span style="color: #007700">()-&gt;</span><span style="color: #0000BB">getAllTeachCategoryByTeachId</span><span style="color: #007700">(</span><span style="color: #0000BB">$value</span><span style="color: #007700">-&gt;</span><span style="color: #0000BB">id</span><span style="color: #007700">);<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span style="color: #0000BB">$categoryList&nbsp;</span><span style="color: #007700">=&nbsp;array();<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;foreach&nbsp;(</span><span style="color: #0000BB">$teachCategory&nbsp;</span><span style="color: #007700">as&nbsp;</span><span style="color: #0000BB">$k</span><span style="color: #007700">=&gt;</span><span style="color: #0000BB">$v</span><span style="color: #007700">){<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span style="color: #0000BB">$categoryList</span><span style="color: #007700">[</span><span style="color: #0000BB">$k</span><span style="color: #007700">][</span><span style="color: #DD0000">'id'</span><span style="color: #007700">]&nbsp;=&nbsp;</span><span style="color: #0000BB">$v</span><span style="color: #007700">-&gt;</span><span style="color: #0000BB">category</span><span style="color: #007700">-&gt;</span><span style="color: #0000BB">id</span><span style="color: #007700">;<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span style="color: #0000BB">$categoryList</span><span style="color: #007700">[</span><span style="color: #0000BB">$k</span><span style="color: #007700">][</span><span style="color: #DD0000">'name'</span><span style="color: #007700">]&nbsp;=&nbsp;</span><span style="color: #0000BB">$v</span><span style="color: #007700">-&gt;</span><span style="color: #0000BB">category</span><span style="color: #007700">-&gt;</span><span style="color: #0000BB">name</span><span style="color: #007700">;<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;}<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span style="color: #0000BB">$array</span><span style="color: #007700">[</span><span style="color: #DD0000">'categoryList'</span><span style="color: #007700">]&nbsp;=&nbsp;</span><span style="color: #0000BB">$categoryList</span><span style="color: #007700">;<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span style="color: #0000BB">$data</span><span style="color: #007700">[</span><span style="color: #0000BB">$key</span><span style="color: #007700">]&nbsp;=&nbsp;</span><span style="color: #0000BB">$array</span><span style="color: #007700">;<br />&nbsp;&nbsp;&nbsp;&nbsp;}<br />&nbsp;&nbsp;&nbsp;&nbsp;return&nbsp;</span><span style="color: #0000BB">$data</span><span style="color: #007700">;<br />}</span>
</span>
</code></div>
</div>

<p>根据查询条件获得老师列表</p>


<div class="detailHeader" id="getTeacherListCount-detail">
getTeacherListCount()
<span class="detailHeaderTag">
method
</span>
</div>

<table class="summaryTable">
<tr><td colspan="3">
<div class="signature2">
public integer <b>getTeacherListCount</b>($searchKey $searchKey)</div>
</td></tr>
<tr>
  <td class="paramNameCol">$searchKey</td>
  <td class="paramTypeCol">$searchKey</td>
  <td class="paramDescCol"></td>
</tr>
<tr>
  <td class="paramNameCol">{return}</td>
  <td class="paramTypeCol">integer</td>
  <td class="paramDescCol"></td>
</tr>
</table>

<div class="sourceCode">
<b>Source Code:</b>  (<b><a href="#" class="show">show</a></b>)
<div class="code"><code><span style="color: #000000">
<span style="color: #0000BB"></span><span style="color: #007700">public&nbsp;function&nbsp;</span><span style="color: #0000BB">getTeacherListCount</span><span style="color: #007700">(</span><span style="color: #0000BB">$searchKey</span><span style="color: #007700">){<br />&nbsp;&nbsp;&nbsp;&nbsp;</span><span style="color: #0000BB">$connection&nbsp;</span><span style="color: #007700">=&nbsp;</span><span style="color: #0000BB">Yii</span><span style="color: #007700">::</span><span style="color: #0000BB">app</span><span style="color: #007700">()-&gt;</span><span style="color: #0000BB">db</span><span style="color: #007700">;<br />&nbsp;&nbsp;&nbsp;&nbsp;</span><span style="color: #0000BB">$command&nbsp;</span><span style="color: #007700">=&nbsp;</span><span style="color: #0000BB">$connection</span><span style="color: #007700">-&gt;</span><span style="color: #0000BB">createCommand</span><span style="color: #007700">();<br />&nbsp;&nbsp;&nbsp;&nbsp;</span><span style="color: #0000BB">$command<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span style="color: #007700">-&gt;</span><span style="color: #0000BB">select</span><span style="color: #007700">(</span><span style="color: #DD0000">'count(distinct&nbsp;p.id)'</span><span style="color: #007700">)<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;-&gt;</span><span style="color: #0000BB">from</span><span style="color: #007700">(</span><span style="color: #0000BB">Profile</span><span style="color: #007700">::</span><span style="color: #0000BB">model</span><span style="color: #007700">()-&gt;</span><span style="color: #0000BB">tableName</span><span style="color: #007700">().</span><span style="color: #DD0000">'&nbsp;p'</span><span style="color: #007700">)<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;-&gt;</span><span style="color: #0000BB">join</span><span style="color: #007700">(</span><span style="color: #0000BB">User</span><span style="color: #007700">::</span><span style="color: #0000BB">model</span><span style="color: #007700">()-&gt;</span><span style="color: #0000BB">tableName</span><span style="color: #007700">().</span><span style="color: #DD0000">'&nbsp;u'</span><span style="color: #007700">,</span><span style="color: #DD0000">'p.id&nbsp;=&nbsp;u.id'</span><span style="color: #007700">)<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;-&gt;</span><span style="color: #0000BB">where</span><span style="color: #007700">(</span><span style="color: #DD0000">'u.roleId&nbsp;=&nbsp;:roleId'</span><span style="color: #007700">,array(</span><span style="color: #DD0000">'roleId'</span><span style="color: #007700">=&gt;</span><span style="color: #0000BB">Contents</span><span style="color: #007700">::</span><span style="color: #0000BB">ROLE_TEACHER</span><span style="color: #007700">))<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;-&gt;</span><span style="color: #0000BB">andWhere</span><span style="color: #007700">(</span><span style="color: #DD0000">'u.isDelete&nbsp;=&nbsp;:isDelete'</span><span style="color: #007700">,array(</span><span style="color: #DD0000">'isDelete'</span><span style="color: #007700">=&gt;</span><span style="color: #0000BB">Contents</span><span style="color: #007700">::</span><span style="color: #0000BB">F</span><span style="color: #007700">));<br />&nbsp;&nbsp;&nbsp;&nbsp;if(!</span><span style="color: #0000BB">Tools</span><span style="color: #007700">::</span><span style="color: #0000BB">isEmpty</span><span style="color: #007700">(</span><span style="color: #0000BB">$searchKey</span><span style="color: #007700">)){<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span style="color: #0000BB">$command<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span style="color: #007700">-&gt;</span><span style="color: #0000BB">leftJoin</span><span style="color: #007700">(</span><span style="color: #0000BB">TeachCategory</span><span style="color: #007700">::</span><span style="color: #0000BB">model</span><span style="color: #007700">()-&gt;</span><span style="color: #0000BB">tableName</span><span style="color: #007700">().</span><span style="color: #DD0000">'&nbsp;tc'</span><span style="color: #007700">,</span><span style="color: #DD0000">'tc.teachId&nbsp;=&nbsp;p.id'</span><span style="color: #007700">)<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;-&gt;</span><span style="color: #0000BB">leftJoin</span><span style="color: #007700">(</span><span style="color: #0000BB">Category</span><span style="color: #007700">::</span><span style="color: #0000BB">model</span><span style="color: #007700">()-&gt;</span><span style="color: #0000BB">tableName</span><span style="color: #007700">().</span><span style="color: #DD0000">'&nbsp;c'</span><span style="color: #007700">,</span><span style="color: #DD0000">'c.id&nbsp;=&nbsp;tc.categoryId'</span><span style="color: #007700">);<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span style="color: #0000BB">$searchKey&nbsp;</span><span style="color: #007700">=&nbsp;</span><span style="color: #0000BB">preg_split</span><span style="color: #007700">(</span><span style="color: #DD0000">'/[\s]+/'</span><span style="color: #007700">,</span><span style="color: #0000BB">$searchKey</span><span style="color: #007700">);<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;foreach(</span><span style="color: #0000BB">$searchKey&nbsp;</span><span style="color: #007700">as&nbsp;</span><span style="color: #0000BB">$key</span><span style="color: #007700">=&gt;</span><span style="color: #0000BB">$value</span><span style="color: #007700">){<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span style="color: #0000BB">$command</span><span style="color: #007700">-&gt;</span><span style="color: #0000BB">andWhere</span><span style="color: #007700">(<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;array(</span><span style="color: #DD0000">'OR'</span><span style="color: #007700">,<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;array(</span><span style="color: #DD0000">'like'</span><span style="color: #007700">,&nbsp;</span><span style="color: #DD0000">'c.name'</span><span style="color: #007700">,&nbsp;</span><span style="color: #DD0000">'%'</span><span style="color: #007700">.</span><span style="color: #0000BB">$value</span><span style="color: #007700">.</span><span style="color: #DD0000">'%'</span><span style="color: #007700">),</span><span style="color: #FF8000">//分类名字<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span style="color: #007700">array(</span><span style="color: #DD0000">'like'</span><span style="color: #007700">,&nbsp;</span><span style="color: #DD0000">'p.name'</span><span style="color: #007700">,&nbsp;</span><span style="color: #DD0000">'%'</span><span style="color: #007700">.</span><span style="color: #0000BB">$value</span><span style="color: #007700">.</span><span style="color: #DD0000">'%'</span><span style="color: #007700">),</span><span style="color: #FF8000">//名字<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span style="color: #007700">array(</span><span style="color: #DD0000">'like'</span><span style="color: #007700">,&nbsp;</span><span style="color: #DD0000">'p.college'</span><span style="color: #007700">,&nbsp;</span><span style="color: #DD0000">'%'</span><span style="color: #007700">.</span><span style="color: #0000BB">$value</span><span style="color: #007700">.</span><span style="color: #DD0000">'%'</span><span style="color: #007700">),</span><span style="color: #FF8000">//学校<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span style="color: #007700">array(</span><span style="color: #DD0000">'like'</span><span style="color: #007700">,&nbsp;</span><span style="color: #DD0000">'u.phone'</span><span style="color: #007700">,&nbsp;</span><span style="color: #DD0000">'%'</span><span style="color: #007700">.</span><span style="color: #0000BB">$value</span><span style="color: #007700">.</span><span style="color: #DD0000">'%'</span><span style="color: #007700">)</span><span style="color: #FF8000">//电话号码<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span style="color: #007700">));<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;}<br />&nbsp;&nbsp;&nbsp;&nbsp;}<br />&nbsp;&nbsp;&nbsp;&nbsp;</span><span style="color: #0000BB">$count&nbsp;</span><span style="color: #007700">=&nbsp;</span><span style="color: #0000BB">Profile</span><span style="color: #007700">::</span><span style="color: #0000BB">model</span><span style="color: #007700">()-&gt;</span><span style="color: #0000BB">countBySql</span><span style="color: #007700">(</span><span style="color: #0000BB">$command</span><span style="color: #007700">-&gt;</span><span style="color: #0000BB">text</span><span style="color: #007700">,</span><span style="color: #0000BB">$command</span><span style="color: #007700">-&gt;</span><span style="color: #0000BB">params</span><span style="color: #007700">);<br />&nbsp;&nbsp;&nbsp;&nbsp;return&nbsp;</span><span style="color: #0000BB">$count</span><span style="color: #007700">;<br />}</span>
</span>
</code></div>
</div>

<p>获得查询老师的总条数</p>


<div class="detailHeader" id="getUserByPkAndPassword-detail">
getUserByPkAndPassword()
<span class="detailHeaderTag">
method
</span>
</div>

<table class="summaryTable">
<tr><td colspan="3">
<div class="signature2">
public User <b>getUserByPkAndPassword</b>(string $userId, string $oldPassword)</div>
</td></tr>
<tr>
  <td class="paramNameCol">$userId</td>
  <td class="paramTypeCol">string</td>
  <td class="paramDescCol"></td>
</tr>
<tr>
  <td class="paramNameCol">$oldPassword</td>
  <td class="paramTypeCol">string</td>
  <td class="paramDescCol"></td>
</tr>
<tr>
  <td class="paramNameCol">{return}</td>
  <td class="paramTypeCol">User</td>
  <td class="paramDescCol"></td>
</tr>
</table>

<div class="sourceCode">
<b>Source Code:</b>  (<b><a href="#" class="show">show</a></b>)
<div class="code"><code><span style="color: #000000">
<span style="color: #0000BB"></span><span style="color: #007700">public&nbsp;function&nbsp;</span><span style="color: #0000BB">getUserByPkAndPassword</span><span style="color: #007700">(</span><span style="color: #0000BB">$userId</span><span style="color: #007700">,&nbsp;</span><span style="color: #0000BB">$oldPassword</span><span style="color: #007700">)&nbsp;{<br />&nbsp;&nbsp;&nbsp;&nbsp;return&nbsp;</span><span style="color: #0000BB">User</span><span style="color: #007700">::</span><span style="color: #0000BB">model</span><span style="color: #007700">()-&gt;</span><span style="color: #0000BB">findByPk</span><span style="color: #007700">(</span><span style="color: #0000BB">$userId</span><span style="color: #007700">,&nbsp;</span><span style="color: #DD0000">'password&nbsp;=&nbsp;:password'</span><span style="color: #007700">,&nbsp;array(</span><span style="color: #DD0000">'password'&nbsp;</span><span style="color: #007700">=&gt;&nbsp;</span><span style="color: #0000BB">sha1</span><span style="color: #007700">(</span><span style="color: #0000BB">$oldPassword</span><span style="color: #007700">)));<br />}</span>
</span>
</code></div>
</div>

<p>根据用户ID和密码获得用户。</p>


<div class="detailHeader" id="getUserByphone-detail">
getUserByphone()
<span class="detailHeaderTag">
method
</span>
</div>

<table class="summaryTable">
<tr><td colspan="3">
<div class="signature2">
public User <b>getUserByphone</b>(string $phone)</div>
</td></tr>
<tr>
  <td class="paramNameCol">$phone</td>
  <td class="paramTypeCol">string</td>
  <td class="paramDescCol"></td>
</tr>
<tr>
  <td class="paramNameCol">{return}</td>
  <td class="paramTypeCol">User</td>
  <td class="paramDescCol"></td>
</tr>
</table>

<div class="sourceCode">
<b>Source Code:</b>  (<b><a href="#" class="show">show</a></b>)
<div class="code"><code><span style="color: #000000">
<span style="color: #0000BB"></span><span style="color: #007700">public&nbsp;function&nbsp;</span><span style="color: #0000BB">getUserByphone</span><span style="color: #007700">(</span><span style="color: #0000BB">$phone</span><span style="color: #007700">)&nbsp;{<br />&nbsp;&nbsp;&nbsp;&nbsp;return&nbsp;</span><span style="color: #0000BB">User</span><span style="color: #007700">::</span><span style="color: #0000BB">model</span><span style="color: #007700">()-&gt;</span><span style="color: #0000BB">find</span><span style="color: #007700">(</span><span style="color: #DD0000">'phone&nbsp;=&nbsp;:phone'</span><span style="color: #007700">,&nbsp;array(</span><span style="color: #DD0000">'phone'&nbsp;</span><span style="color: #007700">=&gt;&nbsp;</span><span style="color: #0000BB">$phone</span><span style="color: #007700">));<br />}</span>
</span>
</code></div>
</div>

<p>根据手机号码获得用户数据</p>


<div class="detailHeader" id="getUserList-detail">
getUserList()
<span class="detailHeaderTag">
method
</span>
</div>

<table class="summaryTable">
<tr><td colspan="3">
<div class="signature2">
public array <b>getUserList</b>(string $name, string $type, string $count=20)</div>
</td></tr>
<tr>
  <td class="paramNameCol">$name</td>
  <td class="paramTypeCol">string</td>
  <td class="paramDescCol"></td>
</tr>
<tr>
  <td class="paramNameCol">$type</td>
  <td class="paramTypeCol">string</td>
  <td class="paramDescCol"></td>
</tr>
<tr>
  <td class="paramNameCol">$count</td>
  <td class="paramTypeCol">string</td>
  <td class="paramDescCol"></td>
</tr>
<tr>
  <td class="paramNameCol">{return}</td>
  <td class="paramTypeCol">array</td>
  <td class="paramDescCol"></td>
</tr>
</table>

<div class="sourceCode">
<b>Source Code:</b>  (<b><a href="#" class="show">show</a></b>)
<div class="code"><code><span style="color: #000000">
<span style="color: #0000BB"></span><span style="color: #007700">public&nbsp;function&nbsp;</span><span style="color: #0000BB">getUserList</span><span style="color: #007700">(</span><span style="color: #0000BB">$name</span><span style="color: #007700">,</span><span style="color: #0000BB">$type</span><span style="color: #007700">,</span><span style="color: #0000BB">$count</span><span style="color: #007700">=</span><span style="color: #0000BB">Contents</span><span style="color: #007700">::</span><span style="color: #0000BB">COUNT</span><span style="color: #007700">){<br />&nbsp;&nbsp;&nbsp;&nbsp;</span><span style="color: #0000BB">$connection&nbsp;</span><span style="color: #007700">=&nbsp;</span><span style="color: #0000BB">Yii</span><span style="color: #007700">::</span><span style="color: #0000BB">app</span><span style="color: #007700">()-&gt;</span><span style="color: #0000BB">db</span><span style="color: #007700">;<br />&nbsp;&nbsp;&nbsp;&nbsp;</span><span style="color: #0000BB">$command&nbsp;</span><span style="color: #007700">=&nbsp;</span><span style="color: #0000BB">$connection</span><span style="color: #007700">-&gt;</span><span style="color: #0000BB">createCommand</span><span style="color: #007700">();<br />&nbsp;&nbsp;&nbsp;&nbsp;</span><span style="color: #0000BB">$command<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span style="color: #007700">-&gt;</span><span style="color: #0000BB">selectDistinct</span><span style="color: #007700">(</span><span style="color: #DD0000">'p.name,p.id,t.usuallyLocationX&nbsp;as&nbsp;locationX,t.usuallyLocationY&nbsp;as&nbsp;locationY,t.usuallyLocationInfo&nbsp;as&nbsp;locationInfo'</span><span style="color: #007700">)<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;-&gt;</span><span style="color: #0000BB">from</span><span style="color: #007700">(</span><span style="color: #0000BB">Profile</span><span style="color: #007700">::</span><span style="color: #0000BB">model</span><span style="color: #007700">()-&gt;</span><span style="color: #0000BB">tableName</span><span style="color: #007700">().</span><span style="color: #DD0000">'&nbsp;p'</span><span style="color: #007700">)<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;-&gt;</span><span style="color: #0000BB">join</span><span style="color: #007700">(</span><span style="color: #0000BB">User</span><span style="color: #007700">::</span><span style="color: #0000BB">model</span><span style="color: #007700">()-&gt;</span><span style="color: #0000BB">tableName</span><span style="color: #007700">().</span><span style="color: #DD0000">'&nbsp;u'</span><span style="color: #007700">,</span><span style="color: #DD0000">'p.id&nbsp;=&nbsp;u.id'</span><span style="color: #007700">)<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;-&gt;</span><span style="color: #0000BB">join</span><span style="color: #007700">(</span><span style="color: #0000BB">Teach</span><span style="color: #007700">::</span><span style="color: #0000BB">model</span><span style="color: #007700">()-&gt;</span><span style="color: #0000BB">tableName</span><span style="color: #007700">().</span><span style="color: #DD0000">'&nbsp;t'</span><span style="color: #007700">,</span><span style="color: #DD0000">'t.id&nbsp;=&nbsp;u.id'</span><span style="color: #007700">)<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;-&gt;</span><span style="color: #0000BB">where</span><span style="color: #007700">(</span><span style="color: #DD0000">'u.isDelete&nbsp;=&nbsp;:isDelete'</span><span style="color: #007700">,array(</span><span style="color: #DD0000">'isDelete'</span><span style="color: #007700">=&gt;</span><span style="color: #0000BB">Contents</span><span style="color: #007700">::</span><span style="color: #0000BB">F</span><span style="color: #007700">));<br />&nbsp;&nbsp;&nbsp;&nbsp;if(!</span><span style="color: #0000BB">Tools</span><span style="color: #007700">::</span><span style="color: #0000BB">isEmpty</span><span style="color: #007700">(</span><span style="color: #0000BB">$type</span><span style="color: #007700">)){<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span style="color: #0000BB">$command</span><span style="color: #007700">-&gt;</span><span style="color: #0000BB">andWhere</span><span style="color: #007700">(</span><span style="color: #DD0000">'u.roleId&nbsp;=&nbsp;:roleId'</span><span style="color: #007700">,array(</span><span style="color: #DD0000">'roleId'</span><span style="color: #007700">=&gt;</span><span style="color: #0000BB">$type</span><span style="color: #007700">));<br />&nbsp;&nbsp;&nbsp;&nbsp;}<br />&nbsp;&nbsp;&nbsp;&nbsp;if(!</span><span style="color: #0000BB">Tools</span><span style="color: #007700">::</span><span style="color: #0000BB">isEmpty</span><span style="color: #007700">(</span><span style="color: #0000BB">$name</span><span style="color: #007700">)){<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span style="color: #0000BB">$name&nbsp;</span><span style="color: #007700">=&nbsp;</span><span style="color: #0000BB">preg_split</span><span style="color: #007700">(</span><span style="color: #DD0000">'/[\s]+/'</span><span style="color: #007700">,</span><span style="color: #0000BB">$name</span><span style="color: #007700">);<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;foreach(</span><span style="color: #0000BB">$name&nbsp;</span><span style="color: #007700">as&nbsp;</span><span style="color: #0000BB">$key</span><span style="color: #007700">=&gt;</span><span style="color: #0000BB">$value</span><span style="color: #007700">){<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span style="color: #0000BB">$command</span><span style="color: #007700">-&gt;</span><span style="color: #0000BB">andWhere</span><span style="color: #007700">(<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;array(</span><span style="color: #DD0000">'OR'</span><span style="color: #007700">,<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;array(</span><span style="color: #DD0000">'like'</span><span style="color: #007700">,&nbsp;</span><span style="color: #DD0000">'p.name'</span><span style="color: #007700">,&nbsp;</span><span style="color: #DD0000">'%'</span><span style="color: #007700">.</span><span style="color: #0000BB">$value</span><span style="color: #007700">.</span><span style="color: #DD0000">'%'</span><span style="color: #007700">),</span><span style="color: #FF8000">//名字<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span style="color: #007700">array(</span><span style="color: #DD0000">'like'</span><span style="color: #007700">,&nbsp;</span><span style="color: #DD0000">'p.college'</span><span style="color: #007700">,&nbsp;</span><span style="color: #DD0000">'%'</span><span style="color: #007700">.</span><span style="color: #0000BB">$value</span><span style="color: #007700">.</span><span style="color: #DD0000">'%'</span><span style="color: #007700">),</span><span style="color: #FF8000">//学校<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span style="color: #007700">array(</span><span style="color: #DD0000">'like'</span><span style="color: #007700">,&nbsp;</span><span style="color: #DD0000">'u.phone'</span><span style="color: #007700">,&nbsp;</span><span style="color: #DD0000">'%'</span><span style="color: #007700">.</span><span style="color: #0000BB">$value</span><span style="color: #007700">.</span><span style="color: #DD0000">'%'</span><span style="color: #007700">)</span><span style="color: #FF8000">//电话号码<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span style="color: #007700">));<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;}<br />&nbsp;&nbsp;&nbsp;&nbsp;}<br />&nbsp;&nbsp;&nbsp;&nbsp;</span><span style="color: #0000BB">$command<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span style="color: #007700">-&gt;</span><span style="color: #0000BB">order</span><span style="color: #007700">(</span><span style="color: #DD0000">"CAST(IF(TRIM(u.order)=''&nbsp;,9999999999,u.order)&nbsp;AS&nbsp;UNSIGNED)&nbsp;ASC,&nbsp;p.createTime&nbsp;DESC"</span><span style="color: #007700">)<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;-&gt;</span><span style="color: #0000BB">limit</span><span style="color: #007700">(</span><span style="color: #0000BB">$count</span><span style="color: #007700">)<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;-&gt;</span><span style="color: #0000BB">offset</span><span style="color: #007700">((</span><span style="color: #0000BB">1</span><span style="color: #007700">-</span><span style="color: #0000BB">1</span><span style="color: #007700">)&nbsp;*&nbsp;</span><span style="color: #0000BB">$count</span><span style="color: #007700">);<br />&nbsp;&nbsp;&nbsp;&nbsp;</span><span style="color: #0000BB">$userList&nbsp;</span><span style="color: #007700">=&nbsp;</span><span style="color: #0000BB">Profile</span><span style="color: #007700">::</span><span style="color: #0000BB">model</span><span style="color: #007700">()-&gt;</span><span style="color: #0000BB">findAllBySql</span><span style="color: #007700">(</span><span style="color: #0000BB">$command</span><span style="color: #007700">-&gt;</span><span style="color: #0000BB">text</span><span style="color: #007700">,</span><span style="color: #0000BB">$command</span><span style="color: #007700">-&gt;</span><span style="color: #0000BB">params</span><span style="color: #007700">);<br />&nbsp;&nbsp;&nbsp;&nbsp;</span><span style="color: #0000BB">$data&nbsp;</span><span style="color: #007700">=&nbsp;array();<br />&nbsp;&nbsp;&nbsp;&nbsp;foreach&nbsp;(</span><span style="color: #0000BB">$userList&nbsp;</span><span style="color: #007700">as&nbsp;</span><span style="color: #0000BB">$key</span><span style="color: #007700">=&gt;</span><span style="color: #0000BB">$value</span><span style="color: #007700">){<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span style="color: #0000BB">$array&nbsp;</span><span style="color: #007700">=&nbsp;array();<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span style="color: #0000BB">$array</span><span style="color: #007700">[</span><span style="color: #DD0000">'userId'</span><span style="color: #007700">]&nbsp;=&nbsp;</span><span style="color: #0000BB">$value</span><span style="color: #007700">-&gt;</span><span style="color: #0000BB">id</span><span style="color: #007700">;<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span style="color: #0000BB">$array</span><span style="color: #007700">[</span><span style="color: #DD0000">'name'</span><span style="color: #007700">]&nbsp;=&nbsp;</span><span style="color: #0000BB">$value</span><span style="color: #007700">-&gt;</span><span style="color: #0000BB">name</span><span style="color: #007700">;<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span style="color: #0000BB">$array</span><span style="color: #007700">[</span><span style="color: #DD0000">'location'</span><span style="color: #007700">][</span><span style="color: #DD0000">'x'</span><span style="color: #007700">]&nbsp;=&nbsp;</span><span style="color: #0000BB">$value</span><span style="color: #007700">-&gt;</span><span style="color: #0000BB">locationX</span><span style="color: #007700">;<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span style="color: #0000BB">$array</span><span style="color: #007700">[</span><span style="color: #DD0000">'location'</span><span style="color: #007700">][</span><span style="color: #DD0000">'y'</span><span style="color: #007700">]&nbsp;=&nbsp;</span><span style="color: #0000BB">$value</span><span style="color: #007700">-&gt;</span><span style="color: #0000BB">locationY</span><span style="color: #007700">;<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span style="color: #0000BB">$array</span><span style="color: #007700">[</span><span style="color: #DD0000">'location'</span><span style="color: #007700">][</span><span style="color: #DD0000">'info'</span><span style="color: #007700">]&nbsp;=&nbsp;</span><span style="color: #0000BB">$value</span><span style="color: #007700">-&gt;</span><span style="color: #0000BB">locationInfo</span><span style="color: #007700">;<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span style="color: #0000BB">$data</span><span style="color: #007700">[</span><span style="color: #0000BB">$key</span><span style="color: #007700">]&nbsp;=&nbsp;</span><span style="color: #0000BB">$array</span><span style="color: #007700">;<br />&nbsp;&nbsp;&nbsp;&nbsp;}<br />&nbsp;&nbsp;&nbsp;&nbsp;return&nbsp;</span><span style="color: #0000BB">$data</span><span style="color: #007700">;<br />}</span>
</span>
</code></div>
</div>

<p>获得老师或机构的ID，name和位置信息的列表，用于视频添加时，联想用户</p>


<div class="detailHeader" id="merge-detail">
merge()
<span class="detailHeaderTag">
method
</span>
</div>

<table class="summaryTable">
<tr><td colspan="3">
<div class="signature2">
public void <b>merge</b>($data $data, $mergrData &$mergrData)</div>
</td></tr>
<tr>
  <td class="paramNameCol">$data</td>
  <td class="paramTypeCol">$data</td>
  <td class="paramDescCol"></td>
</tr>
<tr>
  <td class="paramNameCol">$mergrData</td>
  <td class="paramTypeCol">$mergrData</td>
  <td class="paramDescCol"></td>
</tr>
</table>

<div class="sourceCode">
<b>Source Code:</b>  (<b><a href="#" class="show">show</a></b>)
<div class="code"><code><span style="color: #000000">
<span style="color: #0000BB"></span><span style="color: #007700">public&nbsp;function&nbsp;</span><span style="color: #0000BB">merge</span><span style="color: #007700">(</span><span style="color: #0000BB">$data</span><span style="color: #007700">,&amp;</span><span style="color: #0000BB">$mergrData</span><span style="color: #007700">){<br />&nbsp;&nbsp;&nbsp;&nbsp;if(empty(</span><span style="color: #0000BB">$data</span><span style="color: #007700">)&nbsp;||&nbsp;</span><span style="color: #0000BB">count</span><span style="color: #007700">(</span><span style="color: #0000BB">$data</span><span style="color: #007700">)&nbsp;==&nbsp;</span><span style="color: #0000BB">0</span><span style="color: #007700">){<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;return;<br />&nbsp;&nbsp;&nbsp;&nbsp;}<br />&nbsp;&nbsp;&nbsp;&nbsp;</span><span style="color: #0000BB">$key&nbsp;</span><span style="color: #007700">=&nbsp;</span><span style="color: #0000BB">0</span><span style="color: #007700">;<br />&nbsp;&nbsp;&nbsp;&nbsp;foreach(</span><span style="color: #0000BB">$data&nbsp;</span><span style="color: #007700">as&nbsp;</span><span style="color: #0000BB">$key</span><span style="color: #007700">=&gt;</span><span style="color: #0000BB">$value</span><span style="color: #007700">){<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span style="color: #0000BB">$key&nbsp;</span><span style="color: #007700">=&nbsp;</span><span style="color: #0000BB">$key</span><span style="color: #007700">;<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;break;<br />&nbsp;&nbsp;&nbsp;&nbsp;}<br />&nbsp;&nbsp;&nbsp;&nbsp;</span><span style="color: #0000BB">$x&nbsp;</span><span style="color: #007700">=&nbsp;</span><span style="color: #0000BB">$data</span><span style="color: #007700">[</span><span style="color: #0000BB">$key</span><span style="color: #007700">][</span><span style="color: #DD0000">'location'</span><span style="color: #007700">][</span><span style="color: #DD0000">'x'</span><span style="color: #007700">];<br />&nbsp;&nbsp;&nbsp;&nbsp;</span><span style="color: #0000BB">$y&nbsp;</span><span style="color: #007700">=&nbsp;</span><span style="color: #0000BB">$data</span><span style="color: #007700">[</span><span style="color: #0000BB">$key</span><span style="color: #007700">][</span><span style="color: #DD0000">'location'</span><span style="color: #007700">][</span><span style="color: #DD0000">'y'</span><span style="color: #007700">];<br /><br />&nbsp;&nbsp;&nbsp;&nbsp;</span><span style="color: #FF8000">//if&nbsp;this&nbsp;line&nbsp;throw&nbsp;a&nbsp;exception,&nbsp;Change&nbsp;EConfig's&nbsp;$strictMode&nbsp;value&nbsp;to&nbsp;false<br />&nbsp;&nbsp;&nbsp;&nbsp;</span><span style="color: #0000BB">$radius&nbsp;</span><span style="color: #007700">=&nbsp;</span><span style="color: #0000BB">Yii</span><span style="color: #007700">::</span><span style="color: #0000BB">app</span><span style="color: #007700">()-&gt;</span><span style="color: #0000BB">config</span><span style="color: #007700">-&gt;</span><span style="color: #0000BB">get</span><span style="color: #007700">(</span><span style="color: #0000BB">Contents</span><span style="color: #007700">::</span><span style="color: #0000BB">USER_MERGE_RADIUS_MILE_KEY</span><span style="color: #007700">);<br />&nbsp;&nbsp;&nbsp;&nbsp;if(</span><span style="color: #0000BB">$radius&nbsp;</span><span style="color: #007700">==&nbsp;</span><span style="color: #0000BB">null</span><span style="color: #007700">){<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span style="color: #0000BB">Yii</span><span style="color: #007700">::</span><span style="color: #0000BB">app</span><span style="color: #007700">()-&gt;</span><span style="color: #0000BB">config</span><span style="color: #007700">-&gt;</span><span style="color: #0000BB">set</span><span style="color: #007700">(</span><span style="color: #0000BB">Contents</span><span style="color: #007700">::</span><span style="color: #0000BB">USER_MERGE_RADIUS_MILE_KEY</span><span style="color: #007700">,</span><span style="color: #0000BB">Contents</span><span style="color: #007700">::</span><span style="color: #0000BB">USER_MERGE_RADIUS_MILE</span><span style="color: #007700">);<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span style="color: #0000BB">$radius&nbsp;</span><span style="color: #007700">=&nbsp;</span><span style="color: #0000BB">Contents</span><span style="color: #007700">::</span><span style="color: #0000BB">USER_MERGE_RADIUS_MILE</span><span style="color: #007700">;<br />&nbsp;&nbsp;&nbsp;&nbsp;}<br />&nbsp;&nbsp;&nbsp;&nbsp;</span><span style="color: #0000BB">$around&nbsp;</span><span style="color: #007700">=&nbsp;</span><span style="color: #0000BB">LocationTool</span><span style="color: #007700">::</span><span style="color: #0000BB">getAround</span><span style="color: #007700">(</span><span style="color: #0000BB">$x</span><span style="color: #007700">,&nbsp;</span><span style="color: #0000BB">$y</span><span style="color: #007700">,&nbsp;</span><span style="color: #0000BB">$radius</span><span style="color: #007700">);<br />&nbsp;&nbsp;&nbsp;&nbsp;</span><span style="color: #0000BB">$temp&nbsp;</span><span style="color: #007700">=&nbsp;array();</span><span style="color: #FF8000">//临时存放数据<br />&nbsp;&nbsp;&nbsp;&nbsp;</span><span style="color: #0000BB">array_push</span><span style="color: #007700">(</span><span style="color: #0000BB">$temp</span><span style="color: #007700">,</span><span style="color: #0000BB">$data</span><span style="color: #007700">[</span><span style="color: #0000BB">$key</span><span style="color: #007700">]);<br />&nbsp;&nbsp;&nbsp;&nbsp;unset(</span><span style="color: #0000BB">$data</span><span style="color: #007700">[</span><span style="color: #0000BB">$key</span><span style="color: #007700">]);<br />&nbsp;&nbsp;&nbsp;&nbsp;foreach(</span><span style="color: #0000BB">$data&nbsp;</span><span style="color: #007700">as&nbsp;</span><span style="color: #0000BB">$key</span><span style="color: #007700">=&gt;</span><span style="color: #0000BB">$value</span><span style="color: #007700">){<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span style="color: #0000BB">$x_&nbsp;</span><span style="color: #007700">=&nbsp;</span><span style="color: #0000BB">$value</span><span style="color: #007700">[</span><span style="color: #DD0000">'location'</span><span style="color: #007700">][</span><span style="color: #DD0000">'x'</span><span style="color: #007700">];<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span style="color: #0000BB">$y_&nbsp;</span><span style="color: #007700">=&nbsp;</span><span style="color: #0000BB">$value</span><span style="color: #007700">[</span><span style="color: #DD0000">'location'</span><span style="color: #007700">][</span><span style="color: #DD0000">'y'</span><span style="color: #007700">];<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;if(</span><span style="color: #0000BB">$x_&nbsp;</span><span style="color: #007700">&gt;&nbsp;</span><span style="color: #0000BB">$around</span><span style="color: #007700">[</span><span style="color: #DD0000">'minLat'</span><span style="color: #007700">]&nbsp;&amp;&amp;&nbsp;</span><span style="color: #0000BB">$x_&nbsp;</span><span style="color: #007700">&lt;&nbsp;</span><span style="color: #0000BB">$around</span><span style="color: #007700">[</span><span style="color: #DD0000">'maxLat'</span><span style="color: #007700">]&nbsp;&amp;&amp;&nbsp;</span><span style="color: #0000BB">$y_&nbsp;</span><span style="color: #007700">&gt;&nbsp;</span><span style="color: #0000BB">$around</span><span style="color: #007700">[</span><span style="color: #DD0000">'minLng'</span><span style="color: #007700">]&nbsp;&amp;&amp;&nbsp;</span><span style="color: #0000BB">$y_&nbsp;</span><span style="color: #007700">&lt;&nbsp;</span><span style="color: #0000BB">$around</span><span style="color: #007700">[</span><span style="color: #DD0000">'maxLng'</span><span style="color: #007700">]){<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span style="color: #0000BB">array_push</span><span style="color: #007700">(</span><span style="color: #0000BB">$temp</span><span style="color: #007700">,</span><span style="color: #0000BB">$value</span><span style="color: #007700">);<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;unset(</span><span style="color: #0000BB">$data</span><span style="color: #007700">[</span><span style="color: #0000BB">$key</span><span style="color: #007700">]);<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;}<br />&nbsp;&nbsp;&nbsp;&nbsp;}<br />&nbsp;&nbsp;&nbsp;&nbsp;</span><span style="color: #0000BB">array_push</span><span style="color: #007700">(</span><span style="color: #0000BB">$mergrData</span><span style="color: #007700">,array(</span><span style="color: #DD0000">'count'</span><span style="color: #007700">=&gt;</span><span style="color: #0000BB">count</span><span style="color: #007700">(</span><span style="color: #0000BB">$temp</span><span style="color: #007700">),</span><span style="color: #DD0000">'user'</span><span style="color: #007700">=&gt;</span><span style="color: #0000BB">$temp</span><span style="color: #007700">));<br />&nbsp;&nbsp;&nbsp;&nbsp;</span><span style="color: #0000BB">$this</span><span style="color: #007700">-&gt;</span><span style="color: #0000BB">merge</span><span style="color: #007700">(</span><span style="color: #0000BB">$data</span><span style="color: #007700">,</span><span style="color: #0000BB">$mergrData</span><span style="color: #007700">);<br />}</span>
</span>
</code></div>
</div>

<p>合并查询 密集范围的数据。</p>


<div class="detailHeader" id="model-detail">
model()
<span class="detailHeaderTag">
method
</span>
</div>

<table class="summaryTable">
<tr><td colspan="3">
<div class="signature2">
public static User <b>model</b>(string $className='User')</div>
</td></tr>
<tr>
  <td class="paramNameCol">$className</td>
  <td class="paramTypeCol">string</td>
  <td class="paramDescCol">active record class name.</td>
</tr>
<tr>
  <td class="paramNameCol">{return}</td>
  <td class="paramTypeCol">User</td>
  <td class="paramDescCol">the static model class</td>
</tr>
</table>

<div class="sourceCode">
<b>Source Code:</b>  (<b><a href="#" class="show">show</a></b>)
<div class="code"><code><span style="color: #000000">
<span style="color: #0000BB"></span><span style="color: #007700">public&nbsp;static&nbsp;function&nbsp;</span><span style="color: #0000BB">model</span><span style="color: #007700">(</span><span style="color: #0000BB">$className</span><span style="color: #007700">=</span><span style="color: #0000BB">__CLASS__</span><span style="color: #007700">)<br />{<br />&nbsp;&nbsp;&nbsp;&nbsp;return&nbsp;</span><span style="color: #0000BB">parent</span><span style="color: #007700">::</span><span style="color: #0000BB">model</span><span style="color: #007700">(</span><span style="color: #0000BB">$className</span><span style="color: #007700">);<br />}</span>
</span>
</code></div>
</div>

<p>Returns the static model of the specified AR class.</p>


<div class="detailHeader" id="relations-detail">
relations()
<span class="detailHeaderTag">
method
</span>
</div>

<table class="summaryTable">
<tr><td colspan="3">
<div class="signature2">
public array <b>relations</b>()</div>
</td></tr>
<tr>
  <td class="paramNameCol">{return}</td>
  <td class="paramTypeCol">array</td>
  <td class="paramDescCol">relational rules.</td>
</tr>
</table>

<div class="sourceCode">
<b>Source Code:</b>  (<b><a href="#" class="show">show</a></b>)
<div class="code"><code><span style="color: #000000">
<span style="color: #0000BB"></span><span style="color: #007700">public&nbsp;function&nbsp;</span><span style="color: #0000BB">relations</span><span style="color: #007700">()<br />{<br />&nbsp;&nbsp;&nbsp;&nbsp;</span><span style="color: #FF8000">//&nbsp;NOTE:&nbsp;you&nbsp;may&nbsp;need&nbsp;to&nbsp;adjust&nbsp;the&nbsp;relation&nbsp;name&nbsp;and&nbsp;the&nbsp;related<br />&nbsp;&nbsp;&nbsp;&nbsp;//&nbsp;class&nbsp;name&nbsp;for&nbsp;the&nbsp;relations&nbsp;automatically&nbsp;generated&nbsp;below.<br />&nbsp;&nbsp;&nbsp;&nbsp;</span><span style="color: #007700">return&nbsp;array(<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span style="color: #DD0000">'collects'&nbsp;</span><span style="color: #007700">=&gt;&nbsp;array(</span><span style="color: #0000BB">self</span><span style="color: #007700">::</span><span style="color: #0000BB">HAS_MANY</span><span style="color: #007700">,&nbsp;</span><span style="color: #DD0000">'Collect'</span><span style="color: #007700">,&nbsp;</span><span style="color: #DD0000">'userId'</span><span style="color: #007700">),<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span style="color: #DD0000">'comments'&nbsp;</span><span style="color: #007700">=&gt;&nbsp;array(</span><span style="color: #0000BB">self</span><span style="color: #007700">::</span><span style="color: #0000BB">HAS_MANY</span><span style="color: #007700">,&nbsp;</span><span style="color: #DD0000">'Comments'</span><span style="color: #007700">,&nbsp;</span><span style="color: #DD0000">'userId'</span><span style="color: #007700">),<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span style="color: #DD0000">'introduction'&nbsp;</span><span style="color: #007700">=&gt;&nbsp;array(</span><span style="color: #0000BB">self</span><span style="color: #007700">::</span><span style="color: #0000BB">HAS_ONE</span><span style="color: #007700">,&nbsp;</span><span style="color: #DD0000">'Introduction'</span><span style="color: #007700">,&nbsp;</span><span style="color: #DD0000">'id'</span><span style="color: #007700">),<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span style="color: #DD0000">'messages'&nbsp;</span><span style="color: #007700">=&gt;&nbsp;array(</span><span style="color: #0000BB">self</span><span style="color: #007700">::</span><span style="color: #0000BB">HAS_MANY</span><span style="color: #007700">,&nbsp;</span><span style="color: #DD0000">'Messages'</span><span style="color: #007700">,&nbsp;</span><span style="color: #DD0000">'userId'</span><span style="color: #007700">),<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span style="color: #DD0000">'messagesDetails'&nbsp;</span><span style="color: #007700">=&gt;&nbsp;array(</span><span style="color: #0000BB">self</span><span style="color: #007700">::</span><span style="color: #0000BB">HAS_MANY</span><span style="color: #007700">,&nbsp;</span><span style="color: #DD0000">'MessagesDetails'</span><span style="color: #007700">,&nbsp;</span><span style="color: #DD0000">'userId'</span><span style="color: #007700">),<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span style="color: #DD0000">'messagesOptions'&nbsp;</span><span style="color: #007700">=&gt;&nbsp;array(</span><span style="color: #0000BB">self</span><span style="color: #007700">::</span><span style="color: #0000BB">HAS_MANY</span><span style="color: #007700">,&nbsp;</span><span style="color: #DD0000">'MessagesOption'</span><span style="color: #007700">,&nbsp;</span><span style="color: #DD0000">'userId'</span><span style="color: #007700">),<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span style="color: #DD0000">'giveNotices'&nbsp;</span><span style="color: #007700">=&gt;&nbsp;array(</span><span style="color: #0000BB">self</span><span style="color: #007700">::</span><span style="color: #0000BB">HAS_MANY</span><span style="color: #007700">,&nbsp;</span><span style="color: #DD0000">'Notice'</span><span style="color: #007700">,&nbsp;</span><span style="color: #DD0000">'giveId'</span><span style="color: #007700">),<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span style="color: #DD0000">'receiveNotices'&nbsp;</span><span style="color: #007700">=&gt;&nbsp;array(</span><span style="color: #0000BB">self</span><span style="color: #007700">::</span><span style="color: #0000BB">HAS_MANY</span><span style="color: #007700">,&nbsp;</span><span style="color: #DD0000">'Notice'</span><span style="color: #007700">,&nbsp;</span><span style="color: #DD0000">'receiveId'</span><span style="color: #007700">),<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span style="color: #DD0000">'noticeOptions'&nbsp;</span><span style="color: #007700">=&gt;&nbsp;array(</span><span style="color: #0000BB">self</span><span style="color: #007700">::</span><span style="color: #0000BB">HAS_MANY</span><span style="color: #007700">,&nbsp;</span><span style="color: #DD0000">'NoticeOption'</span><span style="color: #007700">,&nbsp;</span><span style="color: #DD0000">'userId'</span><span style="color: #007700">),<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span style="color: #DD0000">'noticeUserDeletes'&nbsp;</span><span style="color: #007700">=&gt;&nbsp;array(</span><span style="color: #0000BB">self</span><span style="color: #007700">::</span><span style="color: #0000BB">HAS_MANY</span><span style="color: #007700">,&nbsp;</span><span style="color: #DD0000">'NoticeUserDelete'</span><span style="color: #007700">,&nbsp;</span><span style="color: #DD0000">'userId'</span><span style="color: #007700">),<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span style="color: #DD0000">'profile'&nbsp;</span><span style="color: #007700">=&gt;&nbsp;array(</span><span style="color: #0000BB">self</span><span style="color: #007700">::</span><span style="color: #0000BB">HAS_ONE</span><span style="color: #007700">,&nbsp;</span><span style="color: #DD0000">'Profile'</span><span style="color: #007700">,&nbsp;</span><span style="color: #DD0000">'id'</span><span style="color: #007700">),<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span style="color: #DD0000">'teach'&nbsp;</span><span style="color: #007700">=&gt;&nbsp;array(</span><span style="color: #0000BB">self</span><span style="color: #007700">::</span><span style="color: #0000BB">HAS_ONE</span><span style="color: #007700">,&nbsp;</span><span style="color: #DD0000">'Teach'</span><span style="color: #007700">,&nbsp;</span><span style="color: #DD0000">'id'</span><span style="color: #007700">),<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span style="color: #DD0000">'teachCourses'&nbsp;</span><span style="color: #007700">=&gt;&nbsp;array(</span><span style="color: #0000BB">self</span><span style="color: #007700">::</span><span style="color: #0000BB">HAS_MANY</span><span style="color: #007700">,&nbsp;</span><span style="color: #DD0000">'TeachCourse'</span><span style="color: #007700">,&nbsp;</span><span style="color: #DD0000">'userId'</span><span style="color: #007700">),<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span style="color: #DD0000">'teachCourseSignUps'&nbsp;</span><span style="color: #007700">=&gt;&nbsp;array(</span><span style="color: #0000BB">self</span><span style="color: #007700">::</span><span style="color: #0000BB">HAS_MANY</span><span style="color: #007700">,&nbsp;</span><span style="color: #DD0000">'TeachCourseSignUp'</span><span style="color: #007700">,&nbsp;</span><span style="color: #DD0000">'userId'</span><span style="color: #007700">),<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span style="color: #DD0000">'teachStars'&nbsp;</span><span style="color: #007700">=&gt;&nbsp;array(</span><span style="color: #0000BB">self</span><span style="color: #007700">::</span><span style="color: #0000BB">HAS_MANY</span><span style="color: #007700">,&nbsp;</span><span style="color: #DD0000">'TeachStar'</span><span style="color: #007700">,&nbsp;</span><span style="color: #DD0000">'userId'</span><span style="color: #007700">),<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span style="color: #DD0000">'teachVideos'&nbsp;</span><span style="color: #007700">=&gt;&nbsp;array(</span><span style="color: #0000BB">self</span><span style="color: #007700">::</span><span style="color: #0000BB">HAS_MANY</span><span style="color: #007700">,&nbsp;</span><span style="color: #DD0000">'TeachVideo'</span><span style="color: #007700">,&nbsp;</span><span style="color: #DD0000">'userId'</span><span style="color: #007700">),<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span style="color: #DD0000">'teachVideoStars'&nbsp;</span><span style="color: #007700">=&gt;&nbsp;array(</span><span style="color: #0000BB">self</span><span style="color: #007700">::</span><span style="color: #0000BB">HAS_MANY</span><span style="color: #007700">,&nbsp;</span><span style="color: #DD0000">'TeachVideoStar'</span><span style="color: #007700">,&nbsp;</span><span style="color: #DD0000">'userId'</span><span style="color: #007700">),<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span style="color: #DD0000">'role'&nbsp;</span><span style="color: #007700">=&gt;&nbsp;array(</span><span style="color: #0000BB">self</span><span style="color: #007700">::</span><span style="color: #0000BB">BELONGS_TO</span><span style="color: #007700">,&nbsp;</span><span style="color: #DD0000">'Role'</span><span style="color: #007700">,&nbsp;</span><span style="color: #DD0000">'roleId'</span><span style="color: #007700">),<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span style="color: #DD0000">'userAuth'&nbsp;</span><span style="color: #007700">=&gt;&nbsp;array(</span><span style="color: #0000BB">self</span><span style="color: #007700">::</span><span style="color: #0000BB">HAS_ONE</span><span style="color: #007700">,&nbsp;</span><span style="color: #DD0000">'UserAuth'</span><span style="color: #007700">,&nbsp;</span><span style="color: #DD0000">'id'</span><span style="color: #007700">),<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span style="color: #DD0000">'userBindings'&nbsp;</span><span style="color: #007700">=&gt;&nbsp;array(</span><span style="color: #0000BB">self</span><span style="color: #007700">::</span><span style="color: #0000BB">HAS_MANY</span><span style="color: #007700">,&nbsp;</span><span style="color: #DD0000">'UserBinding'</span><span style="color: #007700">,&nbsp;</span><span style="color: #DD0000">'userId'</span><span style="color: #007700">),<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span style="color: #DD0000">'userCategories'&nbsp;</span><span style="color: #007700">=&gt;&nbsp;array(</span><span style="color: #0000BB">self</span><span style="color: #007700">::</span><span style="color: #0000BB">HAS_MANY</span><span style="color: #007700">,&nbsp;</span><span style="color: #DD0000">'UserCategory'</span><span style="color: #007700">,&nbsp;</span><span style="color: #DD0000">'userId'</span><span style="color: #007700">),<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span style="color: #DD0000">'userCities'&nbsp;</span><span style="color: #007700">=&gt;&nbsp;array(</span><span style="color: #0000BB">self</span><span style="color: #007700">::</span><span style="color: #0000BB">HAS_MANY</span><span style="color: #007700">,&nbsp;</span><span style="color: #DD0000">'UserCity'</span><span style="color: #007700">,&nbsp;</span><span style="color: #DD0000">'userId'</span><span style="color: #007700">),<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span style="color: #DD0000">'userLocation'&nbsp;</span><span style="color: #007700">=&gt;&nbsp;array(</span><span style="color: #0000BB">self</span><span style="color: #007700">::</span><span style="color: #0000BB">HAS_ONE</span><span style="color: #007700">,&nbsp;</span><span style="color: #DD0000">'UserLocation'</span><span style="color: #007700">,&nbsp;</span><span style="color: #DD0000">'id'</span><span style="color: #007700">),<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span style="color: #DD0000">'userSessions'&nbsp;</span><span style="color: #007700">=&gt;&nbsp;array(</span><span style="color: #0000BB">self</span><span style="color: #007700">::</span><span style="color: #0000BB">HAS_MANY</span><span style="color: #007700">,&nbsp;</span><span style="color: #DD0000">'UserSession'</span><span style="color: #007700">,&nbsp;</span><span style="color: #DD0000">'userId'</span><span style="color: #007700">),<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span style="color: #DD0000">'userSetting'&nbsp;</span><span style="color: #007700">=&gt;&nbsp;array(</span><span style="color: #0000BB">self</span><span style="color: #007700">::</span><span style="color: #0000BB">HAS_ONE</span><span style="color: #007700">,&nbsp;</span><span style="color: #DD0000">'UserSetting'</span><span style="color: #007700">,&nbsp;</span><span style="color: #DD0000">'id'</span><span style="color: #007700">),<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span style="color: #DD0000">'userVipSigns'&nbsp;</span><span style="color: #007700">=&gt;&nbsp;array(</span><span style="color: #0000BB">self</span><span style="color: #007700">::</span><span style="color: #0000BB">HAS_MANY</span><span style="color: #007700">,&nbsp;</span><span style="color: #DD0000">'UserVipSign'</span><span style="color: #007700">,&nbsp;</span><span style="color: #DD0000">'userId'</span><span style="color: #007700">),<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span style="color: #FF8000">//设置页&nbsp;统计项目<br /><br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;//老师的培训课程总数<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span style="color: #DD0000">'teachCourseCount'&nbsp;</span><span style="color: #007700">=&gt;&nbsp;array(</span><span style="color: #0000BB">self</span><span style="color: #007700">::</span><span style="color: #0000BB">STAT</span><span style="color: #007700">,&nbsp;</span><span style="color: #DD0000">'TeachCourse'</span><span style="color: #007700">,&nbsp;</span><span style="color: #DD0000">'userId'</span><span style="color: #007700">,</span><span style="color: #DD0000">'condition'</span><span style="color: #007700">=&gt;</span><span style="color: #DD0000">'isDelete&nbsp;=&nbsp;'</span><span style="color: #007700">.</span><span style="color: #0000BB">Contents</span><span style="color: #007700">::</span><span style="color: #0000BB">F</span><span style="color: #007700">),<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span style="color: #FF8000">//老师的课程视频总数<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span style="color: #DD0000">'teachVideoCount'&nbsp;</span><span style="color: #007700">=&gt;&nbsp;array(</span><span style="color: #0000BB">self</span><span style="color: #007700">::</span><span style="color: #0000BB">STAT</span><span style="color: #007700">,&nbsp;</span><span style="color: #DD0000">'TeachVideo'</span><span style="color: #007700">,&nbsp;</span><span style="color: #DD0000">'userId'</span><span style="color: #007700">,</span><span style="color: #DD0000">'condition'</span><span style="color: #007700">=&gt;</span><span style="color: #DD0000">'isDelete&nbsp;=&nbsp;'</span><span style="color: #007700">.</span><span style="color: #0000BB">Contents</span><span style="color: #007700">::</span><span style="color: #0000BB">F</span><span style="color: #007700">),<br /><br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span style="color: #FF8000">//我的评论条数<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span style="color: #DD0000">'commentsCount'&nbsp;</span><span style="color: #007700">=&gt;&nbsp;array(</span><span style="color: #0000BB">self</span><span style="color: #007700">::</span><span style="color: #0000BB">STAT</span><span style="color: #007700">,&nbsp;</span><span style="color: #DD0000">'Comments'</span><span style="color: #007700">,&nbsp;</span><span style="color: #DD0000">'commentsId'</span><span style="color: #007700">,</span><span style="color: #DD0000">'condition'</span><span style="color: #007700">=&gt;</span><span style="color: #DD0000">'dialogId&nbsp;=&nbsp;0&nbsp;and&nbsp;isDelete&nbsp;=&nbsp;'</span><span style="color: #007700">.</span><span style="color: #0000BB">Contents</span><span style="color: #007700">::</span><span style="color: #0000BB">F</span><span style="color: #007700">),<br /><br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span style="color: #FF8000">//未读消息的条数<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span style="color: #DD0000">'noticeOptionsSum'&nbsp;</span><span style="color: #007700">=&gt;&nbsp;array(</span><span style="color: #0000BB">self</span><span style="color: #007700">::</span><span style="color: #0000BB">STAT</span><span style="color: #007700">,&nbsp;</span><span style="color: #DD0000">'NoticeOption'</span><span style="color: #007700">,&nbsp;</span><span style="color: #DD0000">'userId'</span><span style="color: #007700">,</span><span style="color: #DD0000">'select'</span><span style="color: #007700">=&gt;&nbsp;</span><span style="color: #DD0000">'SUM(notReadCount)'</span><span style="color: #007700">),<br />&nbsp;&nbsp;&nbsp;&nbsp;);<br />}</span>
</span>
</code></div>
</div>

<p></p>


<div class="detailHeader" id="resetPassword-detail">
resetPassword()
<span class="detailHeaderTag">
method
</span>
</div>

<table class="summaryTable">
<tr><td colspan="3">
<div class="signature2">
public User <b>resetPassword</b>(User $user, string $password)</div>
</td></tr>
<tr>
  <td class="paramNameCol">$user</td>
  <td class="paramTypeCol">User</td>
  <td class="paramDescCol"></td>
</tr>
<tr>
  <td class="paramNameCol">$password</td>
  <td class="paramTypeCol">string</td>
  <td class="paramDescCol"></td>
</tr>
<tr>
  <td class="paramNameCol">{return}</td>
  <td class="paramTypeCol">User</td>
  <td class="paramDescCol"></td>
</tr>
</table>

<div class="sourceCode">
<b>Source Code:</b>  (<b><a href="#" class="show">show</a></b>)
<div class="code"><code><span style="color: #000000">
<span style="color: #0000BB"></span><span style="color: #007700">public&nbsp;function&nbsp;</span><span style="color: #0000BB">resetPassword</span><span style="color: #007700">(</span><span style="color: #0000BB">User&nbsp;$user</span><span style="color: #007700">,&nbsp;</span><span style="color: #0000BB">$password</span><span style="color: #007700">)&nbsp;{<br />&nbsp;&nbsp;&nbsp;&nbsp;</span><span style="color: #0000BB">$user</span><span style="color: #007700">-&gt;</span><span style="color: #0000BB">password&nbsp;</span><span style="color: #007700">=&nbsp;</span><span style="color: #0000BB">sha1</span><span style="color: #007700">(</span><span style="color: #0000BB">$password</span><span style="color: #007700">);<br />&nbsp;&nbsp;&nbsp;&nbsp;</span><span style="color: #0000BB">$user</span><span style="color: #007700">-&gt;</span><span style="color: #0000BB">editTime&nbsp;</span><span style="color: #007700">=&nbsp;</span><span style="color: #0000BB">date</span><span style="color: #007700">(</span><span style="color: #0000BB">Contents</span><span style="color: #007700">::</span><span style="color: #0000BB">DATETIME</span><span style="color: #007700">);<br />&nbsp;&nbsp;&nbsp;&nbsp;if&nbsp;(!</span><span style="color: #0000BB">$user</span><span style="color: #007700">-&gt;</span><span style="color: #0000BB">validate</span><span style="color: #007700">())&nbsp;{<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span style="color: #0000BB">$errors&nbsp;</span><span style="color: #007700">=&nbsp;</span><span style="color: #0000BB">array_values</span><span style="color: #007700">(</span><span style="color: #0000BB">$user</span><span style="color: #007700">-&gt;</span><span style="color: #0000BB">getErrors</span><span style="color: #007700">());<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;throw&nbsp;new&nbsp;</span><span style="color: #0000BB">CHttpException</span><span style="color: #007700">(</span><span style="color: #0000BB">1001</span><span style="color: #007700">,&nbsp;</span><span style="color: #0000BB">$errors</span><span style="color: #007700">[</span><span style="color: #0000BB">0</span><span style="color: #007700">][</span><span style="color: #0000BB">0</span><span style="color: #007700">]);<br />&nbsp;&nbsp;&nbsp;&nbsp;}<br />&nbsp;&nbsp;&nbsp;&nbsp;try&nbsp;{<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span style="color: #0000BB">$user</span><span style="color: #007700">-&gt;</span><span style="color: #0000BB">save</span><span style="color: #007700">();<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;return&nbsp;</span><span style="color: #0000BB">$user</span><span style="color: #007700">;<br />&nbsp;&nbsp;&nbsp;&nbsp;}&nbsp;catch&nbsp;(</span><span style="color: #0000BB">Exception&nbsp;$e</span><span style="color: #007700">)&nbsp;{<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;throw&nbsp;new&nbsp;</span><span style="color: #0000BB">CHttpException</span><span style="color: #007700">(</span><span style="color: #0000BB">1003</span><span style="color: #007700">,&nbsp;</span><span style="color: #0000BB">Contents</span><span style="color: #007700">::</span><span style="color: #0000BB">getErrorByCode</span><span style="color: #007700">(</span><span style="color: #0000BB">1003</span><span style="color: #007700">));<br />&nbsp;&nbsp;&nbsp;&nbsp;}<br />}</span>
</span>
</code></div>
</div>

<p>重置密码，user对象为查询出CActiveRecord的user，非自己new创建的user</p>


<div class="detailHeader" id="rules-detail">
rules()
<span class="detailHeaderTag">
method
</span>
</div>

<table class="summaryTable">
<tr><td colspan="3">
<div class="signature2">
public array <b>rules</b>()</div>
</td></tr>
<tr>
  <td class="paramNameCol">{return}</td>
  <td class="paramTypeCol">array</td>
  <td class="paramDescCol">validation rules for model attributes.</td>
</tr>
</table>

<div class="sourceCode">
<b>Source Code:</b>  (<b><a href="#" class="show">show</a></b>)
<div class="code"><code><span style="color: #000000">
<span style="color: #0000BB"></span><span style="color: #007700">public&nbsp;function&nbsp;</span><span style="color: #0000BB">rules</span><span style="color: #007700">()<br />{<br />&nbsp;&nbsp;&nbsp;&nbsp;</span><span style="color: #FF8000">//&nbsp;NOTE:&nbsp;you&nbsp;should&nbsp;only&nbsp;define&nbsp;rules&nbsp;for&nbsp;those&nbsp;attributes&nbsp;that<br />&nbsp;&nbsp;&nbsp;&nbsp;//&nbsp;will&nbsp;receive&nbsp;user&nbsp;inputs.<br />&nbsp;&nbsp;&nbsp;&nbsp;</span><span style="color: #007700">return&nbsp;array(<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;array(</span><span style="color: #DD0000">'id,&nbsp;phone,&nbsp;isDelete,&nbsp;roleId,&nbsp;isComplete,&nbsp;createTime,&nbsp;editTime'</span><span style="color: #007700">,&nbsp;</span><span style="color: #DD0000">'required'</span><span style="color: #007700">),<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;array(</span><span style="color: #DD0000">'isDelete,&nbsp;isComplete'</span><span style="color: #007700">,&nbsp;</span><span style="color: #DD0000">'numerical'</span><span style="color: #007700">,&nbsp;</span><span style="color: #DD0000">'integerOnly'</span><span style="color: #007700">=&gt;</span><span style="color: #0000BB">true</span><span style="color: #007700">),<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;array(</span><span style="color: #DD0000">'id,&nbsp;roleId'</span><span style="color: #007700">,&nbsp;</span><span style="color: #DD0000">'length'</span><span style="color: #007700">,&nbsp;</span><span style="color: #DD0000">'max'</span><span style="color: #007700">=&gt;</span><span style="color: #0000BB">25</span><span style="color: #007700">),<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;array(</span><span style="color: #DD0000">'phone,&nbsp;password'</span><span style="color: #007700">,&nbsp;</span><span style="color: #DD0000">'length'</span><span style="color: #007700">,&nbsp;</span><span style="color: #DD0000">'max'</span><span style="color: #007700">=&gt;</span><span style="color: #0000BB">255</span><span style="color: #007700">),<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;array(</span><span style="color: #DD0000">'order'</span><span style="color: #007700">,&nbsp;</span><span style="color: #DD0000">'length'</span><span style="color: #007700">,&nbsp;</span><span style="color: #DD0000">'max'</span><span style="color: #007700">=&gt;</span><span style="color: #0000BB">11</span><span style="color: #007700">),<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span style="color: #FF8000">//&nbsp;The&nbsp;following&nbsp;rule&nbsp;is&nbsp;used&nbsp;by&nbsp;search().<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;//&nbsp;Please&nbsp;remove&nbsp;those&nbsp;attributes&nbsp;that&nbsp;should&nbsp;not&nbsp;be&nbsp;searched.<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span style="color: #007700">array(</span><span style="color: #DD0000">'id,&nbsp;phone,&nbsp;password,&nbsp;isDelete,&nbsp;roleId,&nbsp;isComplete,&nbsp;createTime,&nbsp;editTime'</span><span style="color: #007700">,&nbsp;</span><span style="color: #DD0000">'safe'</span><span style="color: #007700">,&nbsp;</span><span style="color: #DD0000">'on'&nbsp;</span><span style="color: #007700">=&gt;&nbsp;</span><span style="color: #DD0000">'search'</span><span style="color: #007700">),<br />&nbsp;&nbsp;&nbsp;&nbsp;);<br />}</span>
</span>
</code></div>
</div>

<p></p>


<div class="detailHeader" id="search-detail">
search()
<span class="detailHeaderTag">
method
</span>
</div>

<table class="summaryTable">
<tr><td colspan="3">
<div class="signature2">
public CActiveDataProvider <b>search</b>()</div>
</td></tr>
<tr>
  <td class="paramNameCol">{return}</td>
  <td class="paramTypeCol">CActiveDataProvider</td>
  <td class="paramDescCol">the data provider that can return the models based on the search/filter conditions.</td>
</tr>
</table>

<div class="sourceCode">
<b>Source Code:</b>  (<b><a href="#" class="show">show</a></b>)
<div class="code"><code><span style="color: #000000">
<span style="color: #0000BB"></span><span style="color: #007700">public&nbsp;function&nbsp;</span><span style="color: #0000BB">search</span><span style="color: #007700">()<br />{<br />&nbsp;&nbsp;&nbsp;&nbsp;</span><span style="color: #FF8000">//&nbsp;Warning:&nbsp;Please&nbsp;modify&nbsp;the&nbsp;following&nbsp;code&nbsp;to&nbsp;remove&nbsp;attributes&nbsp;that<br />&nbsp;&nbsp;&nbsp;&nbsp;//&nbsp;should&nbsp;not&nbsp;be&nbsp;searched.<br /><br />&nbsp;&nbsp;&nbsp;&nbsp;</span><span style="color: #0000BB">$criteria</span><span style="color: #007700">=new&nbsp;</span><span style="color: #0000BB">CDbCriteria</span><span style="color: #007700">;<br /><br />&nbsp;&nbsp;&nbsp;&nbsp;</span><span style="color: #0000BB">$criteria</span><span style="color: #007700">-&gt;</span><span style="color: #0000BB">compare</span><span style="color: #007700">(</span><span style="color: #DD0000">'id'</span><span style="color: #007700">,</span><span style="color: #0000BB">$this</span><span style="color: #007700">-&gt;</span><span style="color: #0000BB">id</span><span style="color: #007700">,</span><span style="color: #0000BB">true</span><span style="color: #007700">);<br />&nbsp;&nbsp;&nbsp;&nbsp;</span><span style="color: #0000BB">$criteria</span><span style="color: #007700">-&gt;</span><span style="color: #0000BB">compare</span><span style="color: #007700">(</span><span style="color: #DD0000">'phone'</span><span style="color: #007700">,</span><span style="color: #0000BB">$this</span><span style="color: #007700">-&gt;</span><span style="color: #0000BB">phone</span><span style="color: #007700">,</span><span style="color: #0000BB">true</span><span style="color: #007700">);<br />&nbsp;&nbsp;&nbsp;&nbsp;</span><span style="color: #0000BB">$criteria</span><span style="color: #007700">-&gt;</span><span style="color: #0000BB">compare</span><span style="color: #007700">(</span><span style="color: #DD0000">'password'</span><span style="color: #007700">,</span><span style="color: #0000BB">$this</span><span style="color: #007700">-&gt;</span><span style="color: #0000BB">password</span><span style="color: #007700">,</span><span style="color: #0000BB">true</span><span style="color: #007700">);<br />&nbsp;&nbsp;&nbsp;&nbsp;</span><span style="color: #0000BB">$criteria</span><span style="color: #007700">-&gt;</span><span style="color: #0000BB">compare</span><span style="color: #007700">(</span><span style="color: #DD0000">'isDelete'</span><span style="color: #007700">,</span><span style="color: #0000BB">$this</span><span style="color: #007700">-&gt;</span><span style="color: #0000BB">isDelete</span><span style="color: #007700">);<br />&nbsp;&nbsp;&nbsp;&nbsp;</span><span style="color: #0000BB">$criteria</span><span style="color: #007700">-&gt;</span><span style="color: #0000BB">compare</span><span style="color: #007700">(</span><span style="color: #DD0000">'roleId'</span><span style="color: #007700">,</span><span style="color: #0000BB">$this</span><span style="color: #007700">-&gt;</span><span style="color: #0000BB">roleId</span><span style="color: #007700">,</span><span style="color: #0000BB">true</span><span style="color: #007700">);<br />&nbsp;&nbsp;&nbsp;&nbsp;</span><span style="color: #0000BB">$criteria</span><span style="color: #007700">-&gt;</span><span style="color: #0000BB">compare</span><span style="color: #007700">(</span><span style="color: #DD0000">'isComplete'</span><span style="color: #007700">,</span><span style="color: #0000BB">$this</span><span style="color: #007700">-&gt;</span><span style="color: #0000BB">isComplete</span><span style="color: #007700">);<br />&nbsp;&nbsp;&nbsp;&nbsp;</span><span style="color: #0000BB">$criteria</span><span style="color: #007700">-&gt;</span><span style="color: #0000BB">compare</span><span style="color: #007700">(</span><span style="color: #DD0000">'order'</span><span style="color: #007700">,</span><span style="color: #0000BB">$this</span><span style="color: #007700">-&gt;</span><span style="color: #0000BB">order</span><span style="color: #007700">,</span><span style="color: #0000BB">true</span><span style="color: #007700">);<br />&nbsp;&nbsp;&nbsp;&nbsp;</span><span style="color: #0000BB">$criteria</span><span style="color: #007700">-&gt;</span><span style="color: #0000BB">compare</span><span style="color: #007700">(</span><span style="color: #DD0000">'createTime'</span><span style="color: #007700">,</span><span style="color: #0000BB">$this</span><span style="color: #007700">-&gt;</span><span style="color: #0000BB">createTime</span><span style="color: #007700">,</span><span style="color: #0000BB">true</span><span style="color: #007700">);<br />&nbsp;&nbsp;&nbsp;&nbsp;</span><span style="color: #0000BB">$criteria</span><span style="color: #007700">-&gt;</span><span style="color: #0000BB">compare</span><span style="color: #007700">(</span><span style="color: #DD0000">'editTime'</span><span style="color: #007700">,</span><span style="color: #0000BB">$this</span><span style="color: #007700">-&gt;</span><span style="color: #0000BB">editTime</span><span style="color: #007700">,</span><span style="color: #0000BB">true</span><span style="color: #007700">);<br /><br />&nbsp;&nbsp;&nbsp;&nbsp;return&nbsp;new&nbsp;</span><span style="color: #0000BB">CActiveDataProvider</span><span style="color: #007700">(</span><span style="color: #0000BB">$this</span><span style="color: #007700">,&nbsp;array(<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span style="color: #DD0000">'criteria'</span><span style="color: #007700">=&gt;</span><span style="color: #0000BB">$criteria</span><span style="color: #007700">,<br />&nbsp;&nbsp;&nbsp;&nbsp;));<br />}</span>
</span>
</code></div>
</div>

<p>Retrieves a list of models based on the current search/filter conditions.</p>


<div class="detailHeader" id="tableName-detail">
tableName()
<span class="detailHeaderTag">
method
</span>
</div>

<table class="summaryTable">
<tr><td colspan="3">
<div class="signature2">
public string <b>tableName</b>()</div>
</td></tr>
<tr>
  <td class="paramNameCol">{return}</td>
  <td class="paramTypeCol">string</td>
  <td class="paramDescCol">the associated database table name</td>
</tr>
</table>

<div class="sourceCode">
<b>Source Code:</b>  (<b><a href="#" class="show">show</a></b>)
<div class="code"><code><span style="color: #000000">
<span style="color: #0000BB"></span><span style="color: #007700">public&nbsp;function&nbsp;</span><span style="color: #0000BB">tableName</span><span style="color: #007700">()<br />{<br />&nbsp;&nbsp;&nbsp;&nbsp;return&nbsp;</span><span style="color: #DD0000">'user'</span><span style="color: #007700">;<br />}</span>
</span>
</code></div>
</div>

<p></p>


<div class="detailHeader" id="updateAccount-detail">
updateAccount()
<span class="detailHeaderTag">
method
</span>
</div>

<table class="summaryTable">
<tr><td colspan="3">
<div class="signature2">
public void <b>updateAccount</b>(string $userId, string $phone, string $password, string $roleId, string $order=NULL)</div>
</td></tr>
<tr>
  <td class="paramNameCol">$userId</td>
  <td class="paramTypeCol">string</td>
  <td class="paramDescCol"></td>
</tr>
<tr>
  <td class="paramNameCol">$phone</td>
  <td class="paramTypeCol">string</td>
  <td class="paramDescCol"></td>
</tr>
<tr>
  <td class="paramNameCol">$password</td>
  <td class="paramTypeCol">string</td>
  <td class="paramDescCol"></td>
</tr>
<tr>
  <td class="paramNameCol">$roleId</td>
  <td class="paramTypeCol">string</td>
  <td class="paramDescCol"></td>
</tr>
<tr>
  <td class="paramNameCol">$order</td>
  <td class="paramTypeCol">string</td>
  <td class="paramDescCol"></td>
</tr>
</table>

<div class="sourceCode">
<b>Source Code:</b>  (<b><a href="#" class="show">show</a></b>)
<div class="code"><code><span style="color: #000000">
<span style="color: #0000BB"></span><span style="color: #007700">public&nbsp;function&nbsp;</span><span style="color: #0000BB">updateAccount</span><span style="color: #007700">(</span><span style="color: #0000BB">$userId</span><span style="color: #007700">,&nbsp;</span><span style="color: #0000BB">$phone</span><span style="color: #007700">,&nbsp;</span><span style="color: #0000BB">$password</span><span style="color: #007700">,&nbsp;</span><span style="color: #0000BB">$roleId</span><span style="color: #007700">,&nbsp;</span><span style="color: #0000BB">$order&nbsp;</span><span style="color: #007700">=&nbsp;</span><span style="color: #0000BB">null</span><span style="color: #007700">){<br />&nbsp;&nbsp;&nbsp;&nbsp;</span><span style="color: #0000BB">$update_array&nbsp;</span><span style="color: #007700">=&nbsp;array();<br />&nbsp;&nbsp;&nbsp;&nbsp;if(!</span><span style="color: #0000BB">Tools</span><span style="color: #007700">::</span><span style="color: #0000BB">isEmpty</span><span style="color: #007700">(</span><span style="color: #0000BB">$phone</span><span style="color: #007700">)){<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span style="color: #0000BB">$update_array</span><span style="color: #007700">[</span><span style="color: #DD0000">'phone'</span><span style="color: #007700">]&nbsp;=&nbsp;</span><span style="color: #0000BB">$phone</span><span style="color: #007700">;<br />&nbsp;&nbsp;&nbsp;&nbsp;}<br />&nbsp;&nbsp;&nbsp;&nbsp;if(!</span><span style="color: #0000BB">Tools</span><span style="color: #007700">::</span><span style="color: #0000BB">isEmpty</span><span style="color: #007700">(</span><span style="color: #0000BB">$password</span><span style="color: #007700">)){<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span style="color: #0000BB">$update_array</span><span style="color: #007700">[</span><span style="color: #DD0000">'password'</span><span style="color: #007700">]&nbsp;=&nbsp;</span><span style="color: #0000BB">sha1</span><span style="color: #007700">(</span><span style="color: #0000BB">$password</span><span style="color: #007700">);<br />&nbsp;&nbsp;&nbsp;&nbsp;}<br />&nbsp;&nbsp;&nbsp;&nbsp;if(!</span><span style="color: #0000BB">Tools</span><span style="color: #007700">::</span><span style="color: #0000BB">isEmpty</span><span style="color: #007700">(</span><span style="color: #0000BB">$roleId</span><span style="color: #007700">)){<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span style="color: #0000BB">$update_array</span><span style="color: #007700">[</span><span style="color: #DD0000">'roleId'</span><span style="color: #007700">]&nbsp;=&nbsp;</span><span style="color: #0000BB">$roleId</span><span style="color: #007700">;<br />&nbsp;&nbsp;&nbsp;&nbsp;}<br />&nbsp;&nbsp;&nbsp;&nbsp;if(</span><span style="color: #0000BB">$order&nbsp;</span><span style="color: #007700">==&nbsp;</span><span style="color: #DD0000">'-1'</span><span style="color: #007700">){<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span style="color: #0000BB">$order&nbsp;</span><span style="color: #007700">=&nbsp;</span><span style="color: #DD0000">""</span><span style="color: #007700">;<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span style="color: #0000BB">$update_array</span><span style="color: #007700">[</span><span style="color: #DD0000">'order'</span><span style="color: #007700">]&nbsp;=&nbsp;</span><span style="color: #0000BB">$order</span><span style="color: #007700">;<br />&nbsp;&nbsp;&nbsp;&nbsp;}<br />&nbsp;&nbsp;&nbsp;&nbsp;if(!</span><span style="color: #0000BB">Tools</span><span style="color: #007700">::</span><span style="color: #0000BB">isEmpty</span><span style="color: #007700">(</span><span style="color: #0000BB">$order</span><span style="color: #007700">)&nbsp;&amp;&amp;&nbsp;</span><span style="color: #0000BB">is_numeric</span><span style="color: #007700">(</span><span style="color: #0000BB">$order</span><span style="color: #007700">)){<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span style="color: #0000BB">$update_array</span><span style="color: #007700">[</span><span style="color: #DD0000">'order'</span><span style="color: #007700">]&nbsp;=&nbsp;</span><span style="color: #0000BB">$order</span><span style="color: #007700">;<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;try&nbsp;{<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span style="color: #0000BB">$user&nbsp;</span><span style="color: #007700">=&nbsp;</span><span style="color: #0000BB">User</span><span style="color: #007700">::</span><span style="color: #0000BB">model</span><span style="color: #007700">()-&gt;</span><span style="color: #0000BB">find</span><span style="color: #007700">(</span><span style="color: #DD0000">'`order`&nbsp;=&nbsp;:order&nbsp;and&nbsp;id&nbsp;!=&nbsp;:id'</span><span style="color: #007700">,array(</span><span style="color: #DD0000">'order'</span><span style="color: #007700">=&gt;</span><span style="color: #0000BB">$order</span><span style="color: #007700">,</span><span style="color: #DD0000">'id'</span><span style="color: #007700">=&gt;</span><span style="color: #0000BB">$userId</span><span style="color: #007700">));<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span style="color: #FF8000">//存在这个序号，序号之后的序号+1<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span style="color: #007700">if(</span><span style="color: #0000BB">$user</span><span style="color: #007700">){<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span style="color: #0000BB">$connection&nbsp;</span><span style="color: #007700">=&nbsp;</span><span style="color: #0000BB">Yii</span><span style="color: #007700">::</span><span style="color: #0000BB">app</span><span style="color: #007700">()-&gt;</span><span style="color: #0000BB">db</span><span style="color: #007700">;<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span style="color: #0000BB">$sql&nbsp;</span><span style="color: #007700">=&nbsp;</span><span style="color: #DD0000">'UPDATE&nbsp;'</span><span style="color: #007700">.</span><span style="color: #0000BB">User</span><span style="color: #007700">::</span><span style="color: #0000BB">model</span><span style="color: #007700">()-&gt;</span><span style="color: #0000BB">tableName</span><span style="color: #007700">().</span><span style="color: #DD0000">'&nbsp;u&nbsp;SET&nbsp;u.order&nbsp;=&nbsp;u.order&nbsp;+&nbsp;1&nbsp;WHERE&nbsp;u.order&nbsp;&gt;=&nbsp;:order'</span><span style="color: #007700">;<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span style="color: #0000BB">$command&nbsp;</span><span style="color: #007700">=&nbsp;</span><span style="color: #0000BB">$connection</span><span style="color: #007700">-&gt;</span><span style="color: #0000BB">createCommand</span><span style="color: #007700">(</span><span style="color: #0000BB">$sql</span><span style="color: #007700">);<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span style="color: #0000BB">$command</span><span style="color: #007700">-&gt;</span><span style="color: #0000BB">bindValue</span><span style="color: #007700">(</span><span style="color: #DD0000">'order'</span><span style="color: #007700">,</span><span style="color: #0000BB">$order</span><span style="color: #007700">);<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span style="color: #0000BB">$command</span><span style="color: #007700">-&gt;</span><span style="color: #0000BB">execute</span><span style="color: #007700">();<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;}<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;}catch(</span><span style="color: #0000BB">Exception&nbsp;$e</span><span style="color: #007700">){<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;throw&nbsp;new&nbsp;</span><span style="color: #0000BB">CHttpException</span><span style="color: #007700">(</span><span style="color: #0000BB">1003</span><span style="color: #007700">,</span><span style="color: #0000BB">Contents</span><span style="color: #007700">::</span><span style="color: #0000BB">getErrorByCode</span><span style="color: #007700">(</span><span style="color: #0000BB">1003</span><span style="color: #007700">));<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;}<br />&nbsp;&nbsp;&nbsp;&nbsp;}<br />&nbsp;&nbsp;&nbsp;&nbsp;</span><span style="color: #0000BB">$update_array</span><span style="color: #007700">[</span><span style="color: #DD0000">'editTime'</span><span style="color: #007700">]&nbsp;=&nbsp;</span><span style="color: #0000BB">date</span><span style="color: #007700">(</span><span style="color: #0000BB">Contents</span><span style="color: #007700">::</span><span style="color: #0000BB">DATETIME</span><span style="color: #007700">);<br />&nbsp;&nbsp;&nbsp;&nbsp;try&nbsp;{<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span style="color: #0000BB">User</span><span style="color: #007700">::</span><span style="color: #0000BB">model</span><span style="color: #007700">()-&gt;</span><span style="color: #0000BB">updateByPk</span><span style="color: #007700">(</span><span style="color: #0000BB">$userId</span><span style="color: #007700">,&nbsp;</span><span style="color: #0000BB">$update_array</span><span style="color: #007700">);<br />&nbsp;&nbsp;&nbsp;&nbsp;}catch(</span><span style="color: #0000BB">Exception&nbsp;$e</span><span style="color: #007700">){<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;throw&nbsp;new&nbsp;</span><span style="color: #0000BB">CHttpException</span><span style="color: #007700">(</span><span style="color: #0000BB">1003</span><span style="color: #007700">,</span><span style="color: #0000BB">Contents</span><span style="color: #007700">::</span><span style="color: #0000BB">getErrorByCode</span><span style="color: #007700">(</span><span style="color: #0000BB">1003</span><span style="color: #007700">));<br />&nbsp;&nbsp;&nbsp;&nbsp;}<br />}</span>
</span>
</code></div>
</div>

<p>根据userId修改账号</p>


<div class="detailHeader" id="updatePassword-detail">
updatePassword()
<span class="detailHeaderTag">
method
</span>
</div>

<table class="summaryTable">
<tr><td colspan="3">
<div class="signature2">
public void <b>updatePassword</b>(string $userId, string $password)</div>
</td></tr>
<tr>
  <td class="paramNameCol">$userId</td>
  <td class="paramTypeCol">string</td>
  <td class="paramDescCol"></td>
</tr>
<tr>
  <td class="paramNameCol">$password</td>
  <td class="paramTypeCol">string</td>
  <td class="paramDescCol"></td>
</tr>
</table>

<div class="sourceCode">
<b>Source Code:</b>  (<b><a href="#" class="show">show</a></b>)
<div class="code"><code><span style="color: #000000">
<span style="color: #0000BB"></span><span style="color: #007700">public&nbsp;function&nbsp;</span><span style="color: #0000BB">updatePassword</span><span style="color: #007700">(</span><span style="color: #0000BB">$userId</span><span style="color: #007700">,&nbsp;</span><span style="color: #0000BB">$password</span><span style="color: #007700">)&nbsp;{<br />&nbsp;&nbsp;&nbsp;&nbsp;</span><span style="color: #0000BB">$update_array&nbsp;</span><span style="color: #007700">=&nbsp;array();<br />&nbsp;&nbsp;&nbsp;&nbsp;</span><span style="color: #0000BB">$update_array</span><span style="color: #007700">[</span><span style="color: #DD0000">"password"</span><span style="color: #007700">]&nbsp;=&nbsp;</span><span style="color: #0000BB">sha1</span><span style="color: #007700">(</span><span style="color: #0000BB">$password</span><span style="color: #007700">);<br />&nbsp;&nbsp;&nbsp;&nbsp;</span><span style="color: #0000BB">$update_array</span><span style="color: #007700">[</span><span style="color: #DD0000">"editTime"</span><span style="color: #007700">]&nbsp;=&nbsp;</span><span style="color: #0000BB">date</span><span style="color: #007700">(</span><span style="color: #0000BB">Contents</span><span style="color: #007700">::</span><span style="color: #0000BB">DATETIME</span><span style="color: #007700">);<br />&nbsp;&nbsp;&nbsp;&nbsp;try&nbsp;{<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span style="color: #0000BB">User</span><span style="color: #007700">::</span><span style="color: #0000BB">model</span><span style="color: #007700">()-&gt;</span><span style="color: #0000BB">updateByPk</span><span style="color: #007700">(</span><span style="color: #0000BB">$userId</span><span style="color: #007700">,&nbsp;</span><span style="color: #0000BB">$update_array</span><span style="color: #007700">);<br />&nbsp;&nbsp;&nbsp;&nbsp;}&nbsp;catch&nbsp;(</span><span style="color: #0000BB">Exception&nbsp;$e</span><span style="color: #007700">)&nbsp;{<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;throw&nbsp;new&nbsp;</span><span style="color: #0000BB">CHttpException</span><span style="color: #007700">(</span><span style="color: #0000BB">1003</span><span style="color: #007700">,&nbsp;</span><span style="color: #0000BB">Contents</span><span style="color: #007700">::</span><span style="color: #0000BB">getErrorByCode</span><span style="color: #007700">(</span><span style="color: #0000BB">1003</span><span style="color: #007700">));<br />&nbsp;&nbsp;&nbsp;&nbsp;}<br />}</span>
</span>
</code></div>
</div>

<p>修改密码</p>


</div><!-- end of content -->

<div id="apiFooter">
Copyright &copy; 2008-2011 by <a href="http://www.yiisoft.com">Yii Software LLC</a><br/>
All Rights Reserved.<br/>
</div><!-- end of footer -->

<script type="text/javascript">
/*<![CDATA[*/
$("a.toggle").toggle(function(){
	$(this).text($(this).text().replace(/Hide/,'Show'));
	$(this).parents(".summary").find(".inherited").hide();
},function(){
	$(this).text($(this).text().replace(/Show/,'Hide'));
	$(this).parents(".summary").find(".inherited").show();
});
$(".sourceCode a.show").toggle(function(){
	$(this).text($(this).text().replace(/show/,'hide'));
	$(this).parents(".sourceCode").find("div.code").show();
},function(){
	$(this).text($(this).text().replace(/hide/,'show'));
	$(this).parents(".sourceCode").find("div.code").hide();
});
$("a.sourceLink").click(function(){
	$(this).attr('target','_blank');
});
/*]]>*/
</script>

</div><!-- end of page -->
</body>
</html>
